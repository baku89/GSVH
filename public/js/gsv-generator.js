var DIST_BETWEEN_PTS, MAX_PTS, canvas, create, dirService, loader, onAnalyzeComplete, onCancel, onComposeComplete, onMessage, onPanoramaLoad, onProgress, panoIds, rawPts, res, settings, sisyphus, storage, tasks, totalDist, updateSettings;

MAX_PTS = 100;

DIST_BETWEEN_PTS = 5;

loader = null;

dirService = new google.maps.DirectionsService({});

res = null;

rawPts = [];

panoIds = [];

totalDist = 0;

canvas = null;

tasks = [];

settings = {};

storage = localStorage;

updateSettings = function() {
  $('#gsv-generator').find('input, textarea').each(function() {
    var type;
    type = $(this).attr('type');
    if (type === 'checkbox') {
      settings[this.name] = $(this).is(':checked');
    } else if (type === 'radio') {
      if ($(this).is(':checked')) {
        settings[this.name] = $(this).val();
      }
    } else {
      settings[this.name] = $(this).val();
    }
    return true;
  });
};

sisyphus = null;

$(function() {
  canvas = document.createElement('canvas');
  $('#create').on('click', create);
  GSVHyperlapse.onMessage = onMessage;
  GSVHyperlapse.onPanoramaLoad = onPanoramaLoad;
  GSVHyperlapse.onProgress = onProgress;
  GSVHyperlapse.onAnalyzeComplete = onAnalyzeComplete;
  GSVHyperlapse.onComposeComplete = onComposeComplete;
  GSVHyperlapse.onCancel = onCancel;
  sisyphus = $('#gsv-generator').sisyphus();
  $('[name=dirFile]').on('change', function() {
    $('[name=dir]').val($('[name=dirFile]').val());
    return sisyphus.saveAllData();
  });
  return $('#gsv-generator').find('[data-parent]').each(function() {
    var $parent, $this, name;
    $this = $(this);
    $parent = $($this.attr('data-parent'));
    name = $parent.attr('name');
    return $("[name=" + name).on('change', (function(_this) {
      return function() {
        return $(_this).toggle($parent.prop('checked'));
      };
    })(this)).trigger('change');
  });
});

create = function(e) {
  var dirname, hyperlapse, index, list, suffix;
  e.preventDefault();
  updateSettings();
  dirname = settings.dir + "/" + settings.name;
  if (fs.existsSync(dirname)) {
    suffix = 2;
    while (true) {
      dirname = settings.dir + "/" + settings.name + "_" + suffix;
      if (!fs.existsSync(dirname)) {
        settings.name = settings.name + "_" + suffix;
        break;
      }
      suffix++;
    }
  }
  mkdirp.sync(dirname);
  index = tasks.length;
  $('.tasks').append("<li id='task-" + index + "'> <h1><input type='text' name='name' value='" + settings.name + "'></h1> <button class='cancel action' data-index='" + index + "'>Cancel</button> <p>mode: " + settings.method + "<br></p> <div id='map-" + index + "' style='width: 48%; height: 0; padding-top: 26%; background:gray; display: inline-block;'></div> </li>");
  hyperlapse = new GSVHyperlapse(settings.name, $("#map-" + index)[0]);
  hyperlapse.setParameters(settings);
  if (settings.method === 'direction') {
    hyperlapse.createFromDirection(settings.url);
  } else if (settings.method === 'panoid') {
    list = $.parseJSON(settings.panoid);
    hyperlapse.createFromPanoId(list);
  }
  $("#task-" + index + " .cancel").on('click', function() {
    index = $(this).attr('data-index');
    return tasks[index].cancel();
  });
  return tasks.push(hyperlapse);
};

onCancel = function() {
  var $btn, $elm, index;
  index = tasks.indexOf(this);
  $elm = $("#task-" + index);
  $btn = $('<button>delete</button><br>');
  $btn.on('click', function() {
    return $elm.remove();
  });
  return $elm.children('p').append('canceled<br>').append($btn);
};

onAnalyzeComplete = function() {
  var $elm, $p, dir, index, pano, txtPanoIds, txtReport;
  index = tasks.indexOf(this);
  $elm = $("#task-" + index);
  $p = $elm.children('p');
  $elm.children('.control').remove();
  this.name = $elm.find('[name=name]').prop('disabled', true).val();
  this.compose();
  index = tasks.indexOf(this);
  $elm = $("#task-" + index);
  $p = $elm.children('p');
  $p.append('composing..<br>');
  dir = settings.dir + "/" + this.name;
  if (this.method === GSVHyperlapseMethod.DIRECTION) {
    txtReport = "method: direction\nurl: " + this.sourceUrl + "\nstep: " + this.step + "\nsearchRadius: " + this.searchRadius;
  } else if (this.method = GSVHyperlapseMethod.PANOID) {
    txtReport = "method: panoid";
  }
  txtReport += "\nheadingMode: " + this.headingMode + "\nlookat: " + this.lookat + "\nzoom: " + this.zoom;
  txtPanoIds = JSON.stringify((function() {
    var i, len, ref, results;
    ref = this.panoList;
    results = [];
    for (i = 0, len = ref.length; i < len; i++) {
      pano = ref[i];
      results.push(pano.id);
    }
    return results;
  }).call(this));
  return mkdirp(dir, function() {
    fs.writeFile(dir + "/_report.txt", txtReport, function() {
      return $p.append('report saved<br>');
    });
    return fs.writeFile(dir + "/_pano-ids.json", txtPanoIds, function() {
      return $p.append('pano-ids.json saved<br>');
    });
  });
};

onComposeComplete = function() {
  var $elm, $p, dir, index, txtPanoList;
  index = tasks.indexOf(this);
  $elm = $("#task-" + index);
  $p = $elm.children('p');
  dir = settings.dir + "/" + this.name;
  txtPanoList = JSON.stringify(this.panoList);
  return fs.writeFile(dir + "/_pano-data.json", txtPanoList, function() {
    $p.append('pano-data.json saved<br>');
    return notifier.notify({
      title: "GSV Generator",
      message: "All done!",
      sound: true
    });
  });
};

onProgress = function(loaded, total) {
  var $elm, index;
  index = tasks.indexOf(this);
  $elm = $("#task-" + index);
  if (loaded < 1) {
    $elm.children('p').append($('<progress></progress>'));
  }
  return $elm.find("progress").last().attr({
    value: loaded,
    max: total,
    'data-label': "[" + loaded + "/" + total + "]"
  });
};

onMessage = function(message) {
  var $elm, index;
  index = tasks.indexOf(this);
  $elm = $("#task-" + index);
  return $elm.children('p').append(message + "<br>");
};

onPanoramaLoad = function(idx, pano, data) {
  var $elm, ctx, index, path, tag;
  index = tasks.indexOf(this);
  $elm = $("#task-" + index);
  canvas.width = pano.width;
  canvas.height = pano.height * V_SCALE;
  ctx = canvas.getContext('2d');
  ctx.fillStyle = '#000000';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(pano, 0, 0);
  ctx.fillStyle = '#ffffff';
  ctx.fillRect(0, pano.height + 3, 12, 3);
  tag = {
    uid: this.uid,
    id: data.id,
    heading: data.heading,
    latLng: data.latLng.toString()
  };
  CanvasMatrixCode.draw(canvas, tag, 0, pano.height + 10, canvas.width, TAG_HEIGHT - 10);
  $elm.append(canvas);
  path = settings.dir + "/" + this.name + "/" + this.name + "_" + (('000000' + idx).substr(-6, 6)) + ".png";
  return saveCanvas(canvas, path);
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdzdi1nZW5lcmF0b3IuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLElBQUE7O0FBQUEsT0FBQSxHQUFVOztBQUNWLGdCQUFBLEdBQW1COztBQUluQixNQUFBLEdBQVM7O0FBQ1QsVUFBQSxHQUFpQixJQUFBLE1BQU0sQ0FBQyxJQUFJLENBQUMsaUJBQVosQ0FBOEIsRUFBOUI7O0FBR2pCLEdBQUEsR0FBTTs7QUFFTixNQUFBLEdBQVM7O0FBQ1QsT0FBQSxHQUFVOztBQUNWLFNBQUEsR0FBWTs7QUFFWixNQUFBLEdBQVM7O0FBRVQsS0FBQSxHQUFROztBQUVSLFFBQUEsR0FBVzs7QUFFWCxPQUFBLEdBQVU7O0FBS1YsY0FBQSxHQUFpQixTQUFBO0VBQ2hCLENBQUEsQ0FBRSxnQkFBRixDQUFtQixDQUFDLElBQXBCLENBQXlCLGlCQUF6QixDQUEyQyxDQUFDLElBQTVDLENBQWlELFNBQUE7QUFDaEQsUUFBQTtJQUFBLElBQUEsR0FBTyxDQUFBLENBQUUsSUFBRixDQUFPLENBQUMsSUFBUixDQUFhLE1BQWI7SUFDUCxJQUFHLElBQUEsS0FBUSxVQUFYO01BQ0MsUUFBUyxDQUFBLElBQUksQ0FBQyxJQUFMLENBQVQsR0FBc0IsQ0FBQSxDQUFFLElBQUYsQ0FBTyxDQUFDLEVBQVIsQ0FBVyxVQUFYLEVBRHZCO0tBQUEsTUFFSyxJQUFHLElBQUEsS0FBUSxPQUFYO01BQ0osSUFBRyxDQUFBLENBQUUsSUFBRixDQUFPLENBQUMsRUFBUixDQUFXLFVBQVgsQ0FBSDtRQUNDLFFBQVMsQ0FBQSxJQUFJLENBQUMsSUFBTCxDQUFULEdBQXNCLENBQUEsQ0FBRSxJQUFGLENBQU8sQ0FBQyxHQUFSLENBQUEsRUFEdkI7T0FESTtLQUFBLE1BQUE7TUFJSixRQUFTLENBQUEsSUFBSSxDQUFDLElBQUwsQ0FBVCxHQUFzQixDQUFBLENBQUUsSUFBRixDQUFPLENBQUMsR0FBUixDQUFBLEVBSmxCOztBQUtMLFdBQU87RUFUeUMsQ0FBakQ7QUFEZ0I7O0FBZ0Jq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QUFBLEVBQUssSUFBQyxDQUFBLEdBQU47SUFDQSxFQUFBLEVBQUksSUFBSSxDQUFDLEVBRFQ7SUFFQSxPQUFBLEVBQVMsSUFBSSxDQUFDLE9BRmQ7SUFHQSxNQUFBLEVBQVEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFaLENBQUEsQ0FIUjs7RUFLRCxnQkFBZ0IsQ0FBQyxJQUFqQixDQUFzQixNQUF0QixFQUE4QixHQUE5QixFQUFtQyxDQUFuQyxFQUFzQyxJQUFJLENBQUMsTUFBTCxHQUFjLEVBQXBELEVBQXdELE1BQU0sQ0FBQyxLQUEvRCxFQUFzRSxVQUFBLEdBQWEsRUFBbkY7RUFLQSxJQUFJLENBQUMsTUFBTCxDQUFZLE1BQVo7RUFFQSxJQUFBLEdBQVUsUUFBUSxDQUFDLEdBQVYsR0FBYyxHQUFkLEdBQWlCLElBQUMsQ0FBQSxJQUFsQixHQUF1QixHQUF2QixHQUEwQixJQUFDLENBQUEsSUFBM0IsR0FBZ0MsR0FBaEMsR0FBa0MsQ0FBQyxDQUFDLFFBQUEsR0FBVyxHQUFaLENBQWdCLENBQUMsTUFBakIsQ0FBd0IsQ0FBQyxDQUF6QixFQUE0QixDQUE1QixDQUFELENBQWxDLEdBQWtFO1NBRTNFLFVBQUEsQ0FBVyxNQUFYLEVBQW1CLElBQW5CO0FBaENnQiIsImZpbGUiOiJnc3YtZ2VuZXJhdG9yLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuIyBjb25zdGFudHNcbk1BWF9QVFMgPSAxMDBcbkRJU1RfQkVUV0VFTl9QVFMgPSA1XG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiMgdmFyaWFibGVzXG5sb2FkZXIgPSBudWxsXG5kaXJTZXJ2aWNlID0gbmV3IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNTZXJ2aWNlKHt9KVxuXG4jIGVhY2ggcmVzXG5yZXMgPSBudWxsXG5cbnJhd1B0cyA9IFtdXG5wYW5vSWRzID0gW11cbnRvdGFsRGlzdCA9IDBcblxuY2FudmFzID0gbnVsbFxuXG50YXNrcyA9IFtdXG5cbnNldHRpbmdzID0ge31cblxuc3RvcmFnZSA9IGxvY2FsU3RvcmFnZVxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jIGZ1bmN0aW9uc1xuXG51cGRhdGVTZXR0aW5ncyA9IC0+XG5cdCQoJyNnc3YtZ2VuZXJhdG9yJykuZmluZCgnaW5wdXQsIHRleHRhcmVhJykuZWFjaCAtPlxuXHRcdHR5cGUgPSAkKHRoaXMpLmF0dHIoJ3R5cGUnKVxuXHRcdGlmIHR5cGUgPT0gJ2NoZWNrYm94J1xuXHRcdFx0c2V0dGluZ3NbdGhpcy5uYW1lXSA9ICQodGhpcykuaXMoJzpjaGVja2VkJylcblx0XHRlbHNlIGlmIHR5cGUgPT0gJ3JhZGlvJ1xuXHRcdFx0aWYgJCh0aGlzKS5pcygnOmNoZWNrZWQnKVxuXHRcdFx0XHRzZXR0aW5nc1t0aGlzLm5hbWVdID0gJCh0aGlzKS52YWwoKVxuXHRcdGVsc2Vcblx0XHRcdHNldHRpbmdzW3RoaXMubmFtZV0gPSAkKHRoaXMpLnZhbCgpXG5cdFx0cmV0dXJuIHRydWVcblx0cmV0dXJuXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiMgb24gbG9hZFxuXG5zaXN5cGh1cyA9IG51bGxcblxuJCAtPlxuXHRjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKVxuXG5cdCQoJyNjcmVhdGUnKS5vbiAnY2xpY2snLCBjcmVhdGVcblxuXHRHU1ZIeXBlcmxhcHNlLm9uTWVzc2FnZSA9IG9uTWVzc2FnZVxuXHRHU1ZIeXBlcmxhcHNlLm9uUGFub3JhbWFMb2FkID0gb25QYW5vcmFtYUxvYWRcblx0R1NWSHlwZXJsYXBzZS5vblByb2dyZXNzID0gb25Qcm9ncmVzc1xuXHRHU1ZIeXBlcmxhcHNlLm9uQW5hbHl6ZUNvbXBsZXRlID0gb25BbmFseXplQ29tcGxldGVcblx0R1NWSHlwZXJsYXBzZS5vbkNvbXBvc2VDb21wbGV0ZSA9IG9uQ29tcG9zZUNvbXBsZXRlXG5cdEdTVkh5cGVybGFwc2Uub25DYW5jZWwgPSBvbkNhbmNlbFxuXG5cdHNpc3lwaHVzID0gJCgnI2dzdi1nZW5lcmF0b3InKS5zaXN5cGh1cygpXG5cblx0JCgnW25hbWU9ZGlyRmlsZV0nKS5vbiAnY2hhbmdlJywgLT5cblx0XHQkKCdbbmFtZT1kaXJdJykudmFsKCAkKCdbbmFtZT1kaXJGaWxlXScpLnZhbCgpIClcblx0XHRzaXN5cGh1cy5zYXZlQWxsRGF0YSgpXG5cblx0JCgnI2dzdi1nZW5lcmF0b3InKS5maW5kKCdbZGF0YS1wYXJlbnRdJykuZWFjaCAtPlxuXG5cdFx0JHRoaXMgPSAkKEApXG5cdFx0JHBhcmVudCA9ICQoICR0aGlzLmF0dHIoJ2RhdGEtcGFyZW50JykgKVxuXHRcdG5hbWUgPSAkcGFyZW50LmF0dHIoJ25hbWUnKVxuXG5cdFx0JChcIltuYW1lPSN7bmFtZX1cIikub24gJ2NoYW5nZScsID0+XG5cdFx0XHQkKEApLnRvZ2dsZSggJHBhcmVudC5wcm9wKCdjaGVja2VkJykgKVxuXHRcdC50cmlnZ2VyKCdjaGFuZ2UnKVxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5jcmVhdGUgPSAoZSktPlxuXHRlLnByZXZlbnREZWZhdWx0KClcblxuXHR1cGRhdGVTZXR0aW5ncygpXG5cblx0ZGlybmFtZSA9IFwiI3tzZXR0aW5ncy5kaXJ9LyN7c2V0dGluZ3MubmFtZX1cIlxuXHRpZiBmcy5leGlzdHNTeW5jKGRpcm5hbWUpXG5cblx0XHRzdWZmaXggPSAyXG5cdFx0bG9vcFxuXHRcdFx0ZGlybmFtZSA9IFwiI3tzZXR0aW5ncy5kaXJ9LyN7c2V0dGluZ3MubmFtZX1fI3tzdWZmaXh9XCJcblx0XHRcdGlmICFmcy5leGlzdHNTeW5jKGRpcm5hbWUpXG5cdFx0XHRcdHNldHRpbmdzLm5hbWUgPSBcIiN7c2V0dGluZ3MubmFtZX1fI3tzdWZmaXh9XCJcblx0XHRcdFx0YnJlYWtcblx0XHRcdHN1ZmZpeCsrXG5cblx0bWtkaXJwLnN5bmMoZGlybmFtZSlcblxuXHRpbmRleCA9IHRhc2tzLmxlbmd0aFxuXG5cdCQoJy50YXNrcycpLmFwcGVuZChcIlxuXHRcdDxsaSBpZD0ndGFzay0je2luZGV4fSc+XG5cdFx0XHQ8aDE+PGlucHV0IHR5cGU9J3RleHQnIG5hbWU9J25hbWUnIHZhbHVlPScje3NldHRpbmdzLm5hbWV9Jz48L2gxPlxuXHRcdFx0PGJ1dHRvbiBjbGFzcz0nY2FuY2VsIGFjdGlvbicgZGF0YS1pbmRleD0nI3tpbmRleH0nPkNhbmNlbDwvYnV0dG9uPlxuXHRcdFx0PHA+bW9kZTogI3tzZXR0aW5ncy5tZXRob2R9PGJyPjwvcD5cblx0XHRcdDxkaXYgaWQ9J21hcC0je2luZGV4fScgc3R5bGU9J3dpZHRoOiA0OCU7IGhlaWdodDogMDsgcGFkZGluZy10b3A6IDI2JTsgYmFja2dyb3VuZDpncmF5OyBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7Jz48L2Rpdj5cblx0XHQ8L2xpPlxuXHRcIilcblxuXHRoeXBlcmxhcHNlID0gbmV3IEdTVkh5cGVybGFwc2Uoc2V0dGluZ3MubmFtZSwgJChcIiNtYXAtI3tpbmRleH1cIilbMF0pXG5cdGh5cGVybGFwc2Uuc2V0UGFyYW1ldGVycyhzZXR0aW5ncylcblxuXHRpZiBzZXR0aW5ncy5tZXRob2QgPT0gJ2RpcmVjdGlvbidcblx0XHRoeXBlcmxhcHNlLmNyZWF0ZUZyb21EaXJlY3Rpb24oIHNldHRpbmdzLnVybCApXG5cblx0ZWxzZSBpZiBzZXR0aW5ncy5tZXRob2QgPT0gJ3Bhbm9pZCdcblx0XHRsaXN0ID0gJC5wYXJzZUpTT04oIHNldHRpbmdzLnBhbm9pZCApXG5cdFx0aHlwZXJsYXBzZS5jcmVhdGVGcm9tUGFub0lkKGxpc3QpXG5cblx0JChcIiN0YXNrLSN7aW5kZXh9IC5jYW5jZWxcIikub24gJ2NsaWNrJywgLT5cblx0XHRpbmRleCA9ICQoQCkuYXR0cignZGF0YS1pbmRleCcpXG5cdFx0dGFza3NbaW5kZXhdLmNhbmNlbCgpXG5cblx0dGFza3MucHVzaCggaHlwZXJsYXBzZSApXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbm9uQ2FuY2VsID0gLT5cblx0aW5kZXggPSB0YXNrcy5pbmRleE9mKCBAIClcblx0JGVsbSA9ICQoXCIjdGFzay0je2luZGV4fVwiKVxuXG5cdCRidG4gPSAkKCc8YnV0dG9uPmRlbGV0ZTwvYnV0dG9uPjxicj4nKTtcblxuXHQkYnRuLm9uICdjbGljaycsIC0+XG5cdFx0JGVsbS5yZW1vdmUoKTtcblxuXHQkZWxtLmNoaWxkcmVuKCdwJylcblx0XHQuYXBwZW5kKCdjYW5jZWxlZDxicj4nKVxuXHRcdC5hcHBlbmQoICRidG4gKTtcblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxub25BbmFseXplQ29tcGxldGUgPSAtPlxuXHRpbmRleCA9IHRhc2tzLmluZGV4T2YoIEAgKVxuXHQkZWxtID0gJChcIiN0YXNrLSN7aW5kZXh9XCIpXG5cdCRwID0gJGVsbS5jaGlsZHJlbigncCcpXG5cblx0JGVsbS5jaGlsZHJlbignLmNvbnRyb2wnKS5yZW1vdmUoKVxuXHRAbmFtZSA9ICRlbG0uZmluZCgnW25hbWU9bmFtZV0nKS5wcm9wKCdkaXNhYmxlZCcsIHRydWUpLnZhbCgpXG5cdEBjb21wb3NlKClcblxuXHQjIHNhdmUgZGF0YVxuXHRpbmRleCA9IHRhc2tzLmluZGV4T2YoIEAgKVxuXHQkZWxtID0gJChcIiN0YXNrLSN7aW5kZXh9XCIpXG5cdCRwID0gJGVsbS5jaGlsZHJlbigncCcpXG5cblx0JHAuYXBwZW5kKCdjb21wb3NpbmcuLjxicj4nKVxuXG5cdGRpciA9IFwiI3tzZXR0aW5ncy5kaXJ9LyN7QG5hbWV9XCJcblxuXHRpZiBAbWV0aG9kID09IEdTVkh5cGVybGFwc2VNZXRob2QuRElSRUNUSU9OXG5cdFx0dHh0UmVwb3J0ID0gXCJcIlwiXG5cdFx0XHRcdFx0bWV0aG9kOiBkaXJlY3Rpb25cblx0XHRcdFx0XHR1cmw6ICN7QHNvdXJjZVVybH1cblx0XHRcdFx0XHRzdGVwOiAje0BzdGVwfVxuXHRcdFx0XHRcdHNlYXJjaFJhZGl1czogI3tAc2VhcmNoUmFkaXVzfVxuXHRcdFx0XHRcdFwiXCJcIlxuXHRlbHNlIGlmIEBtZXRob2QgPSBHU1ZIeXBlcmxhcHNlTWV0aG9kLlBBTk9JRCBcblx0XHR0eHRSZXBvcnQgPSBcIm1ldGhvZDogcGFub2lkXCJcblxuXHR0eHRSZXBvcnQgKz0gXCJcIlwiXG5cblx0XHRcdFx0IGhlYWRpbmdNb2RlOiAje0BoZWFkaW5nTW9kZX1cblx0XHRcdFx0IGxvb2thdDogI3tAbG9va2F0fVxuXHRcdFx0XHQgem9vbTogI3tAem9vbX1cblx0XHRcdFx0IFwiXCJcIlxuXG5cdHR4dFBhbm9JZHMgPSBKU09OLnN0cmluZ2lmeSggKHBhbm8uaWQgZm9yIHBhbm8gaW4gQHBhbm9MaXN0KSApXG5cblx0bWtkaXJwIGRpciwgLT5cblx0XHRmcy53cml0ZUZpbGUgXCIje2Rpcn0vX3JlcG9ydC50eHRcIiwgdHh0UmVwb3J0LCAtPlxuXHRcdFx0JHAuYXBwZW5kKCdyZXBvcnQgc2F2ZWQ8YnI+JylcblxuXHRcdGZzLndyaXRlRmlsZSBcIiN7ZGlyfS9fcGFuby1pZHMuanNvblwiLCB0eHRQYW5vSWRzLCAtPlxuXHRcdFx0JHAuYXBwZW5kKCdwYW5vLWlkcy5qc29uIHNhdmVkPGJyPicpXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbm9uQ29tcG9zZUNvbXBsZXRlID0gLT5cblx0aW5kZXggPSB0YXNrcy5pbmRleE9mKCBAIClcblx0JGVsbSA9ICQoXCIjdGFzay0je2luZGV4fVwiKVxuXHQkcCA9ICRlbG0uY2hpbGRyZW4oJ3AnKVxuXG5cdGRpciA9IFwiI3tzZXR0aW5ncy5kaXJ9LyN7QG5hbWV9XCJcblx0dHh0UGFub0xpc3QgPSBKU09OLnN0cmluZ2lmeSggQHBhbm9MaXN0IClcblxuXHRmcy53cml0ZUZpbGUgXCIje2Rpcn0vX3Bhbm8tZGF0YS5qc29uXCIsIHR4dFBhbm9MaXN0LCAtPlxuXHRcdCRwLmFwcGVuZCgncGFuby1kYXRhLmpzb24gc2F2ZWQ8YnI+JylcblxuXHRcdG5vdGlmaWVyLm5vdGlmeVxuXHRcdFx0dGl0bGU6IFwiR1NWIEdlbmVyYXRvclwiXG5cdFx0XHRtZXNzYWdlOiBcIkFsbCBkb25lIVwiXG5cdFx0XHRzb3VuZDogdHJ1ZVxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5vblByb2dyZXNzID0gKGxvYWRlZCwgdG90YWwpIC0+XG5cdGluZGV4ID0gdGFza3MuaW5kZXhPZiggQCApXG5cdCRlbG0gPSAkKFwiI3Rhc2stI3tpbmRleH1cIilcblxuXHRpZiBsb2FkZWQgPCAxXG5cdFx0JGVsbS5jaGlsZHJlbigncCcpLmFwcGVuZCggJCgnPHByb2dyZXNzPjwvcHJvZ3Jlc3M+JykpXG5cblx0JGVsbS5maW5kKFwicHJvZ3Jlc3NcIikubGFzdCgpXG5cdFx0LmF0dHJcblx0XHRcdHZhbHVlOiBsb2FkZWRcblx0XHRcdG1heDogdG90YWxcblx0XHRcdCdkYXRhLWxhYmVsJzogIFwiWyN7bG9hZGVkfS8je3RvdGFsfV1cIlxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5vbk1lc3NhZ2UgPSAobWVzc2FnZSkgLT5cblx0aW5kZXggPSB0YXNrcy5pbmRleE9mKCBAIClcblx0JGVsbSA9ICQoXCIjdGFzay0je2luZGV4fVwiKVxuXG5cdCRlbG0uY2hpbGRyZW4oJ3AnKS5hcHBlbmQoIG1lc3NhZ2UgKyBcIjxicj5cIiApXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbm9uUGFub3JhbWFMb2FkID0gKGlkeCwgcGFubywgZGF0YSkgLT5cblx0aW5kZXggPSB0YXNrcy5pbmRleE9mKCBAIClcblx0JGVsbSA9ICQoXCIjdGFzay0je2luZGV4fVwiKVxuXG5cdGNhbnZhcy53aWR0aCA9IHBhbm8ud2lkdGhcblx0Y2FudmFzLmhlaWdodCA9IHBhbm8uaGVpZ2h0ICogVl9TQ0FMRVxuXG5cdGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpXG5cdGN0eC5maWxsU3R5bGUgPSAnIzAwMDAwMCdcblx0Y3R4LmZpbGxSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodClcblx0Y3R4LmRyYXdJbWFnZShwYW5vLCAwLCAwKVxuXG5cdCMgaGVhZGluZyBtYXJrZXJcblx0Y3R4LmZpbGxTdHlsZSA9ICcjZmZmZmZmJ1xuXHRjdHguZmlsbFJlY3QoMCwgcGFuby5oZWlnaHQgKyAzLCAxMiwgMylcblxuXHQjIGNvZGVcblx0dGFnID1cblx0XHR1aWQ6IEB1aWRcblx0XHRpZDogZGF0YS5pZFxuXHRcdGhlYWRpbmc6IGRhdGEuaGVhZGluZ1xuXHRcdGxhdExuZzogZGF0YS5sYXRMbmcudG9TdHJpbmcoKVxuXHRcblx0Q2FudmFzTWF0cml4Q29kZS5kcmF3KGNhbnZhcywgdGFnLCAwLCBwYW5vLmhlaWdodCArIDEwLCBjYW52YXMud2lkdGgsIFRBR19IRUlHSFQgLSAxMClcblxuXG5cblxuXHQkZWxtLmFwcGVuZChjYW52YXMpXG5cblx0cGF0aCA9IFwiI3tzZXR0aW5ncy5kaXJ9LyN7QG5hbWV9LyN7QG5hbWV9XyN7KCcwMDAwMDAnICsgaWR4KS5zdWJzdHIoLTYsIDYpfS5wbmdcIlxuXG5cdHNhdmVDYW52YXMoY2FudmFzLCBwYXRoKSJdfQ==