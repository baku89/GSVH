var $console, $progPano, $progSeq, $statPano, $statSeq, TAG_WIDTH, bFlip, basename, changedList, convertLatLng, destDir, fileList, gsvh, gsvp, img, load, onComplete, outCanvas, outCtx, panoJson, sisyphus, srcCanvas, srcCtx, srcDir, ss, start, startTime, tagCanvas, tagCtx;

$console = null;

$progPano = null;

$statPano = null;

$progSeq = null;

$statSeq = null;

srcDir = "";

destDir = "";

fileList = null;

gsvh = null;

basename = null;

sisyphus = null;

gsvp = null;

startTime = null;

changedList = [];

ss = new google.maps.StreetViewService();

tagCanvas = tagCtx = null;

bFlip = false;

img = null;

srcCanvas = outCanvas = tagCanvas = null;

srcCtx = outCtx = tagCanvas = null;

TAG_WIDTH = 1664;

panoJson = {};

$(function() {
  $console = $('#console');
  $progPano = $('#prog-pano');
  $progSeq = $('#prog-seq');
  $statPano = $('#stat-pano');
  $statSeq = $('#stat-seq');
  sisyphus = $('#replace-proxy').sisyphus();
  $('#decode').on('click', start);
  $('[name=file]').on('change', function() {
    $('[name=source]').val($('[name=file]').val());
    return sisyphus.saveAllData();
  });
  gsvp = new GSVPANO.PanoLoader({
    zoom: parseInt($('[name=zoom]').val())
  });
  gsvp.onProgress = function(p) {
    $statPano.html(p + "%");
    return $progPano.val(p);
  };
  img = new Image();
  srcCanvas = document.createElement('canvas');
  outCanvas = document.createElement('canvas');
  tagCanvas = $('#tag')[0];
  srcCtx = srcCanvas.getContext('2d');
  outCtx = outCanvas.getContext('2d');
  return tagCtx = tagCanvas.getContext('2d');
});

start = function() {
  var f, files, zoom;
  srcDir = $('[name=source]').val();
  if (srcDir === "") {
    alert("please select source directory");
    return;
  }
  files = fs.readdirSync(srcDir);
  fileList = (function() {
    var j, len, results;
    results = [];
    for (j = 0, len = files.length; j < len; j++) {
      f = files[j];
      if (/.png$/.test(f) && f.substr(0, 4) !== "tag_") {
        results.push(f);
      }
    }
    return results;
  })();
  basename = path.basename(srcDir);
  zoom = parseInt($('[name=zoom').val());
  gsvp.setZoom(zoom);
  return load();
};

load = function() {
  var bChanged, filename, idx, loadImg, onLoadImg, pano, saveAndNext;
  startTime = new Date();
  bChanged = false;
  idx = 0;
  filename = "";
  pano = null;
  bFlip = false;
  console.log(fileList);
  loadImg = function() {
    filename = fileList[idx];
    return img.src = "file://" + srcDir + "/" + filename;
  };
  onLoadImg = function() {
    var h, headingOffset, i, j, latLng, pixel, pt, ref, w, x;
    w = img.width;
    h = img.height;
    srcCanvas.width = img.width;
    srcCanvas.height = img.height;
    srcCtx.drawImage(img, 0, 0);
    headingOffset = 0;
    x = 0;
    for (i = j = 0, ref = TAG_WIDTH - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {
      pixel = srcCtx.getImageData(i, h - TAG_HEIGHT + 3, 1, 1).data;
      if (pixel[0] >= 128) {
        x = i;
        headingOffset = (x / TAG_WIDTH) * 360;
        break;
      }
    }
    pt = {
      x: (TAG_WIDTH + x - 3) % TAG_WIDTH,
      y: h - TAG_HEIGHT + 10
    };
    console.log(pt);
    pixel = srcCtx.getImageData(pt.x, pt.y, 1, 1).data;
    if (pixel[0] > 128) {
      bFlip = true;
      x = TAG_WIDTH - (x + 12);
      headingOffset = (x / TAG_WIDTH) * 360;
    } else {
      bFlip = false;
    }
    tagCanvas.width = TAG_WIDTH;
    tagCanvas.height = TAG_HEIGHT;
    if (bFlip) {
      tagCtx.save();
      tagCtx.translate(TAG_WIDTH, 0);
      tagCtx.scale(-1, 1);
      tagCtx.drawImage(img, 0, h - TAG_HEIGHT, TAG_WIDTH, TAG_HEIGHT, x, 0, TAG_WIDTH, TAG_HEIGHT);
      tagCtx.drawImage(img, 0, h - TAG_HEIGHT, TAG_WIDTH, TAG_HEIGHT, x - TAG_WIDTH, 0, TAG_WIDTH, TAG_HEIGHT);
      tagCtx.restore();
    } else {
      tagCtx.drawImage(img, 0, h - TAG_HEIGHT, TAG_WIDTH, TAG_HEIGHT, -x, 0, TAG_WIDTH, TAG_HEIGHT);
      tagCtx.drawImage(img, 0, h - TAG_HEIGHT, TAG_WIDTH, TAG_HEIGHT, -x + TAG_WIDTH, 0, TAG_WIDTH, TAG_HEIGHT);
    }
    console.log(bFlip, x);
    pano = CanvasMatrixCode.decode(tagCanvas, 0, 10, TAG_WIDTH, TAG_HEIGHT - 10);
    if (pano === null) {
      saveAndNext();
      return;
    }
    console.log(pano);
    latLng = convertLatLng(pano.latLng);
    pano.latLng = {
      lat: latLng.lat(),
      lng: latLng.lng()
    };
    return ss.getPanoramaById(pano.id, function(data, status) {
      if (status === google.maps.StreetViewStatus.OK) {
        pano.changed = false;
        return saveAndNext();
      } else {
        bChanged = true;
        return searchNearestPano(latLng, function(newId, newLatLng, dist) {
          console.log(newLatLng, newId, dist);
          pano.changed = true;
          pano.id = newId;
          pano.latLng = {
            lat: newLatLng.lat(),
            lng: newLatLng.lng()
          };
          console.log("changed:" + filename + ", nearest pano: " + pano.id + " -> " + newId + ", distance from original: " + dist);
          return saveAndNext();
        });
      }
    });
  };
  saveAndNext = function() {
    panoJson[filename] = pano;
    if (++idx < fileList.length) {
      return loadImg();
    } else {
      return onComplete();
    }
  };
  img.onload = onLoadImg;
  return loadImg();
};

convertLatLng = function(latLngStr) {
  var result;
  if (latLngStr.lat != null) {
    return latLngStr;
  } else {
    result = /([\-0-9.]+), ([\-0-9.]+)/.exec(latLngStr);
    return new google.maps.LatLng(result[1], result[2]);
  }
};

onComplete = function() {
  var txt;
  console.log(panoJson);
  txt = JSON.stringify(panoJson);
  fs.writeFileSync(srcDir + "/_pano-list.json", txt);
  return notifier.notify({
    title: "Proxy Replacer",
    message: "All done!",
    sound: true
  });
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcS1yZXBsYWNlci5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBQTs7QUFBQSxRQUFBLEdBQVc7O0FBQ1gsU0FBQSxHQUFZOztBQUNaLFNBQUEsR0FBWTs7QUFDWixRQUFBLEdBQVc7O0FBQ1gsUUFBQSxHQUFXOztBQUVYLE1BQUEsR0FBUzs7QUFDVCxPQUFBLEdBQVU7O0FBQ1YsUUFBQSxHQUFXOztBQUVYLElBQUEsR0FBTzs7QUFFUCxRQUFBLEdBQVc7O0FBQ1gsUUFBQSxHQUFXOztBQUVYLElBQUEsR0FBTzs7QUFFUCxTQUFBLEdBQVk7O0FBRVosV0FBQSxHQUFjOztBQUVkLEVBQUEsR0FBUyxJQUFBLE1BQU0sQ0FBQyxJQUFJLENBQUMsaUJBQVosQ0FBQTs7QUFFVCxTQUFBLEdBQVksTUFBQSxHQUFTOztBQUNyQixLQUFBLEdBQVE7O0FBRVIsR0FBQSxHQUFNOztBQUVOLFNBQUEsR0FDQSxTQUFBLEdBQ0EsU0FBQSxHQUFZOztBQUVaLE1BQUEsR0FDQSxNQUFBLEdBQ0EsU0FBQSxHQUFZOztBQUVaLFNBQUEsR0FBWTs7QUFFWixRQUFBLEdBQVc7O0FBRVgsQ0FBQSxDQUFFLFNBQUE7RUFDRCxRQUFBLEdBQVcsQ0FBQSxDQUFFLFVBQUY7RUFDWCxTQUFBLEdBQVksQ0FBQSxDQUFFLFlBQUY7RUFDWixRQUFBLEdBQVcsQ0FBQSxDQUFFLFdBQUY7RUFDWCxTQUFBLEdBQVksQ0FBQSxDQUFFLFlBQUY7RUFDWixRQUFBLEdBQVcsQ0FBQSxDQUFFLFdBQUY7RUFFWCxRQUFBLEdBQVcsQ0FBQSxDQUFFLGdCQUFGLENBQW1CLENBQUMsUUFBcEIsQ0FBQTtFQUVYLENBQUEsQ0FBRSxTQUFGLENBQVksQ0FBQyxFQUFiLENBQWdCLE9BQWhCLEVBQXlCLEtBQXpCO0VBRUEsQ0FBQSxDQUFFLGFBQUYsQ0FBZ0IsQ0FBQyxFQUFqQixDQUFvQixRQUFwQixFQUE4QixTQUFBO0lBQzdCLENBQUEsQ0FBRSxlQUFGLENBQ0MsQ0FBQyxHQURGLENB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QSxDQUFyQyxFQUpaOztBQURlOztBQVFoQixVQUFBLEdBQWEsU0FBQTtBQUVaLE1BQUE7RUFBQSxPQUFPLENBQUMsR0FBUixDQUFZLFFBQVo7RUFFQSxHQUFBLEdBQU0sSUFBSSxDQUFDLFNBQUwsQ0FBZ0IsUUFBaEI7RUFDTixFQUFFLENBQUMsYUFBSCxDQUFvQixNQUFELEdBQVEsa0JBQTNCLEVBQThDLEdBQTlDO1NBRUEsUUFBUSxDQUFDLE1BQVQsQ0FDQztJQUFBLEtBQUEsRUFBTyxnQkFBUDtJQUNBLE9BQUEsRUFBUyxXQURUO0lBRUEsS0FBQSxFQUFPLElBRlA7R0FERDtBQVBZIiwiZmlsZSI6InNlcS1yZXBsYWNlci5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIiRjb25zb2xlID0gbnVsbFxuJHByb2dQYW5vID0gbnVsbFxuJHN0YXRQYW5vID0gbnVsbFxuJHByb2dTZXEgPSBudWxsXG4kc3RhdFNlcSA9IG51bGxcblxuc3JjRGlyID0gXCJcIlxuZGVzdERpciA9IFwiXCJcbmZpbGVMaXN0ID0gbnVsbFxuXG5nc3ZoID0gbnVsbFxuXG5iYXNlbmFtZSA9IG51bGxcbnNpc3lwaHVzID0gbnVsbFxuXG5nc3ZwID0gbnVsbFxuXG5zdGFydFRpbWUgPSBudWxsXG5cbmNoYW5nZWRMaXN0ID0gW11cblxuc3MgPSBuZXcgZ29vZ2xlLm1hcHMuU3RyZWV0Vmlld1NlcnZpY2UoKVxuXG50YWdDYW52YXMgPSB0YWdDdHggPSBudWxsXG5iRmxpcCA9IGZhbHNlXG5cbmltZyA9IG51bGxcblxuc3JjQ2FudmFzID1cbm91dENhbnZhcyA9IFxudGFnQ2FudmFzID0gbnVsbFxuXG5zcmNDdHggPSBcbm91dEN0eCA9IFxudGFnQ2FudmFzID0gbnVsbFxuXG5UQUdfV0lEVEggPSAxNjY0XG5cbnBhbm9Kc29uID0ge31cblxuJCAtPlxuXHQkY29uc29sZSA9ICQoJyNjb25zb2xlJylcblx0JHByb2dQYW5vID0gJCgnI3Byb2ctcGFubycpXG5cdCRwcm9nU2VxID0gJCgnI3Byb2ctc2VxJylcblx0JHN0YXRQYW5vID0gJCgnI3N0YXQtcGFubycpXG5cdCRzdGF0U2VxID0gJCgnI3N0YXQtc2VxJylcblxuXHRzaXN5cGh1cyA9ICQoJyNyZXBsYWNlLXByb3h5Jykuc2lzeXBodXMoKVxuXG5cdCQoJyNkZWNvZGUnKS5vbiAnY2xpY2snLCBzdGFydFxuXG5cdCQoJ1tuYW1lPWZpbGVdJykub24gJ2NoYW5nZScsIC0+XG5cdFx0JCgnW25hbWU9c291cmNlXScpXG5cdFx0XHQudmFsKCAkKCdbbmFtZT1maWxlXScpLnZhbCgpIClcblx0XHRzaXN5cGh1cy5zYXZlQWxsRGF0YSgpXG5cblx0Z3N2cCA9IG5ldyBHU1ZQQU5PLlBhbm9Mb2FkZXJcblx0XHR6b29tOiBwYXJzZUludCggJCgnW25hbWU9em9vbV0nKS52YWwoKSApXG5cblx0Z3N2cC5vblByb2dyZXNzID0gKHApIC0+XG5cdFx0JHN0YXRQYW5vLmh0bWwoXCIje3B9JVwiKVxuXHRcdCRwcm9nUGFuby52YWwoIHAgKVxuXG5cblx0aW1nID0gbmV3IEltYWdlKClcblxuXHQjIHNyY0NhbnZhcyA9ICQoJyNzcmMnKVswXVxuXHRzcmNDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKVxuXHRvdXRDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKVxuXHR0YWdDYW52YXMgPSAkKCcjdGFnJylbMF1cblxuXHRzcmNDdHggPSBzcmNDYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxuXHRvdXRDdHggPSBvdXRDYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxuXHR0YWdDdHggPSB0YWdDYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5zdGFydCA9IC0+XG5cdHNyY0RpciA9ICQoJ1tuYW1lPXNvdXJjZV0nKS52YWwoKVxuXG5cdGlmIHNyY0RpciA9PSBcIlwiXG5cdFx0YWxlcnQgXCJwbGVhc2Ugc2VsZWN0IHNvdXJjZSBkaXJlY3RvcnlcIlxuXHRcdHJldHVyblxuXG5cdGZpbGVzID0gZnMucmVhZGRpclN5bmMoc3JjRGlyKVxuXG5cdGZpbGVMaXN0ID0gKGYgZm9yIGYgaW4gZmlsZXMgd2hlbiAvLnBuZyQvLnRlc3QoZikgJiYgZi5zdWJzdHIoMCwgNCkgIT0gXCJ0YWdfXCIpXG5cdGJhc2VuYW1lID0gcGF0aC5iYXNlbmFtZSggc3JjRGlyIClcblxuXHQjIGNoYW5nZSBnc3ZwIHpvb21cblx0em9vbSA9IHBhcnNlSW50KCAkKCdbbmFtZT16b29tJykudmFsKCkgKSBcblx0Z3N2cC5zZXRab29tKCB6b29tIClcblxuXHRsb2FkKClcblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxubG9hZCA9ICgpIC0+XG5cblx0c3RhcnRUaW1lID0gbmV3IERhdGUoKVxuXG5cdGJDaGFuZ2VkID0gZmFsc2VcblxuXHRpZHggPSAwXG5cdGZpbGVuYW1lID0gXCJcIlxuXG5cdHBhbm8gPSBudWxsXG5cblx0YkZsaXAgPSBmYWxzZVxuXG5cdGNvbnNvbGUubG9nIGZpbGVMaXN0XG5cblx0Iy0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdCMgMS4gbG9hZCBpbWFnZVxuXHRsb2FkSW1nID0gKCkgLT5cblx0XHQjIGVsYXBzZWQgPSAoKChuZXcgRGF0ZSgpKSAtIHN0YXJ0VGltZSkgLyAxMDAwIC8gNjApXG5cdFx0IyAkc3RhdFNlcS5odG1sKFwiKCN7aWR4KzF9LyN7ZmlsZUxpc3QubGVuZ3RofSkgI3tlbGFwc2VkLnRvUHJlY2lzaW9uKDIpfW1pbiBlbGFwc2VkXCIpXG5cdFx0IyAkcHJvZ1NlcS52YWwoIChpZHgrMSkgLyBmaWxlTGlzdC5sZW5ndGggKiAxMDAgKVxuXG5cblx0XHRmaWxlbmFtZSA9IGZpbGVMaXN0W2lkeF1cblx0XHRpbWcuc3JjID0gXCJmaWxlOi8vI3tzcmNEaXJ9LyN7ZmlsZW5hbWV9XCJcblxuXHQjLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0IyAyLiByZWFkIG1hdHJpeCBjb2RlIGFuZCBzZXR1cCBnc3ZoIGFuZCBydW4gY29tcG9zZSgpXG5cdG9uTG9hZEltZyA9IC0+XG5cblx0XHR3ID0gaW1nLndpZHRoXG5cdFx0aCA9IGltZy5oZWlnaHRcblxuXHRcdCMgcmVhZCBoZWFkaW5nIG9mZnNldFxuXHRcdHNyY0NhbnZhcy53aWR0aCA9IGltZy53aWR0aFxuXHRcdHNyY0NhbnZhcy5oZWlnaHQgPSBpbWcuaGVpZ2h0XG5cblx0XHRzcmNDdHguZHJhd0ltYWdlKGltZywgMCwgMClcblxuXHRcdGhlYWRpbmdPZmZzZXQgPSAwXG5cdFx0eCA9IDBcblx0XHRmb3IgaSBpbiBbMC4uVEFHX1dJRFRILTFdXG5cdFx0XHRwaXhlbCA9IHNyY0N0eC5nZXRJbWFnZURhdGEoaSwgaCAtIFRBR19IRUlHSFQgKyAzLCAxLCAxKS5kYXRhXG5cdFx0XHRpZiBwaXhlbFswXSA+PSAxMjhcblx0XHRcdFx0eCA9IGlcblx0XHRcdFx0aGVhZGluZ09mZnNldCA9ICh4IC8gVEFHX1dJRFRIKSAqIDM2MFxuXHRcdFx0XHRicmVha1xuXG5cdFx0IyByZWFkIGlmIGZsaXBlZFxuXHRcdHB0ID1cblx0XHRcdHg6IChUQUdfV0lEVEggKyB4IC0gMykgJSBUQUdfV0lEVEhcblx0XHRcdHk6IGggLSBUQUdfSEVJR0hUICsgMTBcblxuXHRcdGNvbnNvbGUubG9nIHB0XG5cblx0XHRwaXhlbCA9IHNyY0N0eC5nZXRJbWFnZURhdGEocHQueCwgcHQueSwgMSwgMSkuZGF0YVxuXHRcdGlmIHBpeGVsWzBdID4gMTI4XG5cdFx0XHRiRmxpcCA9IHRydWVcblx0XHRcdHggPSBUQUdfV0lEVEggLSAoeCsxMilcblx0XHRcdGhlYWRpbmdPZmZzZXQgPSAoeCAvIFRBR19XSURUSCkgKiAzNjBcblx0XHRlbHNlXG5cdFx0XHRiRmxpcCA9IGZhbHNlXG5cblx0XHQjIGZpeCB0YWcgb2Zmc2V0XG5cdFx0dGFnQ2FudmFzLndpZHRoID0gVEFHX1dJRFRIXG5cdFx0dGFnQ2FudmFzLmhlaWdodCA9IFRBR19IRUlHSFRcblxuXHRcdGlmIGJGbGlwXG5cdFx0XHR0YWdDdHguc2F2ZSgpXG5cdFx0XHR0YWdDdHgudHJhbnNsYXRlKFRBR19XSURUSCwgMClcblx0XHRcdHRhZ0N0eC5zY2FsZSgtMSwgMSlcblx0XHRcdHRhZ0N0eC5kcmF3SW1hZ2UoaW1nLFxuXHRcdFx0XHQwLCBoLSBUQUdfSEVJR0hULCBUQUdfV0lEVEgsIFRBR19IRUlHSFQsXG5cdFx0XHRcdHgsIDAsIFRBR19XSURUSCwgVEFHX0hFSUdIVClcblx0XHRcdHRhZ0N0eC5kcmF3SW1hZ2UoaW1nLFxuXHRcdFx0XHQwLCBoIC0gVEFHX0hFSUdIVCwgVEFHX1dJRFRILCBUQUdfSEVJR0hULFxuXHRcdFx0XHR4IC0gVEFHX1dJRFRILCAwLCBUQUdfV0lEVEgsIFRBR19IRUlHSFQpXG5cdFx0XHR0YWdDdHgucmVzdG9yZSgpXG5cblx0XHRlbHNlXG5cdFx0XHR0YWdDdHguZHJhd0ltYWdlKGltZyxcblx0XHRcdFx0MCwgaCAtIFRBR19IRUlHSFQsIFRBR19XSURUSCwgVEFHX0hFSUdIVCxcblx0XHRcdFx0LXgsIDAsIFRBR19XSURUSCwgVEFHX0hFSUdIVClcblx0XHRcdHRhZ0N0eC5kcmF3SW1hZ2UoaW1nLFxuXHRcdFx0XHQwLCBoIC0gVEFHX0hFSUdIVCwgVEFHX1dJRFRILCBUQUdfSEVJR0hULFxuXHRcdFx0XHQteCArIFRBR19XSURUSCwgMCwgVEFHX1dJRFRILCBUQUdfSEVJR0hUKVxuXG5cdFx0Y29uc29sZS5sb2cgYkZsaXAsIHhcblxuXHRcdCMgZGVjb2RlIHBhbm8gbWF0cml4IGNvZGVcblx0XHRwYW5vID0gQ2FudmFzTWF0cml4Q29kZS5kZWNvZGUoXG5cdFx0XHR0YWdDYW52YXMsXG5cdFx0XHQwLCAxMCxcblx0XHRcdFRBR19XSURUSCwgVEFHX0hFSUdIVCAtIDEwKVxuXG5cdFx0IyBpZiB0YWcgaXMgaW52YWxpZCwgdGhydVxuXHRcdGlmIHBhbm8gPT0gbnVsbFxuXG5cdFx0XHQjIGFsZXJ0KFwidW5jb1wiKVxuXG5cdFx0XHRzYXZlQW5kTmV4dCgpXG5cdFx0XHRyZXR1cm5cblxuXHRcdGNvbnNvbGUubG9nIHBhbm9cblxuXHRcdGxhdExuZyA9IGNvbnZlcnRMYXRMbmcoIHBhbm8ubGF0TG5nIClcblx0XHRwYW5vLmxhdExuZyA9XG5cdFx0XHRsYXQ6IGxhdExuZy5sYXQoKVxuXHRcdFx0bG5nOiBsYXRMbmcubG5nKClcblxuXG5cdFx0IyBjaGVjayBpZiB0aGUgcGFubyBpZCBpcyB2YWxpZFxuXHRcdHNzLmdldFBhbm9yYW1hQnlJZCBwYW5vLmlkLCAoZGF0YSwgc3RhdHVzKSAtPlxuXG5cdFx0XHRpZiBzdGF0dXMgPT0gZ29vZ2xlLm1hcHMuU3RyZWV0Vmlld1N0YXR1cy5PSyBcblxuXHRcdFx0XHRwYW5vLmNoYW5nZWQgPSBmYWxzZVxuXG5cdFx0XHRcdHNhdmVBbmROZXh0KClcblxuXHRcdFx0ZWxzZVxuXHRcdFx0XHRiQ2hhbmdlZCA9IHRydWVcblxuXHRcdFx0XHRzZWFyY2hOZWFyZXN0UGFubyBsYXRMbmcsIChuZXdJZCwgbmV3TGF0TG5nLCBkaXN0KS0+XG5cblx0XHRcdFx0XHRjb25zb2xlLmxvZyBuZXdMYXRMbmcsIG5ld0lkLCBkaXN0XG5cblx0XHRcdFx0XHRwYW5vLmNoYW5nZWQgPSB0cnVlXG5cdFx0XHRcdFx0IyBwYW5vLm9sZElkID0gcGFuby5pZFxuXHRcdFx0XHRcdHBhbm8uaWQgPSBuZXdJZFxuXHRcdFx0XHRcdCMgcGFuby5vbGRMYXRMbmcgPSBwYW5vLmxhdExuZ1xuXHRcdFx0XHRcdHBhbm8ubGF0TG5nID1cblx0XHRcdFx0XHRcdGxhdDogbmV3TGF0TG5nLmxhdCgpXG5cdFx0XHRcdFx0XHRsbmc6IG5ld0xhdExuZy5sbmcoKVxuXG5cdFx0XHRcdFx0Y29uc29sZS5sb2cgXCJjaGFuZ2VkOiN7ZmlsZW5hbWV9LCBuZWFyZXN0IHBhbm86ICN7cGFuby5pZH0gLT4gI3tuZXdJZH0sIGRpc3RhbmNlIGZyb20gb3JpZ2luYWw6ICN7ZGlzdH1cIlxuXG5cdFx0XHRcdFx0c2F2ZUFuZE5leHQoKVxuXHRcblxuXHQjLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0IyA0LiBuZXh0XG5cdHNhdmVBbmROZXh0ID0gLT5cblxuXHRcdHBhbm9Kc29uWyBmaWxlbmFtZSBdID0gcGFub1xuXG5cdFx0IyBvdXRDYW52YXMud2lkdGggPSBUQUdfV0lEVEhcblx0XHQjIG91dENhbnZhcy5oZWlnaHQgPSBUQUdfSEVJR0hUXG5cblx0XHQjIG91dEN0eC5maWxsU3R5bGUgPSAnIzAwMDAwMCdcblx0XHQjIG91dEN0eC5maWxsUmVjdCgwLCAwLCBUQUdfV0lEVEgsIFRBR19IRUlHSFQpXG5cblx0XHQjIENhbnZhc01hdHJpeENvZGUuZHJhdyhvdXRDYW52YXMsIHBhbm8sXG5cdFx0IyBcdDAsIDEwLCBUQUdfV0lEVEgsIFRBR19IRUlHSFQgLSAxMFxuXHRcdCMgXHQpXG5cdFx0XG5cdFx0IyBkZXN0ID0gXCIje3NyY0Rpcn0vdGFnXyN7ZmlsZW5hbWV9XCJcblx0XHQjIHNhdmVDYW52YXMoIG91dENhbnZhcywgZGVzdCApXG5cblx0XHRpZiArK2lkeCA8IGZpbGVMaXN0Lmxlbmd0aFxuXHRcdFx0bG9hZEltZygpXG5cdFx0ZWxzZVxuXHRcdFx0b25Db21wbGV0ZSgpXG5cblx0Iy0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdCMgdHJpZ2dlclxuXHRpbWcub25sb2FkID0gb25Mb2FkSW1nXG5cblx0bG9hZEltZygpXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmNvbnZlcnRMYXRMbmcgPSAobGF0TG5nU3RyKSAtPlxuXHRpZiBsYXRMbmdTdHIubGF0P1xuXHRcdHJldHVybiBsYXRMbmdTdHJcblx0ZWxzZSBcblx0XHRyZXN1bHQgPSAvKFtcXC0wLTkuXSspLCAoW1xcLTAtOS5dKykvLmV4ZWMoIGxhdExuZ1N0ciApXG5cdFx0cmV0dXJuIG5ldyBnb29nbGUubWFwcy5MYXRMbmcocmVzdWx0WzFdLCByZXN1bHRbMl0pXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbm9uQ29tcGxldGUgPSAtPlxuXG5cdGNvbnNvbGUubG9nIHBhbm9Kc29uXG5cblx0dHh0ID0gSlNPTi5zdHJpbmdpZnkoIHBhbm9Kc29uIClcblx0ZnMud3JpdGVGaWxlU3luYyhcIiN7c3JjRGlyfS9fcGFuby1saXN0Lmpzb25cIiwgdHh0KVxuXG5cdG5vdGlmaWVyLm5vdGlmeVxuXHRcdHRpdGxlOiBcIlByb3h5IFJlcGxhY2VyXCJcblx0XHRtZXNzYWdlOiBcIkFsbCBkb25lIVwiXG5cdFx0c291bmQ6IHRydWVcblxuXG5cblx0XG5cblxuIl19