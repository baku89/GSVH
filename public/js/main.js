var DIST_BETWEEN_PTS, MAX_PTS, canvas, dirService, generate, getDestLatLng, getOriginLatLng, initMap, loadPanoIds, loadPanorama, loader, mergePanoIds, panoIds, rawPts, res, setOriginLatLng, subdivide, totalDist, trace,
  slice = [].slice;

MAX_PTS = 100;

DIST_BETWEEN_PTS = 5;

loader = null;

dirService = new google.maps.DirectionsService({});

res = null;

rawPts = [];

panoIds = [];

totalDist = 0;

canvas = null;

trace = function() {
  var args;
  args = 1 <= arguments.length ? slice.call(arguments, 0) : [];
  return console.log.apply(console, args);
};

getOriginLatLng = function() {
  var originLat, originLng;
  originLat = $('#origin-lat').val();
  originLng = $('#origin-lng').val();
  return new google.maps.LatLng(originLat, originLng);
};

getDestLatLng = function() {
  var destLat, destLng;
  destLat = $('#dest-lat').val();
  destLng = $('#dest-lng').val();
  return new google.maps.LatLng(destLat, destLng);
};

setOriginLatLng = function(latLng) {
  $('#origin-lat').val(latLng.lat());
  return $('#origin-lng').val(latLng.lng());
};

initMap = function() {
  var mapOptions;
  mapOptions = {
    zoom: 1,
    center: getOriginLatLng(),
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  return google.maps.Map(document.getElementById("map"), mapOptions);
};

$(function() {
  loader = new GSVPANO.PanoLoader({
    canvas: $('#panorama')[0]
  });
  loader.setZoom(3);
  canvas = $('#panorama')[0];
  return $('#analyze-start').on('click', generate);
});

generate = function() {
  var route;
  trace("generate----------");
  rawPts = [];
  panoIds = [];
  totalDist = 0;
  route = {
    request: {
      origin: getOriginLatLng(),
      destination: getDestLatLng(),
      travelMode: google.maps.DirectionsTravelMode.DRIVING
    }
  };
  return dirService.route(route.request, function(_res, status) {
    res = _res;
    if (status === google.maps.DirectionsStatus.OK) {
      return subdivide();
    } else {
      return trace(status);
    }
  });
};

subdivide = function() {
  var a, b, d, i, j, k, l, legs, m, path, r, ref, ref1, ref2, regDist, route, segLen, segs, t, way;
  trace('subdivide----------');
  route = res.routes[0];
  path = route.overview_path;
  legs = route.legs;
  for (i = k = 0, ref = legs.length - 1; 0 <= ref ? k <= ref : k >= ref; i = 0 <= ref ? ++k : --k) {
    totalDist += legs[i].distance.value;
  }
  trace('totalDist', totalDist);
  trace('path length', path.length);
  segLen = totalDist / MAX_PTS;
  regDist = DIST_BETWEEN_PTS;
  d = 0;
  r = 0;
  a = b = null;
  for (i = l = 0, ref1 = path.length - 1; 0 <= ref1 ? l <= ref1 : l >= ref1; i = 0 <= ref1 ? ++l : --l) {
    if (i + 1 < path.length) {
      a = path[i];
      b = path[i + 1];
      d = google.maps.geometry.spherical.computeDistanceBetween(a, b);
      if ((0 < r && r < d)) {
        a - pointOnLine(r / d, a, b);
        d = google.maps.geometry.spherical.computeDistanceBetween(a, b);
        rawPts.push(a);
        r = 0;
      } else if (0 < r && d < r) {
        r -= d;
      }
      if (r === 0) {
        segs = Math.floor(d / regDist);
        if (segs > 0) {
          for (j = m = 0, ref2 = segs - 1; 0 <= ref2 ? m <= ref2 : m >= ref2; j = 0 <= ref2 ? ++m : --m) {
            t = j / segs;
            if (0 < t || (t + i) === 0) {
              way = pointOnLine(t, a, b);
              rawPts.push(way);
            }
          }
        } else {
          r = regDist * (t - (d / regDist));
        }
      }
    } else {
      rawPts.push(path[i]);
    }
  }
  trace('subdivided points length', rawPts.length);
  return loadPanoIds();
};

loadPanoIds = function() {
  var count, i, k, pt, ref, results;
  trace('loadPanoIds----------');
  pt = null;
  count = 0;
  results = [];
  for (i = k = 0, ref = rawPts.length - 1; 0 <= ref ? k <= ref : k >= ref; i = 0 <= ref ? ++k : --k) {
    panoIds.push(null);
    pt = rawPts[i];
    results.push(loader.load(i, pt, function(result) {
      panoIds[result.index] = {
        location: result.location,
        id: result.location.pano,
        imageDate: result.imageDate
      };
      if (++count >= rawPts.length) {
        return mergePanoIds();
      }
    }));
  }
  return results;
};

mergePanoIds = function() {
  var i, k, mergedPanoIds, prevId, ref;
  trace('mergePanoIds----------');
  prevId = rawPts[0].id;
  mergedPanoIds = [];
  mergedPanoIds.push(panoIds[0]);
  for (i = k = 1, ref = panoIds.length - 1; 1 <= ref ? k <= ref : k >= ref; i = 1 <= ref ? ++k : --k) {
    if (panoIds[i].id !== prevId) {
      mergedPanoIds.push(panoIds[i]);
    }
    prevId = panoIds[i].id;
  }
  trace("reduced " + panoIds.length + "->" + mergedPanoIds.length);
  panoIds = mergedPanoIds;
  return loadPanorama();
};

loadPanorama = function() {
  var TIME_OUT, failedLoadPanorama, index, loadEachPanorama, max, timerId;
  trace('loadPanorama----------');
  max = panoIds.length;
  index = 0;
  timerId = 0;
  TIME_OUT = 2000;
  loadEachPanorama = function() {
    if (index >= max) {
      alert("finish!");
      return;
    }
    trace(index, panoIds[index].id);
    timerId = setTimeout(failedLoadPanorama, TIME_OUT);
    return loader.composePanorama(panoIds[index].id);
  };
  failedLoadPanorama = function() {
    trace(index, " - time out");
    return loadEachPanorama(++index);
  };
  loader.onPanoramaLoad = function() {
    exportCanvas(canvas, 'test', index);
    clearTimeout(timerId);
    return loadEachPanorama(++index);
  };
  return loadEachPanorama(0);
};

//# sourceMappingURL=data:application/json;base64,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QkEsTUFBTSxDQUFDLGNBQVAsR0FBd0IsU0FBQSxHQUFBO0FBRXZCLElBQUEsWUFBQSxDQUFjLE1BQWQsRUFBc0IsTUFBdEIsRUFBOEIsS0FBOUIsQ0FBQSxDQUFBO0FBQUEsSUFHQSxZQUFBLENBQWMsT0FBZCxDQUhBLENBQUE7V0FJQSxnQkFBQSxDQUFrQixFQUFBLEtBQWxCLEVBTnVCO0VBQUEsQ0F0QnhCLENBQUE7U0ErQkEsZ0JBQUEsQ0FBa0IsQ0FBbEIsRUFoQ2M7QUFBQSxDQWxPZixDQUFBIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyIjLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jIGNvbnN0YW50c1xuTUFYX1BUUyA9IDEwMFxuRElTVF9CRVRXRUVOX1BUUyA9IDVcblxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jIHZhcmlhYmxlc1xubG9hZGVyID0gbnVsbFxuZGlyU2VydmljZSA9IG5ldyBnb29nbGUubWFwcy5EaXJlY3Rpb25zU2VydmljZSh7fSlcblxuIyBlYWNoIHJlc1xucmVzID0gbnVsbFxuXG5yYXdQdHMgPSBbXVxucGFub0lkcyA9IFtdXG50b3RhbERpc3QgPSAwXG5cbmNhbnZhcyA9IG51bGxcblxuIyBsb2FkZXIub25QYW5vcmFtYUxvYWQgPSAoKSAtPlxuIyBcdGNvbnNvbGUubG9nIFwiZmluaXNoZWRcIlxuIyBcdCQoJ2JvZHknKS5hcHBlbmQoIGxvYWRlci5jYW52YXMgKVxuXG5cbiMgbG9hZGVyLmxvYWQoIG5ldyBnb29nbGUubWFwcy5MYXRMbmcoIDQyLjIxNjE4OCwtNzUuNzI2NTc4NTk5OTk5OTggKSwgLT5cbiMgXHRsb2FkZXIuY29tcG9zZVBhbm9yYW1hKCBsb2FkZXIuaWQgKVxuIyApXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiMgaW5pdFxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jIGZ1bmN0aW9uc1xuXG50cmFjZSA9IChhcmdzLi4uKSAtPlxuXHRjb25zb2xlLmxvZyBhcmdzLi4uXG5cdCMgc3RyID0gXCJcIlxuXHQjIGZvciBhcmcgb2YgYXJnc1xuXHQjIFx0c3RyICs9IGFyZyArIFwiIFwiXG5cdCMgc3RyICs9IFwiXFxuXCJcblx0IyAkKCcjY29uc29sZScpLmFwcGVuZCggc3RyIClcblxuZ2V0T3JpZ2luTGF0TG5nID0gLT5cblx0b3JpZ2luTGF0IFx0PSAkKCcjb3JpZ2luLWxhdCcpLnZhbCgpXG5cdG9yaWdpbkxuZyBcdD0gJCgnI29yaWdpbi1sbmcnKS52YWwoKVxuXHRyZXR1cm4gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhvcmlnaW5MYXQsIG9yaWdpbkxuZylcblxuZ2V0RGVzdExhdExuZyA9IC0+XG5cdGRlc3RMYXQgXHQ9ICQoJyNkZXN0LWxhdCcpLnZhbCgpXG5cdGRlc3RMbmdcdFx0PSAkKCcjZGVzdC1sbmcnKS52YWwoKVxuXHRyZXR1cm4gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhkZXN0TGF0LCBkZXN0TG5nKVxuXG5zZXRPcmlnaW5MYXRMbmcgPSAobGF0TG5nKSAtPlxuXG5cdCQoJyNvcmlnaW4tbGF0JykudmFsKCBsYXRMbmcubGF0KCkgKVxuXHQkKCcjb3JpZ2luLWxuZycpLnZhbCggbGF0TG5nLmxuZygpIClcblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuIyBvbiBsb2FkXG5cbmluaXRNYXAgPSAtPlxuXHQjIG1ha2UgbWFwXG5cblx0bWFwT3B0aW9ucyA9XG5cdFx0em9vbTogMVxuXHRcdGNlbnRlcjogZ2V0T3JpZ2luTGF0TG5nKClcblx0XHRtYXBUeXBlSWQ6IGdvb2dsZS5tYXBzLk1hcFR5cGVJZC5ST0FETUFQXG5cblx0Z29vZ2xlLm1hcHMuTWFwKCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1hcFwiKSwgbWFwT3B0aW9ucyApXG5cbiQgLT5cblxuXG5cdCMgb3JpZ2luTWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG5cdCMgXHRwb3NpdGlvbjogZ2V0T3JpZ2luTGF0TG5nKClcblx0IyBcdGRyYWdnYWJsZTogdHJ1ZVxuXHQjIH0pXG5cblx0IyBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihvcmlnaW5NYXJrZXIsICdkcmFnZW5kJywgKGV2dCkgLT5cblx0IyBcdHNldE9yaWdpbkxhdExuZyggZXZ0LmxhdExuZyApXG5cdCMgKVxuXG5cdGxvYWRlciA9IG5ldyBHU1ZQQU5PLlBhbm9Mb2FkZXIoe1xuXHRcdGNhbnZhczogJCgnI3Bhbm9yYW1hJylbMF1cblx0XHR9KVxuXG5cdGxvYWRlci5zZXRab29tKCAzIClcblxuXHRjYW52YXMgPSAkKCcjcGFub3JhbWEnKVswXVxuXG5cdCQoJyNhbmFseXplLXN0YXJ0Jykub24gJ2NsaWNrJywgZ2VuZXJhdGVcblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZ2VuZXJhdGUgPSAtPlxuXG5cdHRyYWNlIFwiZ2VuZXJhdGUtLS0tLS0tLS0tXCJcblxuXHRyYXdQdHMgPSBbXVxuXHRwYW5vSWRzID0gW11cblx0dG90YWxEaXN0ID0gMFxuXG5cblx0cm91dGUgPSBcblx0XHRyZXF1ZXN0OlxuXHRcdFx0b3JpZ2luOiBnZXRPcmlnaW5MYXRMbmcoKVxuXHRcdFx0ZGVzdGluYXRpb246IGdldERlc3RMYXRMbmcoKVxuXHRcdFx0dHJhdmVsTW9kZTogZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1RyYXZlbE1vZGUuRFJJVklOR1xuXG5cdGRpclNlcnZpY2Uucm91dGUgcm91dGUucmVxdWVzdCwgKF9yZXMsIHN0YXR1cykgLT5cblx0XHRyZXMgPSBfcmVzXG5cdFx0aWYgKHN0YXR1cyA9PSBnb29nbGUubWFwcy5EaXJlY3Rpb25zU3RhdHVzLk9LKVxuXHRcdFx0IyBuZXh0XG5cdFx0XHRzdWJkaXZpZGUoKVxuXHRcdGVsc2Vcblx0XHRcdHRyYWNlIHN0YXR1c1xuXHRcblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuc3ViZGl2aWRlID0gLT5cblx0dHJhY2UgJ3N1YmRpdmlkZS0tLS0tLS0tLS0nXG5cblx0cm91dGUgXHQ9IHJlcy5yb3V0ZXNbMF1cblx0cGF0aCBcdD0gcm91dGUub3ZlcnZpZXdfcGF0aFxuXHRsZWdzIFx0PSByb3V0ZS5sZWdzXG5cblxuXHRmb3IgaSBpbiBbMC4ubGVncy5sZW5ndGgtMV1cblx0XHR0b3RhbERpc3QgKz0gbGVnc1tpXS5kaXN0YW5jZS52YWx1ZVxuXG5cdHRyYWNlICd0b3RhbERpc3QnLCB0b3RhbERpc3Rcblx0dHJhY2UgJ3BhdGggbGVuZ3RoJywgcGF0aC5sZW5ndGhcblxuXHRzZWdMZW4gPSB0b3RhbERpc3QgLyBNQVhfUFRTXG5cdHJlZ0Rpc3QgPSBESVNUX0JFVFdFRU5fUFRTI01hdGgubWF4KCBESVNUX0JFVFdFRU5fUFRTLCBzZWdMZW4gKVxuXG5cdGQgPSAwXG5cdHIgPSAwXG5cdGEgPSBiID0gbnVsbFxuXG5cdGZvciBpIGluIFswLi5wYXRoLmxlbmd0aC0xXVxuXG5cdFx0aWYgaSsxIDwgcGF0aC5sZW5ndGggIyBiZWdpbm5pbmcgfiBkZXN0aW5hdGlvbiBwb2ludCAtIDFcblxuXHRcdFx0YSA9IHBhdGhbaV1cblx0XHRcdGIgPSBwYXRoW2krMV1cblx0XHRcdGQgPSBnb29nbGUubWFwcy5nZW9tZXRyeS5zcGhlcmljYWwuY29tcHV0ZURpc3RhbmNlQmV0d2VlbihhLCBiKVxuXG5cdFx0XHRpZiAwIDwgciA8IGRcblx0XHRcdFx0YSAtIHBvaW50T25MaW5lKHIvZCwgYSwgYilcblx0XHRcdFx0ZCA9IGdvb2dsZS5tYXBzLmdlb21ldHJ5LnNwaGVyaWNhbC5jb21wdXRlRGlzdGFuY2VCZXR3ZWVuKGEsIGIpXG5cdFx0XHRcdHJhd1B0cy5wdXNoKCBhIClcblxuXHRcdFx0XHRyID0gMFxuXG5cdFx0XHRlbHNlIGlmIDAgPCByICYmIGQgPCByXG5cdFx0XHRcdHIgLT0gZFxuXG5cdFx0XHRpZiByID09IDBcblxuXHRcdFx0XHQjIG51bWJlciBvZiBzdWJkaXZpZGluZyB0aGlzIHBhdGhcblx0XHRcdFx0c2VncyA9IE1hdGguZmxvb3IoIGQgLyByZWdEaXN0IClcblxuXHRcdFx0XHQjIGFkZCBzdWJkaXZpZGVkIHBvaW50cyB0byByYXdQdHNcblx0XHRcdFx0aWYgc2VncyA+IDBcblx0XHRcdFx0XHRmb3IgaiBpbiBbMC4uc2Vncy0xXVxuXHRcdFx0XHRcdFx0dCA9IGogLyBzZWdzXG5cblx0XHRcdFx0XHRcdGlmIDAgPCB0IHx8ICh0K2kpID09IDAgIyBub3Qgc3RhcnQgcG9pbnRcblx0XHRcdFx0XHRcdFx0d2F5ID0gcG9pbnRPbkxpbmUodCwgYSwgYilcblx0XHRcdFx0XHRcdFx0cmF3UHRzLnB1c2goIHdheSApXG5cblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdHIgPSByZWdEaXN0ICogKCB0IC0gKGQvcmVnRGlzdCkgKVxuXG5cdFx0ZWxzZSAjIGRlc3RpbmF0aW9uIHBvaW50XG5cdFx0XHRyYXdQdHMucHVzaCggcGF0aFtpXSApXG5cblx0dHJhY2UgJ3N1YmRpdmlkZWQgcG9pbnRzIGxlbmd0aCcsIHJhd1B0cy5sZW5ndGhcblxuXHQjIG5leHRcblx0bG9hZFBhbm9JZHMoKVxuXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmxvYWRQYW5vSWRzID0gLT5cblx0dHJhY2UgJ2xvYWRQYW5vSWRzLS0tLS0tLS0tLSdcblxuXHRwdCA9IG51bGxcblx0Y291bnQgPSAwXG5cblx0Zm9yIGkgaW4gWzAuLnJhd1B0cy5sZW5ndGgtMV1cblx0XHRwYW5vSWRzLnB1c2goIG51bGwgKVxuXHRcdHB0ID0gcmF3UHRzW2ldXG5cblx0XHRsb2FkZXIubG9hZCBpLCBwdCwgKHJlc3VsdCkgLT5cblx0XHRcdCNjb25zb2xlLmxvZyByZXN1bHQuaW5kZXgsIHJlc3VsdC5sb2NhdGlvbi5wYW5vXG5cdFx0XHRwYW5vSWRzWyByZXN1bHQuaW5kZXggXSA9XG5cdFx0XHRcdGxvY2F0aW9uOiByZXN1bHQubG9jYXRpb25cblx0XHRcdFx0aWQ6IHJlc3VsdC5sb2NhdGlvbi5wYW5vXG5cdFx0XHRcdGltYWdlRGF0ZTogcmVzdWx0LmltYWdlRGF0ZVxuXHRcdFx0aWYgKytjb3VudCA+PSByYXdQdHMubGVuZ3RoXG5cdFx0XHRcdCMgbmV4dFxuXHRcdFx0XHRtZXJnZVBhbm9JZHMoKVxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5tZXJnZVBhbm9JZHMgPSAtPlxuXHR0cmFjZSAnbWVyZ2VQYW5vSWRzLS0tLS0tLS0tLSdcblxuXHRwcmV2SWQgPSByYXdQdHNbMF0uaWRcblx0bWVyZ2VkUGFub0lkcyA9IFtdXG5cblx0bWVyZ2VkUGFub0lkcy5wdXNoKCBwYW5vSWRzWzBdIClcblxuXHRmb3IgaSBpbiBbMS4ucGFub0lkcy5sZW5ndGgtMV1cblx0XHQjdHJhY2UgaSwgcGFub0lkc1tpXS5pZCwgcHJldklkXG5cdFx0aWYgcGFub0lkc1tpXS5pZCAhPSBwcmV2SWRcblx0XHRcdG1lcmdlZFBhbm9JZHMucHVzaCggcGFub0lkc1tpXSApXG5cdFx0cHJldklkID0gcGFub0lkc1tpXS5pZFxuXG5cdHRyYWNlIFwicmVkdWNlZCAje3Bhbm9JZHMubGVuZ3RofS0+I3ttZXJnZWRQYW5vSWRzLmxlbmd0aH1cIlxuXG5cdHBhbm9JZHMgPSBtZXJnZWRQYW5vSWRzXG5cblx0IyBuZXh0XG5cdGxvYWRQYW5vcmFtYSgpXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmxvYWRQYW5vcmFtYSA9IC0+XG5cdHRyYWNlICdsb2FkUGFub3JhbWEtLS0tLS0tLS0tJ1xuXG5cdG1heCA9IHBhbm9JZHMubGVuZ3RoXG5cdGluZGV4ID0gMFxuXHR0aW1lcklkID0gMFxuXHRUSU1FX09VVCA9IDIwMDBcblxuXHRsb2FkRWFjaFBhbm9yYW1hID0gLT5cblx0XHRpZiBpbmRleCA+PSBtYXhcblx0XHRcdGFsZXJ0KFwiZmluaXNoIVwiKVxuXHRcdFx0cmV0dXJuXG5cblx0XHR0cmFjZSBpbmRleCwgcGFub0lkc1tpbmRleF0uaWRcblxuXHRcdHRpbWVySWQgPSBzZXRUaW1lb3V0KCBmYWlsZWRMb2FkUGFub3JhbWEsIFRJTUVfT1VUIClcblx0XHRsb2FkZXIuY29tcG9zZVBhbm9yYW1hKCBwYW5vSWRzW2luZGV4XS5pZCApXG5cblx0ZmFpbGVkTG9hZFBhbm9yYW1hID0gLT5cblx0XHR0cmFjZSBpbmRleCwgXCIgLSB0aW1lIG91dFwiXG5cdFx0bG9hZEVhY2hQYW5vcmFtYSggKytpbmRleCApXG5cdFx0I3NldFRpbWVvdXQgbG9hZEVhY2hQYW5vcmFtYSwgMTAwMDBcblxuXHRsb2FkZXIub25QYW5vcmFtYUxvYWQgPSAtPlxuXHRcdCMgc2F2ZVxuXHRcdGV4cG9ydENhbnZhcyggY2FudmFzLCAndGVzdCcsIGluZGV4IClcblxuXHRcdCMgcXVldWUgbmV4dCBmcmFtZVxuXHRcdGNsZWFyVGltZW91dCggdGltZXJJZCApXG5cdFx0bG9hZEVhY2hQYW5vcmFtYSggKytpbmRleCApXG5cblx0IyBsb2FkXG5cdGxvYWRFYWNoUGFub3JhbWEoIDAgKVxuXG5cbiJdfQ==