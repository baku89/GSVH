var $console, $progPano, $progSeq, $statPano, $statSeq, bFlip, basename, changedList, decode, destDir, fileList, gsvh, gsvp, img, load, onComplete, outCanvas, outCtx, sisyphus, srcCanvas, srcCtx, srcDir, ss, startTime, tagCanvas, tagCtx,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

$console = null;

$progPano = null;

$statPano = null;

$progSeq = null;

$statSeq = null;

srcDir = "";

destDir = "";

fileList = null;

gsvh = null;

basename = null;

sisyphus = null;

gsvp = null;

startTime = null;

changedList = [];

ss = new google.maps.StreetViewService();

tagCanvas = tagCtx = null;

bFlip = false;

img = null;

srcCanvas = outCanvas = tagCanvas = null;

srcCtx = outCtx = tagCtx = null;

$(function() {
  $console = $('#console');
  $progPano = $('#prog-pano');
  $progSeq = $('#prog-seq');
  $statPano = $('#stat-pano');
  $statSeq = $('#stat-seq');
  sisyphus = $('#replace-proxy').sisyphus();
  $('#decode').on('click', decode);
  $('[name=file]').on('change', function() {
    $('[name=source]').val($('[name=file]').val());
    return sisyphus.saveAllData();
  });
  gsvp = new GSVPANO.PanoLoader({
    zoom: parseInt($('[name=zoom]').val())
  });
  gsvp.onProgress = function(p) {
    $statPano.html(p + "%");
    return $progPano.val(p);
  };
  img = new Image();
  srcCanvas = $('#src')[0];
  outCanvas = $('#out')[0];
  tagCanvas = $('#tag')[0];
  srcCtx = srcCanvas.getContext('2d');
  outCtx = outCanvas.getContext('2d');
  return tagCtx = tagCanvas.getContext('2d');
});

decode = function() {
  var f, files, zoom;
  srcDir = $('[name=source]').val();
  if (srcDir === "") {
    alert("please select source directory");
    return;
  }
  files = fs.readdirSync(srcDir);
  fileList = (function() {
    var j, len, results;
    results = [];
    for (j = 0, len = files.length; j < len; j++) {
      f = files[j];
      if (/\.png$/.test(f)) {
        results.push(f);
      }
    }
    return results;
  })();
  basename = path.basename(srcDir);
  zoom = parseInt($('[name=zoom').val());
  gsvp.setZoom(zoom);
  return load();
};

load = function() {
  var bChanged, destFileList, destFiles, err, f, filename, idx, j, len, loadImg, onLoadImg, reportPath, saveAndNext, savePano, subFileList;
  startTime = new Date();
  destDir = (path.dirname(srcDir)) + "/" + basename + ".HQ";
  try {
    mkdirp.sync(destDir);
  } catch (_error) {
    err = _error;
    alert("Destination directory already exists. Please delete '" + destDir + "' to continue.");
  }
  bFlip = false;
  bChanged = false;
  idx = 0;
  filename = "";
  changedList = [];
  reportPath = destDir + "/_report.txt";
  if (fs.existsSync(reportPath)) {
    changedList = JSON.parse(fs.readFileSync(reportPath));
  }
  destFiles = fs.readdirSync(destDir);
  destFileList = (function() {
    var j, len, results;
    results = [];
    for (j = 0, len = destFiles.length; j < len; j++) {
      f = destFiles[j];
      if (/\.png$/.test(f)) {
        results.push(f);
      }
    }
    return results;
  })();
  subFileList = [];
  for (j = 0, len = fileList.length; j < len; j++) {
    f = fileList[j];
    if (!(indexOf.call(destFileList, f) >= 0)) {
      subFileList.push(f);
    }
  }
  fileList = subFileList;
  console.log(fileList);
  loadImg = function() {
    var elapsed;
    elapsed = ((new Date()) - startTime) / 1000 / 60;
    $statSeq.html("(" + (idx + 1) + "/" + fileList.length + ") " + (elapsed.toPrecision(2)) + "min elapsed");
    $progSeq.val((idx + 1) / fileList.length * 100);
    filename = fileList[idx];
    return img.src = "file://" + srcDir + "/" + filename;
  };
  onLoadImg = function() {
    var headingOffset, height, i, k, pano, pixel, pt, ref, width, x;
    width = img.width;
    height = img.height;
    srcCanvas.width = img.width;
    srcCanvas.height = img.height;
    srcCtx.drawImage(img, 0, 0);
    headingOffset = 0;
    x = 0;
    for (i = k = 0, ref = srcCanvas.width - 1; 0 <= ref ? k <= ref : k >= ref; i = 0 <= ref ? ++k : --k) {
      pixel = srcCtx.getImageData(i, 836, 1, 1).data;
      if (pixel[0] >= 128) {
        x = i;
        headingOffset = (x / srcCanvas.width) * 360;
        break;
      }
    }
    pt = {
      x: ((img.width + x) - 3) % img.width,
      y: 843
    };
    pixel = srcCtx.getImageData(pt.x, pt.y, 1, 1).data;
    if (pixel[0] > 128) {
      bFlip = true;
      x = img.width - (x + 12);
      headingOffset = (x / srcCanvas.width) * 360;
    } else {
      bFlip = false;
    }
    tagCanvas.width = img.width;
    tagCanvas.height = TAG_HEIGHT;
    if (bFlip) {
      tagCtx.save();
      tagCtx.translate(img.width, 0);
      tagCtx.scale(-1, 1);
      tagCtx.drawImage(img, 0, height - TAG_HEIGHT, width, TAG_HEIGHT, x, 0, width, TAG_HEIGHT);
      tagCtx.drawImage(img, 0, height - TAG_HEIGHT, width, TAG_HEIGHT, x - width, 0, width, TAG_HEIGHT);
      tagCtx.restore();
    } else {
      tagCtx.drawImage(img, 0, height - TAG_HEIGHT, width, TAG_HEIGHT, -x, 0, width, TAG_HEIGHT);
      tagCtx.drawImage(img, 0, height - TAG_HEIGHT, width, TAG_HEIGHT, -x + width, 0, width, TAG_HEIGHT);
    }
    pano = CanvasMatrixCode.decode(tagCanvas, 0, 10, 1664, TAG_HEIGHT - 10);
    if (pano === null) {
      outCanvas.width = gsvp.width;
      outCanvas.height = (img.height / img.width) * gsvp.width;
      outCtx.fillStyle = '#000000';
      outCtx.fillRect(0, 0, outCanvas.width, outCanvas.height);
      outCtx.drawImage(img, 0, 0, img.width, img.height, 0, 0, outCanvas.width, outCanvas.height);
      saveAndNext();
    }
    console.log(pano);
    return ss.getPanoramaById(pano.id, function(data, status) {
      var latLng, result;
      if (status === google.maps.StreetViewStatus.OK) {
        bChanged = false;
        return gsvp.composePanorama(pano.id, pano.heading + headingOffset);
      } else {
        bChanged = true;
        result = /([\-0-9.]+), ([\-0-9.]+)/.exec(pano.latLng);
        latLng = new google.maps.LatLng(result[1], result[2]);
        return searchNearestPano(latLng, function(newId, newLatLng, dist) {
          var changedInfo, changedTxt;
          console.log(newLatLng, newId, dist);
          changedInfo = {
            filename: filename,
            oldId: pano.id,
            newId: newId,
            oldLatLng: latLng.toString(),
            newLatLng: newLatLng.toString(),
            distance: dist
          };
          changedList.push(changedInfo);
          changedTxt = JSON.stringify(changedList);
          fs.writeFile(destDir + "/_report.txt", changedTxt);
          console.log("changed:" + filename + ", nearest pano: " + pano.id + " -> " + newId + ", distance from original: " + dist);
          return gsvp.composePanorama(newId, pano.heading + headingOffset);
        });
      }
    });
  };
  savePano = function() {
    console.log("save pano");
    outCanvas.width = gsvp.width;
    outCanvas.height = (img.height / img.width) * gsvp.width;
    outCtx.fillStyle = '#000000';
    outCtx.fillRect(0, 0, outCanvas.width, outCanvas.height);
    if (bFlip) {
      console.log("fliped");
      outCtx.save();
      outCtx.translate(outCanvas.width, 0);
      outCtx.scale(-1, 1);
    }
    outCtx.drawImage(gsvp.canvas, 0, 0);
    if (bFlip) {
      outCtx.restore();
    }
    outCtx.drawImage(img, 0, img.height - TAG_HEIGHT, img.width, TAG_HEIGHT, 0, outCanvas.height - TAG_HEIGHT, img.width, TAG_HEIGHT);
    if (bChanged) {
      outCtx.fillStyle = '#ff0000';
      outCtx.fillRect(outCanvas.width - 40, outCanvas.height - 40, 40, 40);
    }
    return saveAndNext();
  };
  saveAndNext = function() {
    var dest;
    dest = destDir + "/" + filename;
    saveCanvas(outCanvas, dest);
    if (++idx < fileList.length) {
      return loadImg();
    } else {
      return onComplete();
    }
  };
  img.onload = onLoadImg;
  gsvp.onPanoramaLoad = savePano;
  return loadImg();
};

onComplete = function() {
  return setTimeout(function() {
    var changedTxt;
    changedTxt = JSON.stringify(changedList);
    fs.writeFile(destDir + "/_report.txt", changedTxt);
    fs.renameSync(srcDir, srcDir + ".proxy");
    fs.renameSync(destDir, srcDir);
    return notifier.notify({
      title: "Proxy Replacer",
      message: "All done!",
      sound: true
    });
  }, 3000);
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlcGxhY2UtcHJveHkuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUEsd09BQUE7RUFBQTs7QUFBQSxRQUFBLEdBQVc7O0FBQ1gsU0FBQSxHQUFZOztBQUNaLFNBQUEsR0FBWTs7QUFDWixRQUFBLEdBQVc7O0FBQ1gsUUFBQSxHQUFXOztBQUVYLE1BQUEsR0FBUzs7QUFDVCxPQUFBLEdBQVU7O0FBQ1YsUUFBQSxHQUFXOztBQUVYLElBQUEsR0FBTzs7QUFFUCxRQUFBLEdBQVc7O0FBQ1gsUUFBQSxHQUFXOztBQUVYLElBQUEsR0FBTzs7QUFFUCxTQUFBLEdBQVk7O0FBRVosV0FBQSxHQUFjOztBQUVkLEVBQUEsR0FBUyxJQUFBLE1BQU0sQ0FBQyxJQUFJLENBQUMsaUJBQVosQ0FBQTs7QUFFVCxTQUFBLEdBQVksTUFBQSxHQUFTOztBQUNyQixLQUFBLEdBQVE7O0FBRVIsR0FBQSxHQUFNOztBQUVOLFNBQUEsR0FDQSxTQUFBLEdBQ0EsU0FBQSxHQUFZOztBQUVaLE1BQUEsR0FDQSxNQUFBLEdBQ0EsTUFBQSxHQUFTOztBQUVULENBQUEsQ0FBRSxTQUFBO0VBQ0QsUUFBQSxHQUFXLENBQUEsQ0FBRSxVQUFGO0VBQ1gsU0FBQSxHQUFZLENBQUEsQ0FBRSxZQUFGO0VBQ1osUUFBQSxHQUFXLENBQUEsQ0FBRSxXQUFGO0VBQ1gsU0FBQSxHQUFZLENBQUEsQ0FBRSxZQUFGO0VBQ1osUUFBQSxHQUFXLENBQUEsQ0FBRSxXQUFGO0VBRVgsUUFBQSxHQUFXLENBQUEsQ0FBRSxnQkFBRixDQUFtQixDQUFDLFFBQXBCLENBQUE7RUFFWCxDQUFBLENBQUUsU0FBRixDQUFZLENBQUMsRUFBYixDQUFnQixPQUFoQixFQUF5QixNQUF6QjtFQUVBLENBQUEsQ0FBRSxhQUFGLENBQWdCLENBQUMsRUFBakIsQ0FBb0IsUUFBcEIsRUFBOEIsU0FBQTtJQUM3QixDQUFBLENBQUUsZUFBRixDQUNDLENBQUMsR0FERixDQUNPLENBQUEsQ0FBRSxhQUFGLENB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b3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIiRjb25zb2xlID0gbnVsbFxuJHByb2dQYW5vID0gbnVsbFxuJHN0YXRQYW5vID0gbnVsbFxuJHByb2dTZXEgPSBudWxsXG4kc3RhdFNlcSA9IG51bGxcblxuc3JjRGlyID0gXCJcIlxuZGVzdERpciA9IFwiXCJcbmZpbGVMaXN0ID0gbnVsbFxuXG5nc3ZoID0gbnVsbFxuXG5iYXNlbmFtZSA9IG51bGxcbnNpc3lwaHVzID0gbnVsbFxuXG5nc3ZwID0gbnVsbFxuXG5zdGFydFRpbWUgPSBudWxsXG5cbmNoYW5nZWRMaXN0ID0gW11cblxuc3MgPSBuZXcgZ29vZ2xlLm1hcHMuU3RyZWV0Vmlld1NlcnZpY2UoKVxuXG50YWdDYW52YXMgPSB0YWdDdHggPSBudWxsXG5iRmxpcCA9IGZhbHNlXG5cbmltZyA9IG51bGxcblxuc3JjQ2FudmFzID1cbm91dENhbnZhcyA9XG50YWdDYW52YXMgPSBudWxsXG5cbnNyY0N0eCA9IFxub3V0Q3R4ID0gXG50YWdDdHggPSBudWxsXG5cbiQgLT5cblx0JGNvbnNvbGUgPSAkKCcjY29uc29sZScpXG5cdCRwcm9nUGFubyA9ICQoJyNwcm9nLXBhbm8nKVxuXHQkcHJvZ1NlcSA9ICQoJyNwcm9nLXNlcScpXG5cdCRzdGF0UGFubyA9ICQoJyNzdGF0LXBhbm8nKVxuXHQkc3RhdFNlcSA9ICQoJyNzdGF0LXNlcScpXG5cblx0c2lzeXBodXMgPSAkKCcjcmVwbGFjZS1wcm94eScpLnNpc3lwaHVzKClcblxuXHQkKCcjZGVjb2RlJykub24gJ2NsaWNrJywgZGVjb2RlXG5cblx0JCgnW25hbWU9ZmlsZV0nKS5vbiAnY2hhbmdlJywgLT5cblx0XHQkKCdbbmFtZT1zb3VyY2VdJylcblx0XHRcdC52YWwoICQoJ1tuYW1lPWZpbGVdJykudmFsKCkgKVxuXHRcdHNpc3lwaHVzLnNhdmVBbGxEYXRhKClcblxuXHRnc3ZwID0gbmV3IEdTVlBBTk8uUGFub0xvYWRlclxuXHRcdHpvb206IHBhcnNlSW50KCAkKCdbbmFtZT16b29tXScpLnZhbCgpIClcblxuXHRnc3ZwLm9uUHJvZ3Jlc3MgPSAocCkgLT5cblx0XHQkc3RhdFBhbm8uaHRtbChcIiN7cH0lXCIpXG5cdFx0JHByb2dQYW5vLnZhbCggcCApXG5cblxuXHRpbWcgPSBuZXcgSW1hZ2UoKVxuXG5cdHNyY0NhbnZhcyA9ICQoJyNzcmMnKVswXVxuXHRvdXRDYW52YXMgPSAkKCcjb3V0JylbMF1cblx0dGFnQ2FudmFzID0gJCgnI3RhZycpWzBdXG5cblx0c3JjQ3R4ID0gc3JjQ2FudmFzLmdldENvbnRleHQoJzJkJylcblx0b3V0Q3R4ID0gb3V0Q2FudmFzLmdldENvbnRleHQoJzJkJylcblx0dGFnQ3R4ID0gdGFnQ2FudmFzLmdldENvbnRleHQoJzJkJylcblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZGVjb2RlID0gLT5cblx0c3JjRGlyID0gJCgnW25hbWU9c291cmNlXScpLnZhbCgpXG5cblx0aWYgc3JjRGlyID09IFwiXCJcblx0XHRhbGVydCBcInBsZWFzZSBzZWxlY3Qgc291cmNlIGRpcmVjdG9yeVwiXG5cdFx0cmV0dXJuXG5cblx0ZmlsZXMgPSBmcy5yZWFkZGlyU3luYyhzcmNEaXIpXG5cblx0ZmlsZUxpc3QgPSAoZiBmb3IgZiBpbiBmaWxlcyB3aGVuIC9cXC5wbmckLy50ZXN0KGYpKVxuXHRiYXNlbmFtZSA9IHBhdGguYmFzZW5hbWUoIHNyY0RpciApXG5cblx0IyBjaGFuZ2UgZ3N2cCB6b29tXG5cdHpvb20gPSBwYXJzZUludCggJCgnW25hbWU9em9vbScpLnZhbCgpICkgXG5cdGdzdnAuc2V0Wm9vbSggem9vbSApXG5cblx0bG9hZCgpXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmxvYWQgPSAoKSAtPlxuXG5cdHN0YXJ0VGltZSA9IG5ldyBEYXRlKClcblxuXHQjIG1ha2UgbmV3IGRpcmVjdG9yeVxuXHRkZXN0RGlyID0gXCIje3BhdGguZGlybmFtZShzcmNEaXIpfS8je2Jhc2VuYW1lfS5IUVwiXG5cdHRyeVxuXHRcdG1rZGlycC5zeW5jKGRlc3REaXIpXG5cdFx0I2ZzLm1rZGlyU3luYyhkZXN0RGlyKVxuXHRjYXRjaCBlcnJcblx0XHRhbGVydChcIkRlc3RpbmF0aW9uIGRpcmVjdG9yeSBhbHJlYWR5IGV4aXN0cy4gUGxlYXNlIGRlbGV0ZSAnI3tkZXN0RGlyfScgdG8gY29udGludWUuXCIpXG5cblx0YkZsaXAgPSBmYWxzZVxuXHRiQ2hhbmdlZCA9IGZhbHNlXG5cblx0aWR4ID0gMFxuXHRmaWxlbmFtZSA9IFwiXCJcblxuXHRjaGFuZ2VkTGlzdCA9IFtdXG5cblx0cmVwb3J0UGF0aCA9IFwiI3tkZXN0RGlyfS9fcmVwb3J0LnR4dFwiXG5cdGlmIGZzLmV4aXN0c1N5bmMocmVwb3J0UGF0aClcblx0XHRjaGFuZ2VkTGlzdCA9IEpTT04ucGFyc2UoIGZzLnJlYWRGaWxlU3luYyhyZXBvcnRQYXRoKSApXG5cblx0ZGVzdEZpbGVzID0gZnMucmVhZGRpclN5bmMoZGVzdERpcilcblx0ZGVzdEZpbGVMaXN0ID0gKGYgZm9yIGYgaW4gZGVzdEZpbGVzIHdoZW4gL1xcLnBuZyQvLnRlc3QoZikpXG5cblx0c3ViRmlsZUxpc3QgPSBbXVxuXG5cdGZvciBmIGluIGZpbGVMaXN0XG5cdFx0aWYgIShmIGluIGRlc3RGaWxlTGlzdClcblx0XHRcdHN1YkZpbGVMaXN0LnB1c2goIGYgKVxuXG5cdGZpbGVMaXN0ID0gc3ViRmlsZUxpc3RcblxuXHRjb25zb2xlLmxvZyBmaWxlTGlzdFxuXG5cdCMtLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHQjIDEuIGxvYWQgaW1hZ2Vcblx0bG9hZEltZyA9ICgpIC0+XG5cdFx0ZWxhcHNlZCA9ICgoKG5ldyBEYXRlKCkpIC0gc3RhcnRUaW1lKSAvIDEwMDAgLyA2MClcblx0XHQkc3RhdFNlcS5odG1sKFwiKCN7aWR4KzF9LyN7ZmlsZUxpc3QubGVuZ3RofSkgI3tlbGFwc2VkLnRvUHJlY2lzaW9uKDIpfW1pbiBlbGFwc2VkXCIpXG5cdFx0JHByb2dTZXEudmFsKCAoaWR4KzEpIC8gZmlsZUxpc3QubGVuZ3RoICogMTAwIClcblxuXG5cdFx0ZmlsZW5hbWUgPSBmaWxlTGlzdFtpZHhdXG5cdFx0aW1nLnNyYyA9IFwiZmlsZTovLyN7c3JjRGlyfS8je2ZpbGVuYW1lfVwiXG5cblx0Iy0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdCMgMi4gcmVhZCBtYXRyaXggY29kZSBhbmQgc2V0dXAgZ3N2aCBhbmQgcnVuIGNvbXBvc2UoKVxuXHRvbkxvYWRJbWcgPSAtPlxuXG5cdFx0d2lkdGggPSBpbWcud2lkdGhcblx0XHRoZWlnaHQgPSBpbWcuaGVpZ2h0XG5cblx0XHRzcmNDYW52YXMud2lkdGggPSBpbWcud2lkdGhcblx0XHRzcmNDYW52YXMuaGVpZ2h0ID0gaW1nLmhlaWdodFxuXG5cdFx0c3JjQ3R4LmRyYXdJbWFnZShpbWcsIDAsIDApXG5cblx0XHQjIHJlYWQgaGVhZGluZyBvZmZzZXRcblx0XHRoZWFkaW5nT2Zmc2V0ID0gMFxuXHRcdHggPSAwXG5cdFx0Zm9yIGkgaW4gWzAuLnNyY0NhbnZhcy53aWR0aC0xXVxuXHRcdFx0cGl4ZWwgPSBzcmNDdHguZ2V0SW1hZ2VEYXRhKGksIDgzNiwgMSwgMSkuZGF0YVxuXHRcdFx0aWYgcGl4ZWxbMF0gPj0gMTI4XG5cdFx0XHRcdHggPSBpXG5cdFx0XHRcdGhlYWRpbmdPZmZzZXQgPSAoeCAvIHNyY0NhbnZhcy53aWR0aCkgKiAzNjBcblx0XHRcdFx0YnJlYWtcblxuXHRcdCMgcmVhZCBpZiBmbGlwZWRcblx0XHRwdCA9XG5cdFx0XHR4OiAoKGltZy53aWR0aCArIHgpIC0gMykgJSBpbWcud2lkdGhcblx0XHRcdHk6IDg0M1xuXG5cdFx0cGl4ZWwgPSBzcmNDdHguZ2V0SW1hZ2VEYXRhKHB0LngsIHB0LnksIDEsIDEpLmRhdGFcblx0XHRpZiBwaXhlbFswXSA+IDEyOFxuXHRcdFx0YkZsaXAgPSB0cnVlXG5cdFx0XHR4ID0gaW1nLndpZHRoIC0gKHgrMTIpXG5cdFx0XHRoZWFkaW5nT2Zmc2V0ID0gKHggLyBzcmNDYW52YXMud2lkdGgpICogMzYwXG5cdFx0ZWxzZVxuXHRcdFx0YkZsaXAgPSBmYWxzZVxuXG5cdFx0IyBmaXggdGFnIG9mZnNldFxuXHRcdHRhZ0NhbnZhcy53aWR0aCA9IGltZy53aWR0aFxuXHRcdHRhZ0NhbnZhcy5oZWlnaHQgPSBUQUdfSEVJR0hUXG5cblx0XHRpZiBiRmxpcFxuXHRcdFx0dGFnQ3R4LnNhdmUoKVxuXHRcdFx0dGFnQ3R4LnRyYW5zbGF0ZShpbWcud2lkdGgsIDApXG5cdFx0XHR0YWdDdHguc2NhbGUoLTEsIDEpXG5cdFx0XHR0YWdDdHguZHJhd0ltYWdlKGltZyxcblx0XHRcdFx0MCwgaGVpZ2h0IC0gVEFHX0hFSUdIVCwgd2lkdGgsIFRBR19IRUlHSFQsXG5cdFx0XHRcdHgsIDAsIHdpZHRoLCBUQUdfSEVJR0hUKVxuXHRcdFx0dGFnQ3R4LmRyYXdJbWFnZShpbWcsXG5cdFx0XHRcdDAsIGhlaWdodCAtIFRBR19IRUlHSFQsIHdpZHRoLCBUQUdfSEVJR0hULFxuXHRcdFx0XHR4IC0gd2lkdGgsIDAsIHdpZHRoLCBUQUdfSEVJR0hUKVxuXHRcdFx0dGFnQ3R4LnJlc3RvcmUoKVxuXG5cdFx0ZWxzZVxuXHRcdFx0dGFnQ3R4LmRyYXdJbWFnZShpbWcsXG5cdFx0XHRcdDAsIGhlaWdodCAtIFRBR19IRUlHSFQsIHdpZHRoLCBUQUdfSEVJR0hULFxuXHRcdFx0XHQteCwgMCwgd2lkdGgsIFRBR19IRUlHSFQpXG5cdFx0XHR0YWdDdHguZHJhd0ltYWdlKGltZyxcblx0XHRcdFx0MCwgaGVpZ2h0IC0gVEFHX0hFSUdIVCwgd2lkdGgsIFRBR19IRUlHSFQsXG5cdFx0XHRcdC14ICsgd2lkdGgsIDAsIHdpZHRoLCBUQUdfSEVJR0hUKVxuXG5cdFx0IyBkZWNvZGUgcGFubyBtYXRyaXggY29kZVxuXHRcdHBhbm8gPSBDYW52YXNNYXRyaXhDb2RlLmRlY29kZShcblx0XHRcdHRhZ0NhbnZhcyxcblx0XHRcdDAsXG5cdFx0XHQxMCxcblx0XHRcdDE2NjQsIFRBR19IRUlHSFQgLSAxMClcblxuXHRcdCMgaWYgdGFnIGlzIGludmFsaWQsIHRocnVcblx0XHRpZiBwYW5vID09IG51bGxcblxuXHRcdFx0b3V0Q2FudmFzLndpZHRoID0gZ3N2cC53aWR0aFxuXHRcdFx0b3V0Q2FudmFzLmhlaWdodCA9IChpbWcuaGVpZ2h0IC8gaW1nLndpZHRoKSAqIGdzdnAud2lkdGhcblxuXHRcdFx0b3V0Q3R4LmZpbGxTdHlsZSA9ICcjMDAwMDAwJ1xuXHRcdFx0b3V0Q3R4LmZpbGxSZWN0KDAsIDAsIG91dENhbnZhcy53aWR0aCwgb3V0Q2FudmFzLmhlaWdodClcblx0XHRcdG91dEN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCBpbWcud2lkdGgsIGltZy5oZWlnaHQsIDAsIDAsIG91dENhbnZhcy53aWR0aCwgb3V0Q2FudmFzLmhlaWdodClcblxuXHRcdFx0c2F2ZUFuZE5leHQoKVxuXG5cdFx0Y29uc29sZS5sb2cgcGFub1xuXG5cdFx0IyBjaGVjayBpZiB0aGUgcGFubyBpZCBpcyB2YWxpZFxuXHRcdHNzLmdldFBhbm9yYW1hQnlJZCBwYW5vLmlkLCAoZGF0YSwgc3RhdHVzKSAtPlxuXG5cdFx0XHRpZiBzdGF0dXMgPT0gZ29vZ2xlLm1hcHMuU3RyZWV0Vmlld1N0YXR1cy5PSyBcblx0XHRcdFx0IyBnZW5lcmF0ZSBwYW5vXG5cdFx0XHRcdGJDaGFuZ2VkID0gZmFsc2Vcblx0XHRcdFx0Z3N2cC5jb21wb3NlUGFub3JhbWEoIHBhbm8uaWQsIHBhbm8uaGVhZGluZyArIGhlYWRpbmdPZmZzZXQgKVxuXG5cdFx0XHRlbHNlXG5cdFx0XHRcdGJDaGFuZ2VkID0gdHJ1ZVxuXG5cdFx0XHRcdHJlc3VsdCA9IC8oW1xcLTAtOS5dKyksIChbXFwtMC05Ll0rKS8uZXhlYyhwYW5vLmxhdExuZylcblx0XHRcdFx0bGF0TG5nID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhyZXN1bHRbMV0sIHJlc3VsdFsyXSlcblxuXHRcdFx0XHRzZWFyY2hOZWFyZXN0UGFubyBsYXRMbmcsIChuZXdJZCwgbmV3TGF0TG5nLCBkaXN0KS0+XG5cblx0XHRcdFx0XHRjb25zb2xlLmxvZyBuZXdMYXRMbmcsIG5ld0lkLCBkaXN0XG5cblx0XHRcdFx0XHRjaGFuZ2VkSW5mbyA9IFxuXHRcdFx0XHRcdFx0ZmlsZW5hbWU6IGZpbGVuYW1lXG5cdFx0XHRcdFx0XHRvbGRJZDogcGFuby5pZFxuXHRcdFx0XHRcdFx0bmV3SWQ6IG5ld0lkXG5cdFx0XHRcdFx0XHRvbGRMYXRMbmc6IGxhdExuZy50b1N0cmluZygpXG5cdFx0XHRcdFx0XHRuZXdMYXRMbmc6IG5ld0xhdExuZy50b1N0cmluZygpXG5cdFx0XHRcdFx0XHRkaXN0YW5jZTogZGlzdFxuXG5cdFx0XHRcdFx0Y2hhbmdlZExpc3QucHVzaCggY2hhbmdlZEluZm8gKVxuXHRcdFx0XHRcdGNoYW5nZWRUeHQgPSBKU09OLnN0cmluZ2lmeSggY2hhbmdlZExpc3QgKVxuXHRcdFx0XHRcdGZzLndyaXRlRmlsZShcIiN7ZGVzdERpcn0vX3JlcG9ydC50eHRcIiwgY2hhbmdlZFR4dClcblxuXHRcdFx0XHRcdGNvbnNvbGUubG9nIFwiY2hhbmdlZDoje2ZpbGVuYW1lfSwgbmVhcmVzdCBwYW5vOiAje3Bhbm8uaWR9IC0+ICN7bmV3SWR9LCBkaXN0YW5jZSBmcm9tIG9yaWdpbmFsOiAje2Rpc3R9XCJcblx0XHRcdFx0XHRnc3ZwLmNvbXBvc2VQYW5vcmFtYSggbmV3SWQsIHBhbm8uaGVhZGluZyArIGhlYWRpbmdPZmZzZXQgKVxuXG5cdCMtLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHQjIDMuIG1lcmdlIHdpdGggbWF0cml4IGNvZGUgYW5kIHNhdmVcblx0c2F2ZVBhbm8gPSAtPlxuXHRcdGNvbnNvbGUubG9nIFwic2F2ZSBwYW5vXCJcblxuXHRcdG91dENhbnZhcy53aWR0aCA9IGdzdnAud2lkdGhcblx0XHRvdXRDYW52YXMuaGVpZ2h0ID0gKGltZy5oZWlnaHQgLyBpbWcud2lkdGgpICogZ3N2cC53aWR0aFxuXG5cdFx0IyBkcmF3XG5cdFx0b3V0Q3R4LmZpbGxTdHlsZSA9ICcjMDAwMDAwJ1xuXHRcdG91dEN0eC5maWxsUmVjdCgwLCAwLCBvdXRDYW52YXMud2lkdGgsIG91dENhbnZhcy5oZWlnaHQpXG5cblx0XHRpZiBiRmxpcFxuXHRcdFx0Y29uc29sZS5sb2cgXCJmbGlwZWRcIlxuXHRcdFx0b3V0Q3R4LnNhdmUoKVxuXHRcdFx0b3V0Q3R4LnRyYW5zbGF0ZShvdXRDYW52YXMud2lkdGgsIDApXG5cdFx0XHRvdXRDdHguc2NhbGUoLTEsIDEpXG5cblx0XHRvdXRDdHguZHJhd0ltYWdlKGdzdnAuY2FudmFzLCAwLCAwKVxuXG5cdFx0aWYgYkZsaXBcblx0XHRcdG91dEN0eC5yZXN0b3JlKClcblxuXHRcdCMgY29kZVxuXHRcdG91dEN0eC5kcmF3SW1hZ2UoXG5cdFx0XHRpbWcsXG5cdFx0XHQwLCBpbWcuaGVpZ2h0IC0gVEFHX0hFSUdIVCwgXHRcdGltZy53aWR0aCwgVEFHX0hFSUdIVCxcblx0XHRcdDAsIG91dENhbnZhcy5oZWlnaHQgLSBUQUdfSEVJR0hULCBcdGltZy53aWR0aCwgVEFHX0hFSUdIVClcblxuXHRcdCMgY2hhbmdlZFxuXHRcdGlmIGJDaGFuZ2VkXG5cdFx0XHRvdXRDdHguZmlsbFN0eWxlID0gJyNmZjAwMDAnXG5cdFx0XHRvdXRDdHguZmlsbFJlY3Qob3V0Q2FudmFzLndpZHRoLTQwLCBvdXRDYW52YXMuaGVpZ2h0LTQwLCA0MCwgNDApXG5cblx0XHRzYXZlQW5kTmV4dCgpXHRcdFxuXG5cdCMtLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHQjIDQuIG5leHRcblx0c2F2ZUFuZE5leHQgPSAtPlxuXHRcdFxuXHRcdGRlc3QgPSBcIiN7ZGVzdERpcn0vI3tmaWxlbmFtZX1cIlxuXHRcdHNhdmVDYW52YXMoIG91dENhbnZhcywgZGVzdCApXG5cblx0XHRpZiArK2lkeCA8IGZpbGVMaXN0Lmxlbmd0aFxuXHRcdFx0bG9hZEltZygpXG5cdFx0ZWxzZVxuXHRcdFx0b25Db21wbGV0ZSgpXG5cblx0Iy0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdCMgdHJpZ2dlclxuXHRpbWcub25sb2FkID0gb25Mb2FkSW1nXG5cdGdzdnAub25QYW5vcmFtYUxvYWQgPSBzYXZlUGFub1xuXG5cdGxvYWRJbWcoKVxuXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbm9uQ29tcGxldGUgPSAtPlxuXG5cdHNldFRpbWVvdXQgLT5cblxuXHRcdGNoYW5nZWRUeHQgPSBKU09OLnN0cmluZ2lmeSggY2hhbmdlZExpc3QgKVxuXHRcdGZzLndyaXRlRmlsZShcIiN7ZGVzdERpcn0vX3JlcG9ydC50eHRcIiwgY2hhbmdlZFR4dClcblxuXHRcdGZzLnJlbmFtZVN5bmMoc3JjRGlyLCBcIiN7c3JjRGlyfS5wcm94eVwiKVxuXHRcdGZzLnJlbmFtZVN5bmMoZGVzdERpciwgc3JjRGlyKVxuXG5cdFx0bm90aWZpZXIubm90aWZ5XG5cdFx0XHR0aXRsZTogXCJQcm94eSBSZXBsYWNlclwiXG5cdFx0XHRtZXNzYWdlOiBcIkFsbCBkb25lIVwiXG5cdFx0XHRzb3VuZDogdHJ1ZVxuXHQsIDMwMDBcblxuXG5cdFxuXG5cbiJdfQ==