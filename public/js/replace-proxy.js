var $console, $progPano, $progSeq, $statPano, $statSeq, basename, decode, destDir, fileList, gsvh, gsvp, load, log, onComplete, sisyphus, srcDir, ss, startTime;

$console = null;

$progPano = null;

$statPano = null;

$progSeq = null;

$statSeq = null;

srcDir = "";

destDir = "";

fileList = null;

gsvh = null;

basename = null;

sisyphus = null;

gsvp = null;

startTime = null;

ss = new google.maps.StreetViewService();

log = function(str) {
  $console.append(str + "\n");
  return $console.scrollTop = $console.scrollHeight;
};

$(function() {
  $console = $('#console');
  $progPano = $('#prog-pano');
  $progSeq = $('#prog-seq');
  $statPano = $('#stat-pano');
  $statSeq = $('#stat-seq');
  sisyphus = $('#replace-proxy').sisyphus();
  $('#decode').on('click', decode);
  $('[name=file]').on('change', function() {
    $('[name=source]').val($('[name=file]').val());
    return sisyphus.saveAllData();
  });
  gsvp = new GSVPANO.PanoLoader({
    zoom: parseInt($('[name=zoom]').val())
  });
  return gsvp.onProgress = function(p) {
    $statPano.html(p + "%");
    return $progPano.val(p);
  };
});

decode = function() {
  var f, files;
  srcDir = $('[name=source]').val();
  if (srcDir === "") {
    alert("please select source directory");
    return;
  }
  files = fs.readdirSync(srcDir);
  fileList = (function() {
    var j, len, results;
    results = [];
    for (j = 0, len = files.length; j < len; j++) {
      f = files[j];
      if (/\.png$/.test(f)) {
        results.push(f);
      }
    }
    return results;
  })();
  basename = path.basename(srcDir);
  return load();
};

load = function() {
  var err, filename, idx, img, loadImg, onLoadImg, outCanvas, outCtx, savePano, srcCanvas, srcCtx;
  startTime = new Date();
  destDir = (path.dirname(srcDir)) + "/" + basename + ".HQ";
  try {
    mkdirp.sync(destDir);
  } catch (_error) {
    err = _error;
    alert("Destination directory already exists. Please delete '" + destDir + "' to continue.");
  }
  img = new Image();
  srcCanvas = $('#src')[0];
  outCanvas = $('#out')[0];
  srcCtx = srcCanvas.getContext('2d');
  outCtx = outCanvas.getContext('2d');
  idx = 0;
  filename = "";
  loadImg = function() {
    var elapsed;
    elapsed = ((new Date()) - startTime) / 1000 / 60;
    $statSeq.html("(" + (idx + 1) + "/" + fileList.length + ") " + (elapsed.toPrecision(2)) + "min elapsed");
    $progSeq.val((idx + 1) / fileList.length * 100);
    filename = fileList[idx];
    return img.src = "file:///" + srcDir + "/" + filename;
  };
  onLoadImg = function() {
    var headingOffset, height, i, j, pano, pixel, ref, width, x;
    width = img.width;
    height = img.height;
    srcCanvas.width = img.width;
    srcCanvas.height = img.height;
    srcCtx.drawImage(img, 0, 0);
    headingOffset = 0;
    x = 0;
    for (i = j = 0, ref = srcCanvas.width - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {
      pixel = srcCtx.getImageData(i, 836, 1, 1).data;
      if (pixel[0] >= 128) {
        x = i;
        headingOffset = (x / srcCanvas.width) * 360;
        break;
      }
    }
    srcCtx.drawImage(img, 0, height - TAG_HEIGHT, width, TAG_HEIGHT, -x, height - TAG_HEIGHT, width, TAG_HEIGHT);
    srcCtx.drawImage(img, 0, height - TAG_HEIGHT, width, TAG_HEIGHT, -x + width, height - TAG_HEIGHT, width, TAG_HEIGHT);
    pano = CanvasMatrixCode.decode(srcCanvas, 0, srcCanvas.height - TAG_HEIGHT + 10, 1664, TAG_HEIGHT - 10);
    console.log(pano);
    return ss.getPanoramaById(pano.id, function(data, status) {
      if (status === google.maps.StreetViewStatus.OK) {
        return gsvp.composePanorama(pano.id, pano.heading + headingOffset);
      } else {
        console.log("invalid pano id: " + pano.id);
        if (++idx < fileList.length) {
          return loadImg();
        } else {
          return onComplete();
        }
      }
    });
  };
  savePano = function() {
    var dest;
    console.log("save pano");
    outCanvas.width = gsvp.width;
    outCanvas.height = (img.height / img.width) * gsvp.width;
    outCtx.fillStyle = '#000000';
    outCtx.fillRect(0, 0, outCanvas.width, outCanvas.height);
    outCtx.drawImage(gsvp.canvas, 0, 0);
    outCtx.save();
    outCtx.translate(0, gsvp.canvas.height * 2);
    outCtx.scale(1, -1);
    outCtx.drawImage(gsvp.canvas, 0, 0);
    outCtx.restore();
    outCtx.drawImage(img, 0, img.height - TAG_HEIGHT, img.width, TAG_HEIGHT, 0, outCanvas.height - TAG_HEIGHT, img.width, TAG_HEIGHT);
    dest = destDir + "/" + filename;
    saveCanvas(outCanvas, dest);
    if (++idx < fileList.length) {
      return loadImg();
    } else {
      return onComplete();
    }
  };
  img.onload = onLoadImg;
  gsvp.onPanoramaLoad = savePano;
  return loadImg();
};

onComplete = function() {
  return setTimeout(function() {
    fs.renameSync(srcDir, srcDir + ".proxy");
    fs.renameSync(destDir, srcDir);
    return notifier.notify({
      title: "Proxy Replacer",
      message: "All done!",
      sound: true
    });
  }, 2000);
};

//# sourceMappingURL=data:application/json;base64,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QUFoQyxDQUFBLENBQUE7QUFBQSxJQUNBLEVBQUUsQ0FBQyxVQUFILENBQWMsT0FBZCxFQUF1QixNQUF2QixDQURBLENBQUE7V0FHQSxRQUFRLENBQUMsTUFBVCxDQUNDO0FBQUEsTUFBQSxLQUFBLEVBQU8sZ0JBQVA7QUFBQSxNQUNBLE9BQUEsRUFBUyxXQURUO0FBQUEsTUFFQSxLQUFBLEVBQU8sSUFGUDtLQURELEVBSlU7RUFBQSxDQUFYLEVBUUUsSUFSRixFQUZZO0FBQUEsQ0ExTWIsQ0FBQSIsImZpbGUiOiJyZXBsYWNlLXByb3h5LmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiJGNvbnNvbGUgPSBudWxsXG4kcHJvZ1Bhbm8gPSBudWxsXG4kc3RhdFBhbm8gPSBudWxsXG4kcHJvZ1NlcSA9IG51bGxcbiRzdGF0U2VxID0gbnVsbFxuXG5zcmNEaXIgPSBcIlwiXG5kZXN0RGlyID0gXCJcIlxuZmlsZUxpc3QgPSBudWxsXG5cbmdzdmggPSBudWxsXG5cbmJhc2VuYW1lID0gbnVsbFxuc2lzeXBodXMgPSBudWxsXG5cbmdzdnAgPSBudWxsXG5cbnN0YXJ0VGltZSA9IG51bGxcblxuc3MgPSBuZXcgZ29vZ2xlLm1hcHMuU3RyZWV0Vmlld1NlcnZpY2UoKVxuXG5sb2cgPSAoc3RyKSAtPlxuXHQkY29uc29sZS5hcHBlbmQoXCIje3N0cn1cXG5cIilcblx0JGNvbnNvbGUuc2Nyb2xsVG9wID0gJGNvbnNvbGUuc2Nyb2xsSGVpZ2h0XG5cbiQgLT5cblx0JGNvbnNvbGUgPSAkKCcjY29uc29sZScpXG5cdCRwcm9nUGFubyA9ICQoJyNwcm9nLXBhbm8nKVxuXHQkcHJvZ1NlcSA9ICQoJyNwcm9nLXNlcScpXG5cdCRzdGF0UGFubyA9ICQoJyNzdGF0LXBhbm8nKVxuXHQkc3RhdFNlcSA9ICQoJyNzdGF0LXNlcScpXG5cblx0c2lzeXBodXMgPSAkKCcjcmVwbGFjZS1wcm94eScpLnNpc3lwaHVzKClcblxuXHQkKCcjZGVjb2RlJykub24gJ2NsaWNrJywgZGVjb2RlXG5cblx0JCgnW25hbWU9ZmlsZV0nKS5vbiAnY2hhbmdlJywgLT5cblx0XHQkKCdbbmFtZT1zb3VyY2VdJylcblx0XHRcdC52YWwoICQoJ1tuYW1lPWZpbGVdJykudmFsKCkgKVxuXHRcdHNpc3lwaHVzLnNhdmVBbGxEYXRhKClcblxuXHRnc3ZwID0gbmV3IEdTVlBBTk8uUGFub0xvYWRlclxuXHRcdHpvb206IHBhcnNlSW50KCAkKCdbbmFtZT16b29tXScpLnZhbCgpIClcblxuXHRnc3ZwLm9uUHJvZ3Jlc3MgPSAocCkgLT5cblx0XHQkc3RhdFBhbm8uaHRtbChcIiN7cH0lXCIpXG5cdFx0JHByb2dQYW5vLnZhbCggcCApXG5cblxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5kZWNvZGUgPSAtPlxuXHRzcmNEaXIgPSAkKCdbbmFtZT1zb3VyY2VdJykudmFsKClcblxuXHRpZiBzcmNEaXIgPT0gXCJcIlxuXHRcdGFsZXJ0IFwicGxlYXNlIHNlbGVjdCBzb3VyY2UgZGlyZWN0b3J5XCJcblx0XHRyZXR1cm5cblxuXHRmaWxlcyA9IGZzLnJlYWRkaXJTeW5jKHNyY0RpcilcblxuXHRmaWxlTGlzdCA9IChmIGZvciBmIGluIGZpbGVzIHdoZW4gL1xcLnBuZyQvLnRlc3QoZikpXG5cdGJhc2VuYW1lID0gcGF0aC5iYXNlbmFtZSggc3JjRGlyIClcblxuXHRsb2FkKClcblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxubG9hZCA9ICgpIC0+XG5cblx0c3RhcnRUaW1lID0gbmV3IERhdGUoKVxuXG5cdCMgbWFrZSBuZXcgZGlyZWN0b3J5XG5cdGRlc3REaXIgPSBcIiN7cGF0aC5kaXJuYW1lKHNyY0Rpcil9LyN7YmFzZW5hbWV9LkhRXCJcblx0dHJ5XG5cdFx0bWtkaXJwLnN5bmMoZGVzdERpcilcblx0XHQjZnMubWtkaXJTeW5jKGRlc3REaXIpXG5cdGNhdGNoIGVyclxuXHRcdGFsZXJ0KFwiRGVzdGluYXRpb24gZGlyZWN0b3J5IGFscmVhZHkgZXhpc3RzLiBQbGVhc2UgZGVsZXRlICcje2Rlc3REaXJ9JyB0byBjb250aW51ZS5cIilcblxuXHRpbWcgPSBuZXcgSW1hZ2UoKVxuXG5cdHNyY0NhbnZhcyA9ICQoJyNzcmMnKVswXVxuXHRvdXRDYW52YXMgPSAkKCcjb3V0JylbMF1cblxuXHRzcmNDdHggPSBzcmNDYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxuXHRvdXRDdHggPSBvdXRDYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxuXG5cdGlkeCA9IDBcblx0ZmlsZW5hbWUgPSBcIlwiXG5cblx0Iy0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdCMgMS4gbG9hZCBpbWFnZVxuXHRsb2FkSW1nID0gKCkgLT5cblx0XHRlbGFwc2VkID0gKCgobmV3IERhdGUoKSkgLSBzdGFydFRpbWUpIC8gMTAwMCAvIDYwKVxuXHRcdCRzdGF0U2VxLmh0bWwoXCIoI3tpZHgrMX0vI3tmaWxlTGlzdC5sZW5ndGh9KSAje2VsYXBzZWQudG9QcmVjaXNpb24oMil9bWluIGVsYXBzZWRcIilcblx0XHQkcHJvZ1NlcS52YWwoIChpZHgrMSkgLyBmaWxlTGlzdC5sZW5ndGggKiAxMDAgKVxuXG5cblx0XHRmaWxlbmFtZSA9IGZpbGVMaXN0W2lkeF1cblx0XHRpbWcuc3JjID0gXCJmaWxlOi8vLyN7c3JjRGlyfS8je2ZpbGVuYW1lfVwiXG5cblx0Iy0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdCMgMi4gcmVhZCBtYXRyaXggY29kZSBhbmQgc2V0dXAgZ3N2aCBhbmQgcnVuIGNvbXBvc2UoKVxuXHRvbkxvYWRJbWcgPSAtPlxuXG5cdFx0d2lkdGggPSBpbWcud2lkdGhcblx0XHRoZWlnaHQgPSBpbWcuaGVpZ2h0XG5cblx0XHRzcmNDYW52YXMud2lkdGggPSBpbWcud2lkdGhcblx0XHRzcmNDYW52YXMuaGVpZ2h0ID0gaW1nLmhlaWdodFxuXG5cblx0XHRzcmNDdHguZHJhd0ltYWdlKGltZywgMCwgMClcblxuXHRcdCMgcmVhZCBoZWFkaW5nIG9mZnNldFxuXHRcdGhlYWRpbmdPZmZzZXQgPSAwXG5cdFx0eCA9IDBcblx0XHRmb3IgaSBpbiBbMC4uc3JjQ2FudmFzLndpZHRoLTFdXG5cdFx0XHRwaXhlbCA9IHNyY0N0eC5nZXRJbWFnZURhdGEoaSwgODM2LCAxLCAxKS5kYXRhXG5cdFx0XHRpZiBwaXhlbFswXSA+PSAxMjhcblx0XHRcdFx0eCA9IGlcblx0XHRcdFx0aGVhZGluZ09mZnNldCA9ICh4IC8gc3JjQ2FudmFzLndpZHRoKSAqIDM2MFxuXHRcdFx0XHRicmVha1xuXG5cdFx0IyBmaXggdGFnIG9mZnNldFxuXHRcdHNyY0N0eC5kcmF3SW1hZ2UoaW1nLFxuXHRcdFx0MCwgaGVpZ2h0IC0gVEFHX0hFSUdIVCwgd2lkdGgsIFRBR19IRUlHSFQsXG5cdFx0XHQteCwgaGVpZ2h0IC0gVEFHX0hFSUdIVCwgd2lkdGgsIFRBR19IRUlHSFQpXG5cdFx0c3JjQ3R4LmRyYXdJbWFnZShpbWcsXG5cdFx0XHQwLCBoZWlnaHQgLSBUQUdfSEVJR0hULCB3aWR0aCwgVEFHX0hFSUdIVCxcblx0XHRcdC14ICsgd2lkdGgsIGhlaWdodCAtIFRBR19IRUlHSFQsIHdpZHRoLCBUQUdfSEVJR0hUKVxuXG5cdFx0IyBkZWNvZGUgcGFubyBtYXRyaXggY29kZVxuXHRcdHBhbm8gPSBDYW52YXNNYXRyaXhDb2RlLmRlY29kZShcblx0XHRcdHNyY0NhbnZhcyxcblx0XHRcdDAsXG5cdFx0XHRzcmNDYW52YXMuaGVpZ2h0IC0gVEFHX0hFSUdIVCArIDEwLFxuXHRcdFx0MTY2NCwgVEFHX0hFSUdIVCAtIDEwKSNzcmNDYW52YXMud2lkdGgsIFRBR19IRUlHSFQgLSAxMClcblxuXHRcdGNvbnNvbGUubG9nIHBhbm9cblxuXG5cdFx0IyBjaGVjayBpZiB0aGUgcGFubyBpZCBpcyB2YWxpZFxuXHRcdHNzLmdldFBhbm9yYW1hQnlJZCBwYW5vLmlkLCAoZGF0YSwgc3RhdHVzKSAtPlxuXG5cdFx0XHRpZiBzdGF0dXMgPT0gZ29vZ2xlLm1hcHMuU3RyZWV0Vmlld1N0YXR1cy5PS1xuXHRcdFx0XHQjIGdlbmVyYXRlIHBhbm9cblx0XHRcdFx0Z3N2cC5jb21wb3NlUGFub3JhbWEoIHBhbm8uaWQsIHBhbm8uaGVhZGluZyArIGhlYWRpbmdPZmZzZXQgKVxuXHRcdFx0ZWxzZVxuXHRcdFx0XHRjb25zb2xlLmxvZyBcImludmFsaWQgcGFubyBpZDogI3twYW5vLmlkfVwiXG5cblx0XHRcdFx0IyBuZXh0XG5cdFx0XHRcdGlmICsraWR4IDwgZmlsZUxpc3QubGVuZ3RoXG5cdFx0XHRcdFx0bG9hZEltZygpXG5cdFx0XHRcdGVsc2Vcblx0XHRcdFx0XHRvbkNvbXBsZXRlKClcblxuXHQjLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0IyAzLiBtZXJnZSB3aXRoIG1hdHJpeCBjb2RlIGFuZCBzYXZlXG5cdHNhdmVQYW5vID0gLT5cblx0XHRjb25zb2xlLmxvZyBcInNhdmUgcGFub1wiXG5cblxuXHRcdG91dENhbnZhcy53aWR0aCA9IGdzdnAud2lkdGhcblx0XHRvdXRDYW52YXMuaGVpZ2h0ID0gKGltZy5oZWlnaHQgLyBpbWcud2lkdGgpICogZ3N2cC53aWR0aFxuXG5cdFx0IyBkcmF3XG5cdFx0b3V0Q3R4LmZpbGxTdHlsZSA9ICcjMDAwMDAwJ1xuXHRcdG91dEN0eC5maWxsUmVjdCgwLCAwLCBvdXRDYW52YXMud2lkdGgsIG91dENhbnZhcy5oZWlnaHQpXG5cdFx0b3V0Q3R4LmRyYXdJbWFnZShnc3ZwLmNhbnZhcywgMCwgMClcblxuXHRcdCMgZmlscCBcblx0XHRvdXRDdHguc2F2ZSgpXG5cdFx0b3V0Q3R4LnRyYW5zbGF0ZSgwLCBnc3ZwLmNhbnZhcy5oZWlnaHQgKiAyKVxuXHRcdG91dEN0eC5zY2FsZSgxLCAtMSlcblx0XHRvdXRDdHguZHJhd0ltYWdlKGdzdnAuY2FudmFzLCAwLCAwKVxuXHRcdG91dEN0eC5yZXN0b3JlKClcblxuXHRcdCMgY29kZVxuXHRcdG91dEN0eC5kcmF3SW1hZ2UoXG5cdFx0XHRpbWcsXG5cdFx0XHQwLCBpbWcuaGVpZ2h0IC0gVEFHX0hFSUdIVCwgXHRcdGltZy53aWR0aCwgVEFHX0hFSUdIVCxcblx0XHRcdDAsIG91dENhbnZhcy5oZWlnaHQgLSBUQUdfSEVJR0hULCBcdGltZy53aWR0aCwgVEFHX0hFSUdIVClcblxuXHRcdGRlc3QgPSBcIiN7ZGVzdERpcn0vI3tmaWxlbmFtZX1cIlxuXHRcdHNhdmVDYW52YXMoIG91dENhbnZhcywgZGVzdCApXG5cblx0XHQjIG5leHRcblx0XHRpZiArK2lkeCA8IGZpbGVMaXN0Lmxlbmd0aFxuXHRcdFx0bG9hZEltZygpXG5cdFx0ZWxzZVxuXHRcdFx0b25Db21wbGV0ZSgpXG5cblxuXHQjLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0IyB0cmlnZ2VyXG5cdGltZy5vbmxvYWQgPSBvbkxvYWRJbWdcblx0Z3N2cC5vblBhbm9yYW1hTG9hZCA9IHNhdmVQYW5vXG5cblx0bG9hZEltZygpXG5cblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxub25Db21wbGV0ZSA9IC0+XG5cblx0c2V0VGltZW91dCAtPlxuXHRcdGZzLnJlbmFtZVN5bmMoc3JjRGlyLCBcIiN7c3JjRGlyfS5wcm94eVwiKVxuXHRcdGZzLnJlbmFtZVN5bmMoZGVzdERpciwgc3JjRGlyKVxuXG5cdFx0bm90aWZpZXIubm90aWZ5XG5cdFx0XHR0aXRsZTogXCJQcm94eSBSZXBsYWNlclwiXG5cdFx0XHRtZXNzYWdlOiBcIkFsbCBkb25lIVwiXG5cdFx0XHRzb3VuZDogdHJ1ZVxuXHQsIDIwMDBcblxuXG5cdFxuXG5cbiJdfQ==