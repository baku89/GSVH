var canvas, ctx, decode, err, fs, gui, img, load, nativeMenuBar, panoIds, win;

fs = require('fs');

gui = require('nw.gui');

win = gui.Window.get();

nativeMenuBar = new gui.Menu({
  type: 'menubar'
});

try {
  nativeMenuBar.createMacBuiltin('gi-eye');
  win.menu = nativeMenuBar;
} catch (_error) {
  err = _error;
  console.log(err.message);
}

img = new Image();

panoIds = [];

canvas = ctx = null;

$(function() {
  canvas = $('#pv')[0];
  ctx = canvas.getContext('2d');
  return $('#decode').on('click', decode);
});

decode = function() {
  var srcDir;
  srcDir = $('#source').val();
  if (srcDir === "") {
    alert("please select source directory");
    return;
  }
  return fs.readdir(srcDir, function(err, files) {
    var f, list;
    if (err) {
      throw err;
    }
    list = (function() {
      var i, len, results;
      results = [];
      for (i = 0, len = files.length; i < len; i++) {
        f = files[i];
        if (/\.png$/.test(f)) {
          results.push(f);
        }
      }
      return results;
    })();
    return load(srcDir, list);
  });
};

load = function(dir, list) {
  var next;
  next = function(idx) {
    img.onload = function() {
      var pano;
      canvas.width = img.width;
      canvas.height = img.height;
      ctx.drawImage(img, 0, 0);
      pano = CanvasMatrixCode.decode(canvas, 0, canvas.height - 30, canvas.width, 30);
      console.log(pano);
      if (++idx < list.length) {
        return next(idx);
      }
    };
    return img.src = dir + "/" + list[idx];
  };
  return next(0);
};

//# sourceMappingURL=data:application/json;base64,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R0FBUixDQUFZLElBQVosQ0FQQSxDQUFBO0FBU0EsTUFBQSxJQUFHLEVBQUEsR0FBQSxHQUFRLElBQUksQ0FBQyxNQUFoQjtlQUNDLElBQUEsQ0FBSyxHQUFMLEVBREQ7T0FYWTtJQUFBLENBQWIsQ0FBQTtXQWNBLEdBQUcsQ0FBQyxHQUFKLEdBQWEsR0FBRCxHQUFLLEdBQUwsR0FBUSxJQUFLLENBQUEsR0FBQSxFQWZuQjtFQUFBLENBQVAsQ0FBQTtTQWlCQSxJQUFBLENBQUssQ0FBTCxFQW5CTTtBQUFBLENBaERQLENBQUEiLCJmaWxlIjoicmVwbGFjZS1wcm94eS5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbImZzIFx0XHQ9IHJlcXVpcmUgJ2ZzJ1xuZ3VpIFx0PSByZXF1aXJlICdudy5ndWknXG5cblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuIyB3aW5kb3cgc2V0dXBcblxud2luID0gZ3VpLldpbmRvdy5nZXQoKVxubmF0aXZlTWVudUJhciA9IG5ldyBndWkuTWVudSh7dHlwZTogJ21lbnViYXInfSlcblxudHJ5XG5cdG5hdGl2ZU1lbnVCYXIuY3JlYXRlTWFjQnVpbHRpbignZ2ktZXllJylcblx0d2luLm1lbnUgPSBuYXRpdmVNZW51QmFyXG5jYXRjaCBlcnJcblx0Y29uc29sZS5sb2cgZXJyLm1lc3NhZ2VcblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5pbWcgPSBuZXcgSW1hZ2UoKVxuXG5wYW5vSWRzID0gW11cblxuY2FudmFzID0gY3R4ID0gbnVsbFxuXG4kIC0+XG5cdGNhbnZhcyA9ICQoJyNwdicpWzBdXG5cdGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpXG5cblx0JCgnI2RlY29kZScpLm9uICdjbGljaycsIGRlY29kZVxuXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmRlY29kZSA9IC0+XG5cdHNyY0RpciA9ICQoJyNzb3VyY2UnKS52YWwoKVxuXG5cdGlmIHNyY0RpciA9PSBcIlwiXG5cdFx0YWxlcnQgXCJwbGVhc2Ugc2VsZWN0IHNvdXJjZSBkaXJlY3RvcnlcIlxuXHRcdHJldHVyblxuXG5cdGZzLnJlYWRkaXIgc3JjRGlyLCAoZXJyLCBmaWxlcykgLT5cblx0XHRpZiBlcnIgdGhlbiB0aHJvdyBlcnJcblxuXHRcdGxpc3QgPSAoZiBmb3IgZiBpbiBmaWxlcyB3aGVuIC9cXC5wbmckLy50ZXN0KGYpKVxuXG5cdFx0bG9hZChzcmNEaXIsIGxpc3QpXG5cblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxubG9hZCA9IChkaXIsIGxpc3QpIC0+XG5cblx0bmV4dCA9IChpZHgpIC0+XG5cdFx0aW1nLm9ubG9hZCA9IC0+XG5cblx0XHRcdGNhbnZhcy53aWR0aCA9IGltZy53aWR0aFxuXHRcdFx0Y2FudmFzLmhlaWdodCA9IGltZy5oZWlnaHRcblxuXHRcdFx0Y3R4LmRyYXdJbWFnZShpbWcsIDAsIDApXG5cblx0XHRcdHBhbm8gPSBDYW52YXNNYXRyaXhDb2RlLmRlY29kZShjYW52YXMsIDAsIGNhbnZhcy5oZWlnaHQgLSAzMCwgY2FudmFzLndpZHRoLCAzMClcblxuXHRcdFx0Y29uc29sZS5sb2cgcGFub1xuXG5cdFx0XHRpZiArK2lkeCA8IGxpc3QubGVuZ3RoXG5cdFx0XHRcdG5leHQoaWR4KVxuXG5cdFx0aW1nLnNyYyA9IFwiI3tkaXJ9LyN7bGlzdFtpZHhdfVwiXG5cblx0bmV4dCgwKVxuXG5cbiJdfQ==