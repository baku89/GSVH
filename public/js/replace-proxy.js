var $console, $progPano, $progSeq, $statPano, $statSeq, basename, changedList, decode, destDir, fileList, gsvh, gsvp, load, log, onComplete, sisyphus, srcDir, ss, startTime;

$console = null;

$progPano = null;

$statPano = null;

$progSeq = null;

$statSeq = null;

srcDir = "";

destDir = "";

fileList = null;

gsvh = null;

basename = null;

sisyphus = null;

gsvp = null;

startTime = null;

changedList = [];

ss = new google.maps.StreetViewService();

log = function(str) {
  $console.append(str + "\n");
  return $console.scrollTop = $console.scrollHeight;
};

$(function() {
  $console = $('#console');
  $progPano = $('#prog-pano');
  $progSeq = $('#prog-seq');
  $statPano = $('#stat-pano');
  $statSeq = $('#stat-seq');
  sisyphus = $('#replace-proxy').sisyphus();
  $('#decode').on('click', decode);
  $('[name=file]').on('change', function() {
    $('[name=source]').val($('[name=file]').val());
    return sisyphus.saveAllData();
  });
  gsvp = new GSVPANO.PanoLoader({
    zoom: parseInt($('[name=zoom]').val())
  });
  return gsvp.onProgress = function(p) {
    $statPano.html(p + "%");
    return $progPano.val(p);
  };
});

decode = function() {
  var f, files;
  srcDir = $('[name=source]').val();
  if (srcDir === "") {
    alert("please select source directory");
    return;
  }
  files = fs.readdirSync(srcDir);
  fileList = (function() {
    var j, len, results;
    results = [];
    for (j = 0, len = files.length; j < len; j++) {
      f = files[j];
      if (/\.png$/.test(f)) {
        results.push(f);
      }
    }
    return results;
  })();
  basename = path.basename(srcDir);
  return load();
};

load = function() {
  var bChanged, bFlip, err, filename, flipCanvas, flipCtx, idx, img, loadImg, onLoadImg, outCanvas, outCtx, savePano, srcCanvas, srcCtx;
  startTime = new Date();
  destDir = (path.dirname(srcDir)) + "/" + basename + ".HQ";
  try {
    mkdirp.sync(destDir);
  } catch (_error) {
    err = _error;
    alert("Destination directory already exists. Please delete '" + destDir + "' to continue.");
  }
  img = new Image();
  srcCanvas = $('#src')[0];
  outCanvas = $('#out')[0];
  srcCtx = srcCanvas.getContext('2d');
  outCtx = outCanvas.getContext('2d');
  flipCanvas = document.createElement('canvas');
  flipCtx = flipCanvas.getContext('2d');
  bFlip = false;
  bChanged = false;
  idx = 0;
  filename = "";
  changedList = [];
  loadImg = function() {
    var elapsed;
    elapsed = ((new Date()) - startTime) / 1000 / 60;
    $statSeq.html("(" + (idx + 1) + "/" + fileList.length + ") " + (elapsed.toPrecision(2)) + "min elapsed");
    $progSeq.val((idx + 1) / fileList.length * 100);
    filename = fileList[idx];
    return img.src = "file:///" + srcDir + "/" + filename;
  };
  onLoadImg = function() {
    var dest, headingOffset, height, i, j, pano, pixel, pt, ref, width, x;
    width = img.width;
    height = img.height;
    srcCanvas.width = img.width;
    srcCanvas.height = img.height;
    srcCtx.drawImage(img, 0, 0);
    headingOffset = 0;
    x = 0;
    for (i = j = 0, ref = srcCanvas.width - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {
      pixel = srcCtx.getImageData(i, 836, 1, 1).data;
      if (pixel[0] >= 128) {
        x = i;
        headingOffset = (x / srcCanvas.width) * 360;
        break;
      }
    }
    pt = {
      x: ((img.width + x) - 3) % img.width,
      y: 843
    };
    pixel = srcCtx.getImageData(pt.x, pt.y, 1, 1).data;
    if (pixel[0] > 128) {
      bFlip = true;
      x = img.width - (x + 12);
      headingOffset = (x / srcCanvas.width) * 360;
    } else {
      bFlip = false;
    }
    flipCanvas.width = img.width;
    flipCanvas.height = img.height;
    if (bFlip) {
      flipCtx.save();
      flipCtx.scale(-1, 1);
      flipCtx.translate(img.width, 0);
      flipCtx.drawImage(img, 0, 0);
      flipCtx.restore();
    } else {
      flipCtx.drawImage(img, 0, 0);
    }
    srcCtx.drawImage(flipCanvas, 0, height - TAG_HEIGHT, width, TAG_HEIGHT, -x, height - TAG_HEIGHT, width, TAG_HEIGHT);
    srcCtx.drawImage(flipCanvas, 0, height - TAG_HEIGHT, width, TAG_HEIGHT, -x + width, height - TAG_HEIGHT, width, TAG_HEIGHT);
    pano = CanvasMatrixCode.decode(srcCanvas, 0, srcCanvas.height - TAG_HEIGHT + 10, 1664, TAG_HEIGHT - 10);
    if (pano === null) {
      dest = destDir + "/" + filename;
      saveCanvas(srcCanvas, dest);
      setTimeout(function() {
        if (++idx < fileList.length) {
          return loadImg();
        } else {
          return onComplete();
        }
      }, 1);
      return;
    }
    return ss.getPanoramaById(pano.id, function(data, status) {
      var lat, latLng, lng, radius, result, searchNearestPano;
      if (status === google.maps.StreetViewStatus.OK) {
        bChanged = false;
        return gsvp.composePanorama(pano.id, pano.heading + headingOffset);
      } else {
        console.log("invalid pano id: " + pano.id);
        bChanged = true;
        result = /([\-0-9.]+), ([\-0-9.]+)/.exec(pano.latLng);
        lat = result[1];
        lng = result[2];
        latLng = new google.maps.LatLng(lat, lng);
        radius = 1;
        searchNearestPano = function() {
          return ss.getPanoramaByLocation(latLng, radius, function(data, status) {
            var changedInfo, id;
            if (status === google.maps.StreetViewStatus.OK) {
              id = data.location.pano;
              changedInfo = {
                filename: filename,
                oldId: pano.id,
                newId: id,
                oldLatLng: latLng.toString(),
                newLatLng: data.location.latLng.toString(),
                radius: radius
              };
              changedList.push(changedInfo);
              console.log("nearest pano: " + pano.id + " -> " + id + ", radius: " + radius);
              return gsvp.composePanorama(id, pano.heading + headingOffset);
            } else {
              radius++;
              return setTimeout(searchNearestPano, 500);
            }
          });
        };
        return searchNearestPano();
      }
    });
  };
  savePano = function() {
    var dest;
    console.log("save pano");
    outCanvas.width = gsvp.width;
    outCanvas.height = (img.height / img.width) * gsvp.width;
    outCtx.fillStyle = '#000000';
    outCtx.fillRect(0, 0, outCanvas.width, outCanvas.height);
    if (bFlip) {
      console.log("fliped");
      outCtx.save();
      outCtx.scale(-1, 1);
      outCtx.translate(gsvp.canvas.width, 0);
    }
    outCtx.drawImage(gsvp.canvas, 0, 0);
    if (bFlip) {
      outCtx.restore();
    }
    outCtx.save();
    outCtx.translate(0, gsvp.canvas.height * 2);
    outCtx.scale(1, -1);
    outCtx.drawImage(gsvp.canvas, 0, 0);
    outCtx.restore();
    outCtx.drawImage(img, 0, img.height - TAG_HEIGHT, img.width, TAG_HEIGHT, 0, outCanvas.height - TAG_HEIGHT, img.width, TAG_HEIGHT);
    if (bChanged) {
      outCtx.fillStyle = '#ff0000';
      outCtx.fillRect(outCanvas.width - 40, outCanvas.height - 40, 40, 40);
    }
    dest = destDir + "/" + filename;
    saveCanvas(outCanvas, dest);
    if (++idx < fileList.length) {
      return loadImg();
    } else {
      return onComplete();
    }
  };
  img.onload = onLoadImg;
  gsvp.onPanoramaLoad = savePano;
  return loadImg();
};

onComplete = function() {
  return setTimeout(function() {
    var changedTxt;
    changedTxt = JSON.stringify(changedList);
    fs.writeFile(destDir + "/_report.txt", changedTxt);
    fs.renameSync(srcDir, srcDir + ".proxy");
    fs.renameSync(destDir, srcDir);
    return notifier.notify({
      title: "Proxy Replacer",
      message: "All done!",
      sound: true
    });
  }, 3000);
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlcGxhY2UtcHJveHkuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUEsd0tBQUE7O0FBQUEsUUFBQSxHQUFXLElBQVgsQ0FBQTs7QUFBQSxTQUNBLEdBQVksSUFEWixDQUFBOztBQUFBLFNBRUEsR0FBWSxJQUZaLENBQUE7O0FBQUEsUUFHQSxHQUFXLElBSFgsQ0FBQTs7QUFBQSxRQUlBLEdBQVcsSUFKWCxDQUFBOztBQUFBLE1BTUEsR0FBUyxFQU5ULENBQUE7O0FBQUEsT0FPQSxHQUFVLEVBUFYsQ0FBQTs7QUFBQSxRQVFBLEdBQVcsSUFSWCxDQUFBOztBQUFBLElBVUEsR0FBTyxJQVZQLENBQUE7O0FBQUEsUUFZQSxHQUFXLElBWlgsQ0FBQTs7QUFBQSxRQWFBLEdBQVcsSUFiWCxDQUFBOztBQUFBLElBZUEsR0FBTyxJQWZQLENBQUE7O0FBQUEsU0FpQkEsR0FBWSxJQWpCWixDQUFBOztBQUFBLFdBbUJBLEdBQWMsRUFuQmQsQ0FBQTs7QUFBQSxFQXFCQSxHQUFTLElBQUEsTUFBTSxDQUFDLElBQUksQ0FBQyxpQkFBWixDQUFBLENBckJULENBQUE7O0FBQUEsR0F1QkEsR0FBTSxTQUFDLEdBQUQsR0FBQTtBQUNMLEVBQUEsUUFBUSxDQUFDLE1BQVQsQ0FBbUIsR0FBRCxHQUFLLElBQXZCLENBQUEsQ0FBQTtTQUNBLFFBQVEsQ0FBQyxTQUFULEdBQXFCLFFBQVEsQ0FBQyxhQUZ6QjtBQUFBLENBdkJOLENBQUE7O0FBQUEsQ0EyQkEsQ0FBRSxTQUFBLEdBQUE7QUFDRCxFQUFBLFFBQUEsR0FBVyxDQUFBLENBQUUsVUFBRixDQUFYLENBQUE7QUFBQSxFQUNBLFNBQUEsR0FBWSxDQUFBLENBQUUsWUFBRixDQURaLENBQUE7QUFBQSxFQUVBLFFBQUEsR0FBVyxDQUFBLENBQUUsV0FBRixDQUZYLENBQUE7QUFBQSxFQUdBLFNBQUEsR0FBWSxDQUFBLENBQUUsWUFBRixDQUhaLENBQUE7QUFBQSxFQUlBLFFBQUEsR0FBVyxDQUFBLENBQUUsV0FBRixDQUpYLENBQUE7QUFBQSxFQU1BLFFBQUEsR0FBVyxDQUFBLENBQUUsZ0JBQUYsQ0FBbUIsQ0FBQyxRQUFwQixDQUFBLENBTlgsQ0FBQTtBQUFBLEVBUUEsQ0FBQSxDQUFFLFNBQUYsQ0FBWSxDQUFDLEVBQWIsQ0FBZ0IsT0FBaEIsRUFBeUIsTUFBekIsQ0FSQSxDQUFBO0FBQUEsRUFVQSxDQUFBLENBQUUsYUFBRixDQUFnQixDQUFDLEVBQWpCLENBQW9CLFFBQXBCLEVBQThCLFNBQUEsR0FBQTtBQUM3QixJQUFBLENBQUEsQ0FBRSxlQUFGLENBQ0MsQ0FBQyxHQURGLENBQ08sQ0FBQSxDQUFFLGFBQUYsQ0FBZ0IsQ0FBQyxHQUFqQixDQUFBLENBRFAsQ0FBQSxDQUFBO1dBRUEsUUFBUSxDQUFDLFdBQVQsQ0FBQSxFQUg2QjtFQUFBLENBQTlCLENBVkEsQ0FBQTtBQUFBLEVBZUEsSUFBQSxHQUFXLElBQUEsT0FBTyxDQUFDLFVBQVIsQ0FDVjtBQUFBLElBQUEsSUFBQSxFQUFNLFFBQUEsQ0FBVSxDQUFBLENBQUUsYUFBRixDQUFnQixDQUFDLEdBQWpCLENBQUEsQ0FBVixDQUFOO0dBRFUsQ0FmWCxDQUFBO1NBa0JBLElBQUksQ0FBQyxVQUFMLEdBQWtCLFNBQUMsQ0FBRCxHQUFBO0FBQ2pCLElBQUEsU0FBUyxDQUFDLElBQVYsQ0FBa0IsQ0FBRCxHQUFHLEdBQXBCLENBQUEsQ0FBQTtXQUNBLFNBQVMsQ0FBQyxHQUFWLENBQWUsQ0FBZixFQUZpQjtFQUFBLEVBbkJqQjtBQUFBLENBQUYsQ0EzQkEsQ0FBQTs7QUFBQSxNQXFEQSxHQUFTLFNBQUEsR0FBQTtBQUNSLE1BQUEsUUFBQTtBQUFBLEVBQUEsTUFBQSxHQUFTLENBQUEsQ0FBRSxlQUFGLENBQWtCLENBQUMsR0FBbkIsQ0FBQSxDQUFULENBQUE7QUFFQSxFQUFBLElBQUcsTUFBQSxLQUFVLEVBQWI7QUFDQyxJQUFBLEtBQUEsQ0FBTSxnQ0FBTixDQUFBLENBQUE7QUFDQSxVQUFBLENBRkQ7R0FGQTtBQUFBLEVBTUEsS0FBQSxHQUFRLEVBQUUsQ0FBQyxXQUFILENBQWUsTUFBZixDQU5SLENBQUE7QUFBQSxFQVFBLFFBQUE7O0FBQVk7U0FBQSx1Q0FBQTttQkFBQTtVQUFzQixRQUFRLENBQUMsSUFBVCxDQUFjLENBQWQ7QUFBdEIscUJBQUEsRUFBQTtPQUFBO0FBQUE7O01BUlosQ0FBQTtBQUFBLEVBU0EsUUFBQSxHQUFXLElBQUksQ0FBQyxRQUFMLENBQWUsTUFBZixDQVRYLENBQUE7U0FXQSxJQUFBLENBQUEsRUFaUTtBQUFBLENBckRULENBQUE7O0FBQUEsSUFvRUEsR0FBTyxTQUFBLEdBQUE7QUFFTixNQUFBLGlJQUFBO0FBQUEsRUFBQSxTQUFBLEdBQWdCLElBQUEsSUFBQSxDQUFBLENBQWhCLENBQUE7QUFBQSxFQUdBLE9BQUEsR0FBWSxDQUFDLElBQUksQ0FBQyxPQUFMLENBQWEsTUFBYixDQUFELENBQUEsR0FBc0IsR0FBdEIsR0FBeUIsUUFBekIsR0FBa0MsS0FIOUMsQ0FBQTtBQUlBO0FBQ0MsSUFBQSxNQUFNLENBQUMsSUFBUCxDQUFZLE9BQVosQ0FBQSxDQUREO0dBQUEsY0FBQTtBQUlDLElBREssWUFDTCxDQUFBO0FBQUEsSUFBQSxLQUFBLENBQU0sdURBQUEsR0FBd0QsT0FBeEQsR0FBZ0UsZ0JBQXRFLENBQUEsQ0FKRDtHQUpBO0FBQUEsRUFVQSxHQUFBLEdBQVUsSUFBQSxLQUFBLENBQUEsQ0FWVixDQUFBO0FBQUEsRUFZQSxTQUFBLEdBQVksQ0FBQSxDQUFFLE1BQUYsQ0FBVSxDQUFBLENBQUEsQ0FadEIsQ0FBQTtBQUFBLEVBYUEsU0FBQSxHQUFZLENBQUEsQ0FBRSxNQUFGLENBQVUsQ0FBQSxDQUFBLENBYnRCLENBQUE7QUFBQSxFQWVBLE1BQUEsR0FBUyxTQUFTLENBQUMsVUFBVixDQUFxQixJQUFyQixDQWZULENBQUE7QUFBQSxFQWdCQSxNQUFBLEdBQVMsU0FBUyxDQUFDLFVBQVYsQ0FBcUIsSUFBckIsQ0FoQlQsQ0FBQTtBQUFBLEVBa0JBLFVBQUEsR0FBYSxRQUFRLENBQUMsYUFBVCxDQUF1QixRQUF2QixDQWxCYixDQUFBO0FBQUEsRUFtQkEsT0FBQSxHQUFVLFVBQVUsQ0FBQyxVQUFYLENBQXNCLElBQXRCLENBbkJWLENBQUE7QUFBQSxFQXFCQSxLQUFBLEdBQVEsS0FyQlIsQ0FBQTtBQUFBLEVBc0JBLFFBQUEsR0FBVyxLQXRCWCxDQUFBO0FBQUEsRUF3QkEsR0FBQSxHQUFNLENBeEJOLENBQUE7QUFBQSxFQXlCQSxRQUFBLEdBQVcsRUF6QlgsQ0FBQTtBQUFBLEVBMkJBLFdBQUEsR0FBYyxFQTNCZCxDQUFBO0FBQUEsRUErQkEsT0FBQSxHQUFVLFNBQUEsR0FBQTtBQUNULFFBQUEsT0FBQTtBQUFBLElBQUEsT0FBQSxHQUFXLENBQUMsQ0FBSyxJQUFBLElBQUEsQ0FBQSxDQUFMLENBQUEsR0FBZSxTQUFoQixDQUFBLEdBQTZCLElBQTdCLEdBQW9DLEVBQS9DLENBQUE7QUFBQSxJQUNBLFFBQVEsQ0FBQyxJQUFULENBQWMsR0FBQSxHQUFHLENBQUMsR0FBQSxHQUFJLENBQUwsQ0FBSCxHQUFVLEdBQVYsR0FBYSxRQUFRLENBQUMsTUFBdEIsR0FBNkIsSUFBN0IsR0FBZ0MsQ0FBQyxPQUFPLENBQUMsV0FBUixDQUFvQixDQUFwQixDQUFELENBQWhDLEdBQXdELGFBQXRFLENBREEsQ0FBQTtBQUFBLElBRUEsUUFBUSxDQUFDLEdBQVQsQ0FBYyxDQUFDLEdBQUEsR0FBSSxDQUFMLENBQUEsR0FBVSxRQUFRLENBQUMsTUFBbkIsR0FBNEIsR0FBMUMsQ0FGQSxDQUFBO0FBQUEsSUFLQSxRQUFBLEdBQVcsUUFBUyxDQUFBLEdBQUEsQ0FMcEIsQ0FBQTtXQU1BLEdBQUcsQ0FBQyxHQUFKLEdBQVUsVUFBQSxHQUFXLE1BQVgsR0FBa0IsR0FBbEIsR0FBcUIsU0FQdEI7RUFBQSxDQS9CVixDQUFBO0FBQUEsRUEwQ0EsU0FBQSxHQUFZLFNBQUEsR0FBQTtBQUVYLFFBQUEsaUVBQUE7QUFBQSxJQUFBLEtBQUEsR0FBUSxHQUFHLENBQUMsS0FBWixDQUFBO0FBQUEsSUFDQSxNQUFBLEdBQVMsR0FBRyxDQUFDLE1BRGIsQ0FBQTtBQUFBLElBR0EsU0FBUyxDQUFDLEtBQVYsR0FBa0IsR0FBRyxDQUFDLEtBSHRCLENBQUE7QUFBQSxJQUlBLFNBQVMsQ0FBQyxNQUFWLEdBQW1CLEdBQUcsQ0FBQyxNQUp2QixDQUFBO0FBQUEsSUFPQSxNQUFNLENBQUMsU0FBUCxDQUFpQixHQUFqQixFQUFzQixDQUF0QixFQUF5QixDQUF6QixDQVBBLENBQUE7QUFBQSxJQVVBLGFBQUEsR0FBZ0IsQ0FWaEIsQ0FBQTtBQUFBLElBV0EsQ0FBQSxHQUFJLENBWEosQ0FBQTtBQVlBLFNBQVMsOEZBQVQsR0FBQTtBQUNDLE1BQUEsS0FBQSxHQUFRLE1BQU0sQ0FBQyxZQUFQLENBQW9CLENBQXBCLEVBQXVCLEdBQXZCLEVBQTRCLENBQTVCLEVBQStCLENBQS9CLENBQWlDLENBQUMsSUFBMUMsQ0FBQTtBQUNBLE1BQUEsSUFBRyxLQUFNLENBQUEsQ0FBQSxDQUFOLElBQVksR0FBZjtBQUNDLFFBQUEsQ0FBQSxHQUFJLENBQUosQ0FBQTtBQUFBLFFBQ0EsYUFBQSxHQUFnQixDQUFDLENBQUEsR0FBSSxTQUFTLENBQUMsS0FBZixDQUFBLEdBQXdCLEdBRHhDLENBQUE7QUFFQSxjQUhEO09BRkQ7QUFBQSxLQVpBO0FBQUEsSUFvQkEsRUFBQSxHQUNDO0FBQUEsTUFBQSxDQUFBLEVBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFKLEdBQVksQ0FBYixDQUFBLEdBQWtCLENBQW5CLENBQUEsR0FBd0IsR0FBRyxDQUFDLEtBQS9CO0FBQUEsTUFDQSxDQUFBLEVBQUcsR0FESDtLQXJCRCxDQUFBO0FBQUEsSUF3QkEsS0FBQSxHQUFRLE1BQU0sQ0FBQyxZQUFQLENBQW9CLEVBQUUsQ0FBQyxDQUF2QixFQUEwQixFQUFFLENBQUMsQ0FBN0IsRUFBZ0MsQ0FBaEMsRUFBbUMsQ0FBbkMsQ0FBcUMsQ0FBQyxJQXhCOUMsQ0FBQTtBQXlCQSxJQUFBLElBQUcsS0FBTSxDQUFBLENBQUEsQ0FBTixHQUFXLEdBQWQ7QUFDQyxNQUFBLEtBQUEsR0FBUSxJQUFSLENBQUE7QUFBQSxNQUNBLENBQUEsR0FBSSxHQUFHLENBQUMsS0FBSixHQUFZLENBQUMsQ0FBQSxHQUFFLEVBQUgsQ0FEaEIsQ0FBQTtBQUFBLE1BRUEsYUFBQSxHQUFnQixDQUFDLENBQUEsR0FBSSxTQUFTLENBQUMsS0FBZixDQUFBLEdBQXdCLEdBRnhDLENBREQ7S0FBQSxNQUFBO0FBS0MsTUFBQSxLQUFBLEdBQVEsS0FBUixDQUxEO0tBekJBO0FBQUEsSUFpQ0EsVUFBVSxDQUFDLEtBQVgsR0FBbUIsR0FBRyxDQUFDLEtBakN2QixDQUFBO0FBQUEsSUFrQ0EsVUFBVSxDQUFDLE1BQVgsR0FBb0IsR0FBRyxDQUFDLE1BbEN4QixDQUFBO0FBb0NBLElBQUEsSUFBRyxLQUFIO0FBQ0MsTUFBQSxPQUFPLENBQUMsSUFBUixDQUFBLENBQUEsQ0FBQTtBQUFBLE1BQ0EsT0FBTyxDQUFDLEtBQVIsQ0FBYyxDQUFBLENBQWQsRUFBa0IsQ0FBbEIsQ0FEQSxDQUFBO0FBQUEsTUFFQSxPQUFPLENBQUMsU0FBUixDQUFrQixHQUFHLENBQUMsS0FBdEIsRUFBNkIsQ0FBN0IsQ0FGQSxDQUFBO0FBQUEsTUFHQSxPQUFPLENBQUMsU0FBUixDQUFtQixHQUFuQixFQUF3QixDQUF4QixFQUEyQixDQUEzQixDQUhBLENBQUE7QUFBQSxNQUlBLE9BQU8sQ0FBQyxPQUFSLENBQUEsQ0FKQSxDQUREO0tBQUEsTUFBQTtBQVFDLE1BQUEsT0FBTyxDQUFDLFNBQVIsQ0FBbUIsR0FBbkIsRUFBd0IsQ0FBeEIsRUFBMkIsQ0FBM0IsQ0FBQSxDQVJEO0tBcENBO0FBQUEsSUErQ0EsTUFBTSxDQUFDLFNBQVAsQ0FBaUIsVUFBakIsRUFDQyxDQURELEVBQ0ksTUFBQSxHQUFTLFVBRGIsRUFDeUIsS0FEekIsRUFDZ0MsVUFEaEMsRUFFQyxDQUFBLENBRkQsRUFFSyxNQUFBLEdBQVMsVUFGZCxFQUUwQixLQUYxQixFQUVpQyxVQUZqQyxDQS9DQSxDQUFBO0FBQUEsSUFrREEsTUFBTSxDQUFDLFNBQVAsQ0FBaUIsVUFBakIsRUFDQyxDQURELEVBQ0ksTUFBQSxHQUFTLFVBRGIsRUFDeUIsS0FEekIsRUFDZ0MsVUFEaEMsRUFFQyxDQUFBLENBQUEsR0FBSyxLQUZOLEVBRWEsTUFBQSxHQUFTLFVBRnRCLEVBRWtDLEtBRmxDLEVBRXlDLFVBRnpDLENBbERBLENBQUE7QUFBQSxJQXVEQSxJQUFBLEdBQU8sZ0JBQWdCLENBQUMsTUFBakIsQ0FDTixTQURNLEVBRU4sQ0FGTSxFQUdOLFNBQVMsQ0FBQyxNQUFWLEdBQW1CLFVBQW5CLEdBQWdDLEVBSDFCLEVBSU4sSUFKTSxFQUlBLFVBQUEsR0FBYSxFQUpiLENBdkRQLENBQUE7QUE2REEsSUFBQSxJQUFHLElBQUEsS0FBUSxJQUFYO0FBQ0MsTUFBQSxJQUFBLEdBQVUsT0FBRCxHQUFTLEdBQVQsR0FBWSxRQUFyQixDQUFBO0FBQUEsTUFDQSxVQUFBLENBQVksU0FBWixFQUF1QixJQUF2QixDQURBLENBQUE7QUFBQSxNQUdBLFVBQUEsQ0FBVyxTQUFBLEdBQUE7QUFDVixRQUFBLElBQUcsRUFBQSxHQUFBLEdBQVEsUUFBUSxDQUFDLE1BQXBCO2lCQUNDLE9BQUEsQ0FBQSxFQUREO1NBQUEsTUFBQTtpQkFHQyxVQUFBLENBQUEsRUFIRDtTQURVO01BQUEsQ0FBWCxFQUtFLENBTEYsQ0FIQSxDQUFBO0FBU0EsWUFBQSxDQVZEO0tBN0RBO1dBMEVBLEVBQUUsQ0FBQyxlQUFILENBQW1CLElBQUksQ0FBQyxFQUF4QixFQUE0QixTQUFDLElBQUQsRUFBTyxNQUFQLEdBQUE7QUFFM0IsVUFBQSxtREFBQTtBQUFBLE1BQUEsSUFBRyxNQUFBLEtBQVUsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxFQUExQztBQUVDLFFBQUEsUUFBQSxHQUFXLEtBQVgsQ0FBQTtlQUNBLElBQUksQ0FBQyxlQUFMLENBQXNCLElBQUksQ0FBQyxFQUEzQixFQUErQixJQUFJLENBQUMsT0FBTCxHQUFlLGFBQTlDLEVBSEQ7T0FBQSxNQUFBO0FBT0MsUUFBQSxPQUFPLENBQUMsR0FBUixDQUFZLG1CQUFBLEdBQW9CLElBQUksQ0FBQyxFQUFyQyxDQUFBLENBQUE7QUFBQSxRQUNBLFFBQUEsR0FBVyxJQURYLENBQUE7QUFBQSxRQUdBLE1BQUEsR0FBUywwQkFBMEIsQ0FBQyxJQUEzQixDQUFnQyxJQUFJLENBQUMsTUFBckMsQ0FIVCxDQUFBO0FBQUEsUUFJQSxHQUFBLEdBQU0sTUFBTyxDQUFBLENBQUEsQ0FKYixDQUFBO0FBQUEsUUFLQSxHQUFBLEdBQU0sTUFBTyxDQUFBLENBQUEsQ0FMYixDQUFBO0FBQUEsUUFNQSxNQUFBLEdBQWEsSUFBQSxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQVosQ0FBbUIsR0FBbkIsRUFBd0IsR0FBeEIsQ0FOYixDQUFBO0FBQUEsUUFTQSxNQUFBLEdBQVMsQ0FUVCxDQUFBO0FBQUEsUUFXQSxpQkFBQSxHQUFvQixTQUFBLEdBQUE7aUJBQ25CLEVBQUUsQ0FBQyxxQkFBSCxDQUF5QixNQUF6QixFQUFpQyxNQUFqQyxFQUF5QyxTQUFDLElBQUQsRUFBTyxNQUFQLEdBQUE7QUFDeEMsZ0JBQUEsZUFBQTtBQUFBLFlBQUEsSUFBRyxNQUFBLEtBQVUsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxFQUExQztBQUNDLGNBQUEsRUFBQSxHQUFLLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBbkIsQ0FBQTtBQUFBLGNBR0EsV0FBQSxHQUNDO0FBQUEsZ0JBQUEsUUFBQSxFQUFVLFFBQVY7QUFBQSxnQkFDQSxLQUFBLEVBQU8sSUFBSSxDQUFDLEVBRFo7QUFBQSxnQkFFQSxLQUFBLEVBQU8sRUFGUDtBQUFBLGdCQUdBLFNBQUEsRUFBVyxNQUFNLENBQUMsUUFBUCxDQUFBLENBSFg7QUFBQSxnQkFJQSxTQUFBLEVBQVcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsUUFBckIsQ0FBQSxDQUpYO0FBQUEsZ0JBS0EsTUFBQSxFQUFRLE1BTFI7ZUFKRCxDQUFBO0FBQUEsY0FXQSxXQUFXLENBQUMsSUFBWixDQUFrQixXQUFsQixDQVhBLENBQUE7QUFBQSxjQWFBLE9BQU8sQ0FBQyxHQUFSLENBQVksZ0JBQUEsR0FBaUIsSUFBSSxDQUFDLEVBQXRCLEdBQXlCLE1BQXpCLEdBQStCLEVBQS9CLEdBQWtDLFlBQWxDLEdBQThDLE1BQTFELENBYkEsQ0FBQTtxQkFjQSxJQUFJLENBQUMsZUFBTCxDQUFzQixFQUF0QixFQUEwQixJQUFJLENBQUMsT0FBTCxHQUFlLGFBQXpDLEVBZkQ7YUFBQSxNQUFBO0FBaUJDLGNBQUEsTUFBQSxFQUFBLENBQUE7cUJBQ0EsVUFBQSxDQUFXLGlCQUFYLEVBQThCLEdBQTlCLEVBbEJEO2FBRHdDO1VBQUEsQ0FBekMsRUFEbUI7UUFBQSxDQVhwQixDQUFBO2VBaUNBLGlCQUFBLENBQUEsRUF4Q0Q7T0FGMkI7SUFBQSxDQUE1QixFQTVFVztFQUFBLENBMUNaLENBQUE7QUFBQSxFQW9LQSxRQUFBLEdBQVcsU0FBQSxHQUFBO0FBQ1YsUUFBQSxJQUFBO0FBQUEsSUFBQSxPQUFPLENBQUMsR0FBUixDQUFZLFdBQVosQ0FBQSxDQUFBO0FBQUEsSUFFQSxTQUFTLENBQUMsS0FBVixHQUFrQixJQUFJLENBQUMsS0FGdkIsQ0FBQTtBQUFBLElBR0EsU0FBUyxDQUFDLE1BQVYsR0FBbUIsQ0FBQyxHQUFHLENBQUMsTUFBSixHQUFhLEdBQUcsQ0FBQyxLQUFsQixDQUFBLEdBQTJCLElBQUksQ0FBQyxLQUhuRCxDQUFBO0FBQUEsSUFNQSxNQUFNLENBQUMsU0FBUCxHQUFtQixTQU5uQixDQUFBO0FBQUEsSUFPQSxNQUFNLENBQUMsUUFBUCxDQUFnQixDQUFoQixFQUFtQixDQUFuQixFQUFzQixTQUFTLENBQUMsS0FBaEMsRUFBdUMsU0FBUyxDQUFDLE1BQWpELENBUEEsQ0FBQTtBQVNBLElBQUEsSUFBRyxLQUFIO0FBQ0MsTUFBQSxPQUFPLENBQUMsR0FBUixDQUFZLFFBQVosQ0FBQSxDQUFBO0FBQUEsTUFDQSxNQUFNLENBQUMsSUFBUCxDQUFBLENBREEsQ0FBQTtBQUFBLE1BRUEsTUFBTSxDQUFDLEtBQVAsQ0FBYSxDQUFBLENBQWIsRUFBaUIsQ0FBakIsQ0FGQSxDQUFBO0FBQUEsTUFHQSxNQUFNLENBQUMsU0FBUCxDQUFpQixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQTdCLEVBQW9DLENBQXBDLENBSEEsQ0FERDtLQVRBO0FBQUEsSUFlQSxNQUFNLENBQUMsU0FBUCxDQUFpQixJQUFJLENBQUMsTUFBdEIsRUFBOEIsQ0FBOUIsRUFBaUMsQ0FBakMsQ0FmQSxDQUFBO0FBaUJBLElBQUEsSUFBRyxLQUFIO0FBQ0MsTUFBQSxNQUFNLENBQUMsT0FBUCxDQUFBLENBQUEsQ0FERDtLQWpCQTtBQUFBLElBcUJBLE1BQU0sQ0FBQyxJQUFQLENBQUEsQ0FyQkEsQ0FBQTtBQUFBLElBc0JBLE1BQU0sQ0FBQyxTQUFQLENBQWlCLENBQWpCLEVBQW9CLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBWixHQUFxQixDQUF6QyxDQXRCQSxDQUFBO0FBQUEsSUF1QkEsTUFBTSxDQUFDLEtBQVAsQ0FBYSxDQUFiLEVBQWdCLENBQUEsQ0FBaEIsQ0F2QkEsQ0FBQTtBQUFBLElBd0JBLE1BQU0sQ0FBQyxTQUFQLENBQWlCLElBQUksQ0FBQyxNQUF0QixFQUE4QixDQUE5QixFQUFpQyxDQUFqQyxDQXhCQSxDQUFBO0FBQUEsSUF5QkEsTUFBTSxDQUFDLE9BQVAsQ0FBQSxDQXpCQSxDQUFBO0FBQUEsSUE0QkEsTUFBTSxDQUFDLFNBQVAsQ0FDQyxHQURELEVBRUMsQ0FGRCxFQUVJLEdBQUcsQ0FBQyxNQUFKLEdBQWEsVUFGakIsRUFFK0IsR0FBRyxDQUFDLEtBRm5DLEVBRTBDLFVBRjFDLEVBR0MsQ0FIRCxFQUdJLFNBQVMsQ0FBQyxNQUFWLEdBQW1CLFVBSHZCLEVBR29DLEdBQUcsQ0FBQyxLQUh4QyxFQUcrQyxVQUgvQyxDQTVCQSxDQUFBO0FBa0NBLElBQUEsSUFBRyxRQUFIO0FBQ0MsTUFBQSxNQUFNLENBQUMsU0FBUCxHQUFtQixTQUFuQixDQUFBO0FBQUEsTUFDQSxNQUFNLENBQUMsUUFBUCxDQUFnQixTQUFTLENBQUMsS0FBVixHQUFnQixFQUFoQyxFQUFvQyxTQUFTLENBQUMsTUFBVixHQUFpQixFQUFyRCxFQUF5RCxFQUF6RCxFQUE2RCxFQUE3RCxDQURBLENBREQ7S0FsQ0E7QUFBQSxJQXNDQSxJQUFBLEdBQVUsT0FBRCxHQUFTLEdBQVQsR0FBWSxRQXRDckIsQ0FBQTtBQUFBLElBdUNBLFVBQUEsQ0FBWSxTQUFaLEVBQXVCLElBQXZCLENBdkNBLENBQUE7QUE0Q0EsSUFBQSxJQUFHLEVBQUEsR0FBQSxHQUFRLFFBQVEsQ0FBQyxNQUFwQjthQUNDLE9BQUEsQ0FBQSxFQUREO0tBQUEsTUFBQTthQUdDLFVBQUEsQ0FBQSxFQUhEO0tBN0NVO0VBQUEsQ0FwS1gsQ0FBQTtBQUFBLEVBd05BLEdBQUcsQ0FBQyxNQUFKLEdBQWEsU0F4TmIsQ0FBQTtBQUFBLEVBeU5BLElBQUksQ0FBQyxjQUFMLEdBQXNCLFFBek50QixDQUFBO1NBMk5BLE9BQUEsQ0FBQSxFQTdOTTtBQUFBLENBcEVQLENBQUE7O0FBQUEsVUFxU0EsR0FBYSxTQUFBLEdBQUE7U0FFWixVQUFBLENBQVcsU0FBQSxHQUFBO0FBRVYsUUFBQSxVQUFBO0FBQUEsSUFBQSxVQUFBLEdBQWEsSUFBSSxDQUFDLFNBQUwsQ0FBZ0IsV0FBaEIsQ0FBYixDQUFBO0FBQUEsSUFFQSxFQUFFLENBQUMsU0FBSCxDQUFnQixPQUFELEdBQVMsY0FBeEIsRUFBdUMsVUFBdkMsQ0FGQSxDQUFBO0FBQUEsSUFJQSxFQUFFLENBQUMsVUFBSCxDQUFjLE1BQWQsRUFBeUIsTUFBRCxHQUFRLFFBQWhDLENBSkEsQ0FBQTtBQUFBLElBS0EsRUFBRSxDQUFDLFVBQUgsQ0FBYyxPQUFkLEVBQXVCLE1BQXZCLENBTEEsQ0FBQTtXQU9BLFFBQVEsQ0FBQyxNQUFULENBQ0M7QUFBQSxNQUFBLEtBQUEsRUFBTyxnQkFBUDtBQUFBLE1BQ0EsT0FBQSxFQUFTLFdBRFQ7QUFBQSxNQUVBLEtBQUEsRUFBTyxJQUZQO0tBREQsRUFUVTtFQUFBLENBQVgsRUFhRSxJQWJGLEVBRlk7QUFBQSxDQXJTYixDQUFBIiwiZmlsZSI6InJlcGxhY2UtcHJveHkuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyIkY29uc29sZSA9IG51bGxcbiRwcm9nUGFubyA9IG51bGxcbiRzdGF0UGFubyA9IG51bGxcbiRwcm9nU2VxID0gbnVsbFxuJHN0YXRTZXEgPSBudWxsXG5cbnNyY0RpciA9IFwiXCJcbmRlc3REaXIgPSBcIlwiXG5maWxlTGlzdCA9IG51bGxcblxuZ3N2aCA9IG51bGxcblxuYmFzZW5hbWUgPSBudWxsXG5zaXN5cGh1cyA9IG51bGxcblxuZ3N2cCA9IG51bGxcblxuc3RhcnRUaW1lID0gbnVsbFxuXG5jaGFuZ2VkTGlzdCA9IFtdXG5cbnNzID0gbmV3IGdvb2dsZS5tYXBzLlN0cmVldFZpZXdTZXJ2aWNlKClcblxubG9nID0gKHN0cikgLT5cblx0JGNvbnNvbGUuYXBwZW5kKFwiI3tzdHJ9XFxuXCIpXG5cdCRjb25zb2xlLnNjcm9sbFRvcCA9ICRjb25zb2xlLnNjcm9sbEhlaWdodFxuXG4kIC0+XG5cdCRjb25zb2xlID0gJCgnI2NvbnNvbGUnKVxuXHQkcHJvZ1Bhbm8gPSAkKCcjcHJvZy1wYW5vJylcblx0JHByb2dTZXEgPSAkKCcjcHJvZy1zZXEnKVxuXHQkc3RhdFBhbm8gPSAkKCcjc3RhdC1wYW5vJylcblx0JHN0YXRTZXEgPSAkKCcjc3RhdC1zZXEnKVxuXG5cdHNpc3lwaHVzID0gJCgnI3JlcGxhY2UtcHJveHknKS5zaXN5cGh1cygpXG5cblx0JCgnI2RlY29kZScpLm9uICdjbGljaycsIGRlY29kZVxuXG5cdCQoJ1tuYW1lPWZpbGVdJykub24gJ2NoYW5nZScsIC0+XG5cdFx0JCgnW25hbWU9c291cmNlXScpXG5cdFx0XHQudmFsKCAkKCdbbmFtZT1maWxlXScpLnZhbCgpIClcblx0XHRzaXN5cGh1cy5zYXZlQWxsRGF0YSgpXG5cblx0Z3N2cCA9IG5ldyBHU1ZQQU5PLlBhbm9Mb2FkZXJcblx0XHR6b29tOiBwYXJzZUludCggJCgnW25hbWU9em9vbV0nKS52YWwoKSApXG5cblx0Z3N2cC5vblByb2dyZXNzID0gKHApIC0+XG5cdFx0JHN0YXRQYW5vLmh0bWwoXCIje3B9JVwiKVxuXHRcdCRwcm9nUGFuby52YWwoIHAgKVxuXG5cblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZGVjb2RlID0gLT5cblx0c3JjRGlyID0gJCgnW25hbWU9c291cmNlXScpLnZhbCgpXG5cblx0aWYgc3JjRGlyID09IFwiXCJcblx0XHRhbGVydCBcInBsZWFzZSBzZWxlY3Qgc291cmNlIGRpcmVjdG9yeVwiXG5cdFx0cmV0dXJuXG5cblx0ZmlsZXMgPSBmcy5yZWFkZGlyU3luYyhzcmNEaXIpXG5cblx0ZmlsZUxpc3QgPSAoZiBmb3IgZiBpbiBmaWxlcyB3aGVuIC9cXC5wbmckLy50ZXN0KGYpKVxuXHRiYXNlbmFtZSA9IHBhdGguYmFzZW5hbWUoIHNyY0RpciApXG5cblx0bG9hZCgpXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmxvYWQgPSAoKSAtPlxuXG5cdHN0YXJ0VGltZSA9IG5ldyBEYXRlKClcblxuXHQjIG1ha2UgbmV3IGRpcmVjdG9yeVxuXHRkZXN0RGlyID0gXCIje3BhdGguZGlybmFtZShzcmNEaXIpfS8je2Jhc2VuYW1lfS5IUVwiXG5cdHRyeVxuXHRcdG1rZGlycC5zeW5jKGRlc3REaXIpXG5cdFx0I2ZzLm1rZGlyU3luYyhkZXN0RGlyKVxuXHRjYXRjaCBlcnJcblx0XHRhbGVydChcIkRlc3RpbmF0aW9uIGRpcmVjdG9yeSBhbHJlYWR5IGV4aXN0cy4gUGxlYXNlIGRlbGV0ZSAnI3tkZXN0RGlyfScgdG8gY29udGludWUuXCIpXG5cblx0aW1nID0gbmV3IEltYWdlKClcblxuXHRzcmNDYW52YXMgPSAkKCcjc3JjJylbMF1cblx0b3V0Q2FudmFzID0gJCgnI291dCcpWzBdXG5cblx0c3JjQ3R4ID0gc3JjQ2FudmFzLmdldENvbnRleHQoJzJkJylcblx0b3V0Q3R4ID0gb3V0Q2FudmFzLmdldENvbnRleHQoJzJkJylcblxuXHRmbGlwQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJylcblx0ZmxpcEN0eCA9IGZsaXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxuXG5cdGJGbGlwID0gZmFsc2Vcblx0YkNoYW5nZWQgPSBmYWxzZVxuXG5cdGlkeCA9IDBcblx0ZmlsZW5hbWUgPSBcIlwiXG5cblx0Y2hhbmdlZExpc3QgPSBbXVxuXG5cdCMtLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHQjIDEuIGxvYWQgaW1hZ2Vcblx0bG9hZEltZyA9ICgpIC0+XG5cdFx0ZWxhcHNlZCA9ICgoKG5ldyBEYXRlKCkpIC0gc3RhcnRUaW1lKSAvIDEwMDAgLyA2MClcblx0XHQkc3RhdFNlcS5odG1sKFwiKCN7aWR4KzF9LyN7ZmlsZUxpc3QubGVuZ3RofSkgI3tlbGFwc2VkLnRvUHJlY2lzaW9uKDIpfW1pbiBlbGFwc2VkXCIpXG5cdFx0JHByb2dTZXEudmFsKCAoaWR4KzEpIC8gZmlsZUxpc3QubGVuZ3RoICogMTAwIClcblxuXG5cdFx0ZmlsZW5hbWUgPSBmaWxlTGlzdFtpZHhdXG5cdFx0aW1nLnNyYyA9IFwiZmlsZTovLy8je3NyY0Rpcn0vI3tmaWxlbmFtZX1cIlxuXG5cdCMtLS0tLS0tLS0tLS0tLS0tLS0tLVxuXHQjIDIuIHJlYWQgbWF0cml4IGNvZGUgYW5kIHNldHVwIGdzdmggYW5kIHJ1biBjb21wb3NlKClcblx0b25Mb2FkSW1nID0gLT5cblxuXHRcdHdpZHRoID0gaW1nLndpZHRoXG5cdFx0aGVpZ2h0ID0gaW1nLmhlaWdodFxuXG5cdFx0c3JjQ2FudmFzLndpZHRoID0gaW1nLndpZHRoXG5cdFx0c3JjQ2FudmFzLmhlaWdodCA9IGltZy5oZWlnaHRcblxuXG5cdFx0c3JjQ3R4LmRyYXdJbWFnZShpbWcsIDAsIDApXG5cblx0XHQjIHJlYWQgaGVhZGluZyBvZmZzZXRcblx0XHRoZWFkaW5nT2Zmc2V0ID0gMFxuXHRcdHggPSAwXG5cdFx0Zm9yIGkgaW4gWzAuLnNyY0NhbnZhcy53aWR0aC0xXVxuXHRcdFx0cGl4ZWwgPSBzcmNDdHguZ2V0SW1hZ2VEYXRhKGksIDgzNiwgMSwgMSkuZGF0YVxuXHRcdFx0aWYgcGl4ZWxbMF0gPj0gMTI4XG5cdFx0XHRcdHggPSBpXG5cdFx0XHRcdGhlYWRpbmdPZmZzZXQgPSAoeCAvIHNyY0NhbnZhcy53aWR0aCkgKiAzNjBcblx0XHRcdFx0YnJlYWtcblxuXHRcdCMgcmVhZCBpZiBmbGlwZWRcblx0XHRwdCA9XG5cdFx0XHR4OiAoKGltZy53aWR0aCArIHgpIC0gMykgJSBpbWcud2lkdGhcblx0XHRcdHk6IDg0M1xuXG5cdFx0cGl4ZWwgPSBzcmNDdHguZ2V0SW1hZ2VEYXRhKHB0LngsIHB0LnksIDEsIDEpLmRhdGFcblx0XHRpZiBwaXhlbFswXSA+IDEyOFxuXHRcdFx0YkZsaXAgPSB0cnVlXG5cdFx0XHR4ID0gaW1nLndpZHRoIC0gKHgrMTIpXG5cdFx0XHRoZWFkaW5nT2Zmc2V0ID0gKHggLyBzcmNDYW52YXMud2lkdGgpICogMzYwXG5cdFx0ZWxzZVxuXHRcdFx0YkZsaXAgPSBmYWxzZVxuXG5cdFx0IyBmaXggdGFnIG9mZnNldFxuXHRcdGZsaXBDYW52YXMud2lkdGggPSBpbWcud2lkdGhcblx0XHRmbGlwQ2FudmFzLmhlaWdodCA9IGltZy5oZWlnaHRcblxuXHRcdGlmIGJGbGlwXG5cdFx0XHRmbGlwQ3R4LnNhdmUoKVxuXHRcdFx0ZmxpcEN0eC5zY2FsZSgtMSwgMSlcblx0XHRcdGZsaXBDdHgudHJhbnNsYXRlKGltZy53aWR0aCwgMClcblx0XHRcdGZsaXBDdHguZHJhd0ltYWdlKCBpbWcsIDAsIDAgKVxuXHRcdFx0ZmxpcEN0eC5yZXN0b3JlKClcblxuXHRcdGVsc2Vcblx0XHRcdGZsaXBDdHguZHJhd0ltYWdlKCBpbWcsIDAsIDAgKVxuXG5cblx0XHRzcmNDdHguZHJhd0ltYWdlKGZsaXBDYW52YXMsXG5cdFx0XHQwLCBoZWlnaHQgLSBUQUdfSEVJR0hULCB3aWR0aCwgVEFHX0hFSUdIVCxcblx0XHRcdC14LCBoZWlnaHQgLSBUQUdfSEVJR0hULCB3aWR0aCwgVEFHX0hFSUdIVClcblx0XHRzcmNDdHguZHJhd0ltYWdlKGZsaXBDYW52YXMsXG5cdFx0XHQwLCBoZWlnaHQgLSBUQUdfSEVJR0hULCB3aWR0aCwgVEFHX0hFSUdIVCxcblx0XHRcdC14ICsgd2lkdGgsIGhlaWdodCAtIFRBR19IRUlHSFQsIHdpZHRoLCBUQUdfSEVJR0hUKVxuXG5cdFx0IyBkZWNvZGUgcGFubyBtYXRyaXggY29kZVxuXHRcdHBhbm8gPSBDYW52YXNNYXRyaXhDb2RlLmRlY29kZShcblx0XHRcdHNyY0NhbnZhcyxcblx0XHRcdDAsXG5cdFx0XHRzcmNDYW52YXMuaGVpZ2h0IC0gVEFHX0hFSUdIVCArIDEwLFxuXHRcdFx0MTY2NCwgVEFHX0hFSUdIVCAtIDEwKVxuXG5cdFx0aWYgcGFubyA9PSBudWxsXG5cdFx0XHRkZXN0ID0gXCIje2Rlc3REaXJ9LyN7ZmlsZW5hbWV9XCJcblx0XHRcdHNhdmVDYW52YXMoIHNyY0NhbnZhcywgZGVzdCApXG5cblx0XHRcdHNldFRpbWVvdXQgLT5cblx0XHRcdFx0aWYgKytpZHggPCBmaWxlTGlzdC5sZW5ndGhcblx0XHRcdFx0XHRsb2FkSW1nKClcblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdG9uQ29tcGxldGUoKVxuXHRcdFx0LCAxXG5cdFx0XHRyZXR1cm5cblxuXHRcdCMgY2hlY2sgaWYgdGhlIHBhbm8gaWQgaXMgdmFsaWRcblx0XHRzcy5nZXRQYW5vcmFtYUJ5SWQgcGFuby5pZCwgKGRhdGEsIHN0YXR1cykgLT5cblxuXHRcdFx0aWYgc3RhdHVzID09IGdvb2dsZS5tYXBzLlN0cmVldFZpZXdTdGF0dXMuT0sgXG5cdFx0XHRcdCMgZ2VuZXJhdGUgcGFub1xuXHRcdFx0XHRiQ2hhbmdlZCA9IGZhbHNlXG5cdFx0XHRcdGdzdnAuY29tcG9zZVBhbm9yYW1hKCBwYW5vLmlkLCBwYW5vLmhlYWRpbmcgKyBoZWFkaW5nT2Zmc2V0IClcblx0XHRcdGVsc2VcblxuXG5cdFx0XHRcdGNvbnNvbGUubG9nIFwiaW52YWxpZCBwYW5vIGlkOiAje3Bhbm8uaWR9XCJcblx0XHRcdFx0YkNoYW5nZWQgPSB0cnVlXG5cblx0XHRcdFx0cmVzdWx0ID0gLyhbXFwtMC05Ll0rKSwgKFtcXC0wLTkuXSspLy5leGVjKHBhbm8ubGF0TG5nKVxuXHRcdFx0XHRsYXQgPSByZXN1bHRbMV1cblx0XHRcdFx0bG5nID0gcmVzdWx0WzJdXG5cdFx0XHRcdGxhdExuZyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcobGF0LCBsbmcpXG5cblx0XHRcdFx0IyBzZWFyY2ggbmVhcmVzdCBwYW5vXG5cdFx0XHRcdHJhZGl1cyA9IDFcblxuXHRcdFx0XHRzZWFyY2hOZWFyZXN0UGFubyA9IC0+XG5cdFx0XHRcdFx0c3MuZ2V0UGFub3JhbWFCeUxvY2F0aW9uIGxhdExuZywgcmFkaXVzLCAoZGF0YSwgc3RhdHVzKSAtPlxuXHRcdFx0XHRcdFx0aWYgc3RhdHVzID09IGdvb2dsZS5tYXBzLlN0cmVldFZpZXdTdGF0dXMuT0tcblx0XHRcdFx0XHRcdFx0aWQgPSBkYXRhLmxvY2F0aW9uLnBhbm9cblxuXG5cdFx0XHRcdFx0XHRcdGNoYW5nZWRJbmZvID0gXG5cdFx0XHRcdFx0XHRcdFx0ZmlsZW5hbWU6IGZpbGVuYW1lXG5cdFx0XHRcdFx0XHRcdFx0b2xkSWQ6IHBhbm8uaWRcblx0XHRcdFx0XHRcdFx0XHRuZXdJZDogaWRcblx0XHRcdFx0XHRcdFx0XHRvbGRMYXRMbmc6IGxhdExuZy50b1N0cmluZygpXG5cdFx0XHRcdFx0XHRcdFx0bmV3TGF0TG5nOiBkYXRhLmxvY2F0aW9uLmxhdExuZy50b1N0cmluZygpXG5cdFx0XHRcdFx0XHRcdFx0cmFkaXVzOiByYWRpdXNcblxuXHRcdFx0XHRcdFx0XHRjaGFuZ2VkTGlzdC5wdXNoKCBjaGFuZ2VkSW5mbyApXG5cblx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2cgXCJuZWFyZXN0IHBhbm86ICN7cGFuby5pZH0gLT4gI3tpZH0sIHJhZGl1czogI3tyYWRpdXN9XCJcblx0XHRcdFx0XHRcdFx0Z3N2cC5jb21wb3NlUGFub3JhbWEoIGlkLCBwYW5vLmhlYWRpbmcgKyBoZWFkaW5nT2Zmc2V0IClcblx0XHRcdFx0XHRcdGVsc2Vcblx0XHRcdFx0XHRcdFx0cmFkaXVzKytcblx0XHRcdFx0XHRcdFx0c2V0VGltZW91dChzZWFyY2hOZWFyZXN0UGFubywgNTAwKVxuXG5cdFx0XHRcdHNlYXJjaE5lYXJlc3RQYW5vKClcblxuXHQjLS0tLS0tLS0tLS0tLS0tLS0tLS1cblx0IyAzLiBtZXJnZSB3aXRoIG1hdHJpeCBjb2RlIGFuZCBzYXZlXG5cdHNhdmVQYW5vID0gLT5cblx0XHRjb25zb2xlLmxvZyBcInNhdmUgcGFub1wiXG5cblx0XHRvdXRDYW52YXMud2lkdGggPSBnc3ZwLndpZHRoXG5cdFx0b3V0Q2FudmFzLmhlaWdodCA9IChpbWcuaGVpZ2h0IC8gaW1nLndpZHRoKSAqIGdzdnAud2lkdGhcblxuXHRcdCMgZHJhd1xuXHRcdG91dEN0eC5maWxsU3R5bGUgPSAnIzAwMDAwMCdcblx0XHRvdXRDdHguZmlsbFJlY3QoMCwgMCwgb3V0Q2FudmFzLndpZHRoLCBvdXRDYW52YXMuaGVpZ2h0KVxuXG5cdFx0aWYgYkZsaXBcblx0XHRcdGNvbnNvbGUubG9nIFwiZmxpcGVkXCJcblx0XHRcdG91dEN0eC5zYXZlKClcblx0XHRcdG91dEN0eC5zY2FsZSgtMSwgMSlcblx0XHRcdG91dEN0eC50cmFuc2xhdGUoZ3N2cC5jYW52YXMud2lkdGgsIDApXG5cblx0XHRvdXRDdHguZHJhd0ltYWdlKGdzdnAuY2FudmFzLCAwLCAwKVxuXG5cdFx0aWYgYkZsaXBcblx0XHRcdG91dEN0eC5yZXN0b3JlKClcblxuXHRcdCMgZmlscCBcblx0XHRvdXRDdHguc2F2ZSgpXG5cdFx0b3V0Q3R4LnRyYW5zbGF0ZSgwLCBnc3ZwLmNhbnZhcy5oZWlnaHQgKiAyKVxuXHRcdG91dEN0eC5zY2FsZSgxLCAtMSlcblx0XHRvdXRDdHguZHJhd0ltYWdlKGdzdnAuY2FudmFzLCAwLCAwKVxuXHRcdG91dEN0eC5yZXN0b3JlKClcblxuXHRcdCMgY29kZVxuXHRcdG91dEN0eC5kcmF3SW1hZ2UoXG5cdFx0XHRpbWcsXG5cdFx0XHQwLCBpbWcuaGVpZ2h0IC0gVEFHX0hFSUdIVCwgXHRcdGltZy53aWR0aCwgVEFHX0hFSUdIVCxcblx0XHRcdDAsIG91dENhbnZhcy5oZWlnaHQgLSBUQUdfSEVJR0hULCBcdGltZy53aWR0aCwgVEFHX0hFSUdIVClcblxuXHRcdCMgY2hhbmdlZFxuXHRcdGlmIGJDaGFuZ2VkXG5cdFx0XHRvdXRDdHguZmlsbFN0eWxlID0gJyNmZjAwMDAnXG5cdFx0XHRvdXRDdHguZmlsbFJlY3Qob3V0Q2FudmFzLndpZHRoLTQwLCBvdXRDYW52YXMuaGVpZ2h0LTQwLCA0MCwgNDApXG5cblx0XHRkZXN0ID0gXCIje2Rlc3REaXJ9LyN7ZmlsZW5hbWV9XCJcblx0XHRzYXZlQ2FudmFzKCBvdXRDYW52YXMsIGRlc3QgKVxuXG5cdFx0XG5cblx0XHQjIG5leHRcblx0XHRpZiArK2lkeCA8IGZpbGVMaXN0Lmxlbmd0aFxuXHRcdFx0bG9hZEltZygpXG5cdFx0ZWxzZVxuXHRcdFx0b25Db21wbGV0ZSgpXG5cblx0Iy0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cdCMgdHJpZ2dlclxuXHRpbWcub25sb2FkID0gb25Mb2FkSW1nXG5cdGdzdnAub25QYW5vcmFtYUxvYWQgPSBzYXZlUGFub1xuXG5cdGxvYWRJbWcoKVxuXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbm9uQ29tcGxldGUgPSAtPlxuXG5cdHNldFRpbWVvdXQgLT5cblxuXHRcdGNoYW5nZWRUeHQgPSBKU09OLnN0cmluZ2lmeSggY2hhbmdlZExpc3QgKVxuXG5cdFx0ZnMud3JpdGVGaWxlKFwiI3tkZXN0RGlyfS9fcmVwb3J0LnR4dFwiLCBjaGFuZ2VkVHh0KVxuXG5cdFx0ZnMucmVuYW1lU3luYyhzcmNEaXIsIFwiI3tzcmNEaXJ9LnByb3h5XCIpXG5cdFx0ZnMucmVuYW1lU3luYyhkZXN0RGlyLCBzcmNEaXIpXG5cblx0XHRub3RpZmllci5ub3RpZnlcblx0XHRcdHRpdGxlOiBcIlByb3h5IFJlcGxhY2VyXCJcblx0XHRcdG1lc3NhZ2U6IFwiQWxsIGRvbmUhXCJcblx0XHRcdHNvdW5kOiB0cnVlXG5cdCwgMzAwMFxuXG5cblx0XG5cblxuIl19