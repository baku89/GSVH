var GL_MAX_WIDTH, GSVPANO, tiles;

GSVPANO = GSVPANO || {};

GL_MAX_WIDTH = 4096;

tiles = null;

GSVPANO.PanoLoader = (function() {
  var _applyRotFx, _composeFromTile, _count, _ctx, _heading, _hqCanvas, _hqCtx, _originHeading, _originPitch, _panoClient, _rotFx, _throwError, _tilesCanvas, _total, _zoom;

  _zoom = null;

  _panoClient = new google.maps.StreetViewService();

  _count = 0;

  _total = 0;

  _heading = 0;

  _originHeading = 0;

  _originPitch = 0;

  _tilesCanvas = document.createElement('canvas');

  _hqCanvas = document.createElement('canvas');

  _ctx = _tilesCanvas.getContext('2d');

  _hqCtx = _hqCanvas.getContext('2d');

  _rotFx = null;

  function PanoLoader(parameters) {
    var ref;
    parameters = parameters != null ? parameters : {};
    _rotFx = Glsl({
      canvas: document.createElement('canvas'),
      fragment: document.getElementById("pano-rotation").textContent,
      variables: {
        heading: 0.0,
        pitch: 0.0,
        original: _tilesCanvas,
        size: [0.0, 0.0],
        offset: [0.0, 0.0]
      }
    });
    this.onError = null;
    this.onProgress = function() {};
    this.onSizeChange = function() {};
    this.onPanoramaLoad = function() {};
    this.setZoom((ref = parameters.zoom) != null ? ref : 2);
    this.c2 = _tilesCanvas;
    $('[name=width], [name=height]').on('change', function() {
      _rotFx.setSize(parseInt($('[name=width]').val()), parseInt($('[name=height]').val()));
      _rotFx.syncAll();
      return _rotFx.render();
    });
  }

  _throwError = function(message) {
    if (this.onError != null) {
      return this.onError(message);
    } else {
      return console.error(message);
    }
  };

  _composeFromTile = function(x, y, texture) {
    var p;
    _ctx.drawImage(texture, x * 512, y * 512);
    _count++;
    p = Math.round(_count * 100 / _total);
    this.onProgress(p);
    if (_count === _total) {
      _applyRotFx.call(this);
      return this.onPanoramaLoad();
    }
  };

  _applyRotFx = function() {
    var glh, glw, h, i, j, ref, ref1, w, x, y;
    _rotFx.set('heading', (_originHeading - _heading).toRad());
    _rotFx.set('pitch', _originPitch.toRad());
    if (this.width < GL_MAX_WIDTH && this.height < GL_MAX_WIDTH) {
      _rotFx.setSize(this.width, this.height);
      _rotFx.set('size', [this.width, this.height]);
      _rotFx.set('offset', [0.0, 0.0]);
      _rotFx.syncAll();
      _rotFx.render();
      return this.canvas = _rotFx.canvas;
    } else {
      _hqCanvas.width = this.width;
      _hqCanvas.height = this.height;
      w = Math.ceil(this.width / GL_MAX_WIDTH);
      h = Math.ceil(this.height / GL_MAX_WIDTH);
      x = y = 0;
      glw = Math.min(this.width, GL_MAX_WIDTH);
      glh = Math.min(this.height, GL_MAX_WIDTH);
      _rotFx.setSize(glw, glh);
      _rotFx.set('size', [this.width, this.height]);
      for (y = i = 0, ref = h - 1; 0 <= ref ? i <= ref : i >= ref; y = 0 <= ref ? ++i : --i) {
        for (x = j = 0, ref1 = w - 1; 0 <= ref1 ? j <= ref1 : j >= ref1; x = 0 <= ref1 ? ++j : --j) {
          _rotFx.set('offset', [x * GL_MAX_WIDTH, y * GL_MAX_WIDTH]);
          _rotFx.syncAll();
          _rotFx.render();
          _hqCtx.drawImage(_rotFx.canvas, x * GL_MAX_WIDTH, this.height - (y + 1) * glh);
        }
      }
      return this.canvas = _hqCanvas;
    }
  };

  PanoLoader.prototype.composePanorama = function(panoId, heading) {
    _heading = heading != null ? heading : 0;
    this.onProgress(0);
    return _panoClient.getPanoramaById(panoId, (function(_this) {
      return function(data, status) {
        var h, i, ref, results, url, w, x, y;
        if (status !== google.maps.StreetViewStatus.OK) {
          _throwError("Cound not retrieve panorama for the following reason: wrong pano id");
          return;
        }
        tiles = data.tiles;
        _originHeading = tiles.originHeading;
        _originPitch = tiles.originPitch;
        w = Math.ceil(_this.width / 512);
        h = Math.ceil(_this.height / 512);
        x = y = 0;
        url = null;
        _count = 0;
        _total = w * h;
        results = [];
        for (y = i = 0, ref = h - 1; 0 <= ref ? i <= ref : i >= ref; y = 0 <= ref ? ++i : --i) {
          results.push((function() {
            var j, ref1, results1;
            results1 = [];
            for (x = j = 0, ref1 = w - 1; 0 <= ref1 ? j <= ref1 : j >= ref1; x = 0 <= ref1 ? ++j : --j) {
              url = "https://cbks0.googleapis.com/cbk?output=tile&zoom=" + _zoom + "&x=" + x + "&y=" + y + "&panoid=" + panoId + "&" + (Date.now());
              results1.push((function(_this) {
                return function(x, y) {
                  var img;
                  img = new Image();
                  img.onload = function() {
                    return _composeFromTile.call(_this, x, y, img);
                  };
                  img.crossOrigin = "";
                  return img.src = url;
                };
              })(this)(x, y));
            }
            return results1;
          }).call(_this));
        }
        return results;
      };
    })(this));
  };

  PanoLoader.prototype.setZoom = function(z) {
    _zoom = z;
    this.width = 416 * Math.pow(2, _zoom);
    this.height = 416 * Math.pow(2, _zoom - 1);
    _tilesCanvas.width = this.width;
    _tilesCanvas.height = this.height;
    _ctx.translate(_tilesCanvas.width, 0);
    _ctx.scale(-1, 1);
    _rotFx.setSize(this.width, this.height);
    return this.onSizeChange();
  };

  return PanoLoader;

})();

//# sourceMappingURL=data:application/json;base64,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LENBQUMsR0FBSixHQUFVLElBTFI7Z0JBQUEsRUFBQTtjQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBSCxDQUFJLENBQUosRUFBTyxDQUFQLEVBRkEsQ0FERDtBQUFBOzt5QkFBQSxDQUREO0FBQUE7dUJBbkJtQztNQUFBLEVBQUE7SUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQXBDLEVBTmdCO0VBQUEsQ0F4R2pCLENBQUE7O0FBQUEsdUJBNElBLE9BQUEsR0FBUyxTQUFFLENBQUYsR0FBQTtBQUNSLElBQUEsS0FBQSxHQUFRLENBQVIsQ0FBQTtBQUFBLElBRUEsSUFBQyxDQUFBLEtBQUQsR0FBUyxHQUFBLEdBQU0sSUFBSSxDQUFDLEdBQUwsQ0FBUyxDQUFULEVBQVksS0FBWixDQUZmLENBQUE7QUFBQSxJQUdBLElBQUMsQ0FBQSxNQUFELEdBQVcsR0FBQSxHQUFNLElBQUksQ0FBQyxHQUFMLENBQVMsQ0FBVCxFQUFZLEtBQUEsR0FBUSxDQUFwQixDQUhqQixDQUFBO0FBQUEsSUFLQSxZQUFZLENBQUMsS0FBYixHQUFxQixJQUFDLENBQUEsS0FMdEIsQ0FBQTtBQUFBLElBTUEsWUFBWSxDQUFDLE1BQWIsR0FBc0IsSUFBQyxDQUFBLE1BTnZCLENBQUE7QUFBQSxJQU9BLElBQUksQ0FBQyxTQUFMLENBQWdCLFlBQVksQ0FBQyxLQUE3QixFQUFvQyxDQUFwQyxDQVBBLENBQUE7QUFBQSxJQVFBLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBQSxDQUFYLEVBQWUsQ0FBZixDQVJBLENBQUE7QUFBQSxJQVVBLE1BQU0sQ0FBQyxPQUFQLENBQWUsSUFBQyxDQUFBLEtBQWhCLEVBQXVCLElBQUMsQ0FBQSxNQUF4QixDQVZBLENBQUE7V0FZQSxJQUFDLENBQUEsWUFBRCxDQUFBLEVBYlE7RUFBQSxDQTVJVCxDQUFBOztvQkFBQTs7SUFURCxDQUFBIiwiZmlsZSI6IkdTVlBhbm8uanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJHU1ZQQU5PID0gR1NWUEFOTyB8fCB7fVxuXG5HTF9NQVhfV0lEVEggPSA0MDk2XG5cbnRpbGVzID0gbnVsbFxuXG5jbGFzcyBHU1ZQQU5PLlBhbm9Mb2FkZXJcblxuXHQjIHByaXZhdGUgdmFyaWFibGVzXG5cdF96b29tID0gbnVsbFxuXHRfcGFub0NsaWVudCA9IG5ldyBnb29nbGUubWFwcy5TdHJlZXRWaWV3U2VydmljZSgpXG5cdF9jb3VudCA9IDBcblx0X3RvdGFsID0gMFxuXHRfaGVhZGluZyA9IDBcblx0X29yaWdpbkhlYWRpbmcgPSAwXG5cdF9vcmlnaW5QaXRjaCA9IDBcblx0X3RpbGVzQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJylcblx0X2hxQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJylcblx0X2N0eCA9IF90aWxlc0NhbnZhcy5nZXRDb250ZXh0KCcyZCcpXG5cdF9ocUN0eCA9IF9ocUNhbnZhcy5nZXRDb250ZXh0KCcyZCcpXG5cdF9yb3RGeCA9IG51bGxcblxuXHRjb25zdHJ1Y3RvcjogKHBhcmFtZXRlcnMpIC0+XG5cdFx0cGFyYW1ldGVycyA9IHBhcmFtZXRlcnMgPyB7fVxuXG5cdFx0X3JvdEZ4ID0gR2xzbFxuXHRcdFx0Y2FudmFzOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKVxuXHRcdFx0ZnJhZ21lbnQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGFuby1yb3RhdGlvblwiKS50ZXh0Q29udGVudFxuXHRcdFx0dmFyaWFibGVzOlxuXHRcdFx0XHRoZWFkaW5nOiAgMC4wXG5cdFx0XHRcdHBpdGNoOiAwLjBcblx0XHRcdFx0b3JpZ2luYWw6IF90aWxlc0NhbnZhc1xuXHRcdFx0XHRzaXplOiBbMC4wLCAwLjBdXG5cdFx0XHRcdG9mZnNldDogWzAuMCwgMC4wXVxuXG5cdFx0IyBldmVudFxuXHRcdEBvbkVycm9yID0gbnVsbFxuXHRcdEBvblByb2dyZXNzID0gKCkgLT5cblx0XHRAb25TaXplQ2hhbmdlID0gKCkgLT5cblx0XHRAb25QYW5vcmFtYUxvYWQgPSAoKSAtPlxuXG5cdFx0QHNldFpvb20oIHBhcmFtZXRlcnMuem9vbSA/IDIgKVxuXG5cdFx0QGMyID0gX3RpbGVzQ2FudmFzXG5cblx0XHQkKCdbbmFtZT13aWR0aF0sIFtuYW1lPWhlaWdodF0nKS5vbiAnY2hhbmdlJywgLT5cblx0XHRcdF9yb3RGeC5zZXRTaXplKCBwYXJzZUludCgkKCdbbmFtZT13aWR0aF0nKS52YWwoKSksIHBhcnNlSW50KCQoJ1tuYW1lPWhlaWdodF0nKS52YWwoKSkgKVxuXHRcdFx0X3JvdEZ4LnN5bmNBbGwoKVxuXHRcdFx0X3JvdEZ4LnJlbmRlcigpXG5cblx0XHRcblx0IyBwcml2YXRlIE1ldGhvZFxuXHRfdGhyb3dFcnJvciA9IChtZXNzYWdlKSAtPlxuXHRcdGlmIHRoaXMub25FcnJvcj9cblx0XHRcdHRoaXMub25FcnJvcihtZXNzYWdlKVxuXHRcdGVsc2Vcblx0XHRcdGNvbnNvbGUuZXJyb3IobWVzc2FnZSlcblxuXHRfY29tcG9zZUZyb21UaWxlID0gKHgsIHksIHRleHR1cmUpIC0+XG5cdFx0X2N0eC5kcmF3SW1hZ2UodGV4dHVyZSwgeCAqIDUxMiwgeSAqIDUxMilcblx0XHRfY291bnQrK1xuXHRcdFxuXHRcdHAgPSBNYXRoLnJvdW5kKF9jb3VudCAqIDEwMCAvIF90b3RhbClcblx0XHRAb25Qcm9ncmVzcyhwKVxuXHRcdFxuXHRcdGlmIF9jb3VudCA9PSBfdG90YWxcblx0XHRcdF9hcHBseVJvdEZ4LmNhbGwoQClcblx0XHRcdEBvblBhbm9yYW1hTG9hZCgpXG5cblx0X2FwcGx5Um90RnggPSAtPlxuXG5cdFx0X3JvdEZ4LnNldCgnaGVhZGluZycsIChfb3JpZ2luSGVhZGluZyAtIF9oZWFkaW5nKS50b1JhZCgpKVxuXHRcdF9yb3RGeC5zZXQoJ3BpdGNoJywgX29yaWdpblBpdGNoLnRvUmFkKCkpXG5cblx0XHRpZiBAd2lkdGggPCBHTF9NQVhfV0lEVEggJiYgQGhlaWdodCA8IEdMX01BWF9XSURUSFxuXHRcdFx0IyBub3JtYWxcblx0XHRcdF9yb3RGeC5zZXRTaXplKEB3aWR0aCwgQGhlaWdodClcblx0XHRcdF9yb3RGeC5zZXQoJ3NpemUnLCBbQHdpZHRoLCBAaGVpZ2h0XSlcblx0XHRcdF9yb3RGeC5zZXQoJ29mZnNldCcsIFswLjAsIDAuMF0pXG5cdFx0XHRfcm90Rnguc3luY0FsbCgpXG5cdFx0XHRfcm90RngucmVuZGVyKClcblxuXHRcdFx0QGNhbnZhcyA9IF9yb3RGeC5jYW52YXNcblxuXHRcdGVsc2Vcblx0XHRcdCMgdGlsaW5nXG5cdFx0XHRfaHFDYW52YXMud2lkdGggPSBAd2lkdGhcblx0XHRcdF9ocUNhbnZhcy5oZWlnaHQgPSBAaGVpZ2h0XG5cblx0XHRcdHcgPSBNYXRoLmNlaWwoQHdpZHRoIC8gR0xfTUFYX1dJRFRIKVxuXHRcdFx0aCA9IE1hdGguY2VpbChAaGVpZ2h0IC8gR0xfTUFYX1dJRFRIKVxuXHRcdFx0eCA9IHkgPSAwXG5cblx0XHRcdGdsdyA9IE1hdGgubWluKEB3aWR0aCwgR0xfTUFYX1dJRFRIKVxuXHRcdFx0Z2xoID0gTWF0aC5taW4oQGhlaWdodCwgR0xfTUFYX1dJRFRIKVxuXHRcdFx0XG5cdFx0XHRfcm90Rnguc2V0U2l6ZShnbHcsIGdsaClcblx0XHRcdF9yb3RGeC5zZXQoJ3NpemUnLCBbQHdpZHRoLCBAaGVpZ2h0XSlcblxuXHRcdFx0Zm9yIHkgaW4gWzAuLmgtMV1cblx0XHRcdFx0Zm9yIHggaW4gWzAuLnctMV1cblx0XHRcdFx0XHRfcm90Rnguc2V0KCdvZmZzZXQnLCBbeCAqIEdMX01BWF9XSURUSCwgeSAqIEdMX01BWF9XSURUSF0pXG5cdFx0XHRcdFx0X3JvdEZ4LnN5bmNBbGwoKVxuXHRcdFx0XHRcdF9yb3RGeC5yZW5kZXIoKVxuXG5cdFx0XHRcdFx0X2hxQ3R4LmRyYXdJbWFnZShfcm90RnguY2FudmFzLFxuXHRcdFx0XHRcdFx0eCAqIEdMX01BWF9XSURUSCxcblx0XHRcdFx0XHRcdEBoZWlnaHQgLSAoeSsxKSAqIGdsaClcblxuXHRcdFx0QGNhbnZhcyA9IF9ocUNhbnZhc1xuXG5cblx0IyBQdWJsaWMgTWV0aG9kXG5cdGNvbXBvc2VQYW5vcmFtYTogKHBhbm9JZCwgaGVhZGluZykgLT5cblx0XHRcblx0XHRfaGVhZGluZyA9IGhlYWRpbmcgPyAwXG5cdFxuXHRcdEBvblByb2dyZXNzKDApXG5cblx0XHRfcGFub0NsaWVudC5nZXRQYW5vcmFtYUJ5SWQgcGFub0lkLCAoZGF0YSwgc3RhdHVzKSA9PlxuXHRcdFx0aWYgc3RhdHVzICE9IGdvb2dsZS5tYXBzLlN0cmVldFZpZXdTdGF0dXMuT0tcblx0XHRcdFx0X3Rocm93RXJyb3IoXCJDb3VuZCBub3QgcmV0cmlldmUgcGFub3JhbWEgZm9yIHRoZSBmb2xsb3dpbmcgcmVhc29uOiB3cm9uZyBwYW5vIGlkXCIpXG5cdFx0XHRcdHJldHVyblxuXG5cdFx0XHR0aWxlcyA9IGRhdGEudGlsZXNcblxuXHRcdFx0X29yaWdpbkhlYWRpbmcgPSB0aWxlcy5vcmlnaW5IZWFkaW5nXG5cdFx0XHRfb3JpZ2luUGl0Y2ggICA9IHRpbGVzLm9yaWdpblBpdGNoXG5cblx0XHRcdHcgPSBNYXRoLmNlaWwoQHdpZHRoIC8gNTEyKVxuXHRcdFx0aCA9IE1hdGguY2VpbChAaGVpZ2h0IC8gNTEyKVxuXG5cdFx0XHR4ID0geSA9IDBcblx0XHRcdHVybCA9IG51bGxcblxuXHRcdFx0X2NvdW50ID0gMFxuXHRcdFx0X3RvdGFsID0gdyAqIGhcblxuXHRcdFx0Zm9yIHkgaW4gWzAuLmgtMV1cblx0XHRcdFx0Zm9yIHggaW4gWzAuLnctMV1cblx0XHRcdFx0XHR1cmwgPSBcImh0dHBzOi8vY2JrczAuZ29vZ2xlYXBpcy5jb20vY2JrP291dHB1dD10aWxlJnpvb209I3tfem9vbX0meD0je3h9Jnk9I3t5fSZwYW5vaWQ9I3twYW5vSWR9JiN7RGF0ZS5ub3coKX1cIlxuXG5cdFx0XHRcdFx0ZG8gKHgsIHkpID0+XG5cdFx0XHRcdFx0XHRpbWcgPSBuZXcgSW1hZ2UoKVxuXHRcdFx0XHRcdFx0aW1nLm9ubG9hZCA9ID0+XG5cdFx0XHRcdFx0XHRcdF9jb21wb3NlRnJvbVRpbGUuY2FsbChALCB4LCB5LCBpbWcpXG5cdFx0XHRcdFx0XHRpbWcuY3Jvc3NPcmlnaW4gPSBcIlwiXG5cdFx0XHRcdFx0XHRpbWcuc3JjID0gdXJsXG5cdFxuXHRzZXRab29tOiAoIHogKSAtPlxuXHRcdF96b29tID0gelxuXHRcdFxuXHRcdEB3aWR0aCA9IDQxNiAqIE1hdGgucG93KDIsIF96b29tKVxuXHRcdEBoZWlnaHQgPSAoNDE2ICogTWF0aC5wb3coMiwgX3pvb20gLSAxKSlcblxuXHRcdF90aWxlc0NhbnZhcy53aWR0aCA9IEB3aWR0aFxuXHRcdF90aWxlc0NhbnZhcy5oZWlnaHQgPSBAaGVpZ2h0XG5cdFx0X2N0eC50cmFuc2xhdGUoIF90aWxlc0NhbnZhcy53aWR0aCwgMClcblx0XHRfY3R4LnNjYWxlKC0xLCAxKVxuXG5cdFx0X3JvdEZ4LnNldFNpemUoQHdpZHRoLCBAaGVpZ2h0KVxuXG5cdFx0QG9uU2l6ZUNoYW5nZSgpXG5cblxuXG5cdFx0XG5cbiJdfQ==