var API_KEY, DIST_BETWEEN_PTS, MAX_PTS, canvas, dirService, generate, getDestLatLng, getOriginLatLng, loadPanoIds, loadPanorama, loader, mergePanoIds, panoIds, rawPts, res, setOriginLatLng, subdivide, totalDist, trace,
  slice = [].slice;

MAX_PTS = 100;

DIST_BETWEEN_PTS = 5;

API_KEY = "AIzaSyBQ2dzDfyF8Y0Dwe-Q6Jzx4_G62ANrTotQ";

loader = null;

dirService = new google.maps.DirectionsService({});

res = null;

rawPts = [];

panoIds = [];

totalDist = 0;

canvas = null;

trace = function() {
  var args;
  args = 1 <= arguments.length ? slice.call(arguments, 0) : [];
  return console.log.apply(console, args);
};

getOriginLatLng = function() {
  var originLat, originLng;
  originLat = $('#origin-lat').val();
  originLng = $('#origin-lng').val();
  return new google.maps.LatLng(originLat, originLng);
};

getDestLatLng = function() {
  var destLat, destLng;
  destLat = $('#dest-lat').val();
  destLng = $('#dest-lng').val();
  return new google.maps.LatLng(destLat, destLng);
};

setOriginLatLng = function(latLng) {
  $('#origin-lat').val(latLng.lat());
  return $('#origin-lng').val(latLng.lng());
};

$(function() {
  loader = new GSVPANO.PanoLoader({
    canvas: $('#panorama')[0]
  });
  loader.setZoom(3);
  canvas = $('#panorama')[0];
  return $('#analyze').on('click', generate);
});

generate = function() {
  var route;
  trace("generate----------");
  rawPts = [];
  panoIds = [];
  totalDist = 0;
  route = {
    request: {
      origin: getOriginLatLng(),
      destination: getDestLatLng(),
      travelMode: google.maps.DirectionsTravelMode.DRIVING
    }
  };
  return dirService.route(route.request, function(_res, status) {
    res = _res;
    if (status === google.maps.DirectionsStatus.OK) {
      return subdivide();
    } else {
      return trace(status);
    }
  });
};

subdivide = function() {
  var a, b, d, i, j, k, l, legs, m, path, r, ref, ref1, ref2, regDist, route, segLen, segs, t, way;
  trace('subdivide----------');
  route = res.routes[0];
  path = route.overview_path;
  legs = route.legs;
  for (i = k = 0, ref = legs.length - 1; 0 <= ref ? k <= ref : k >= ref; i = 0 <= ref ? ++k : --k) {
    totalDist += legs[i].distance.value;
  }
  trace('totalDist', totalDist);
  trace('path length', path.length);
  segLen = totalDist / MAX_PTS;
  regDist = DIST_BETWEEN_PTS;
  d = 0;
  r = 0;
  a = b = null;
  for (i = l = 0, ref1 = path.length - 1; 0 <= ref1 ? l <= ref1 : l >= ref1; i = 0 <= ref1 ? ++l : --l) {
    if (i + 1 < path.length) {
      a = path[i];
      b = path[i + 1];
      d = google.maps.geometry.spherical.computeDistanceBetween(a, b);
      if ((0 < r && r < d)) {
        a - pointOnLine(r / d, a, b);
        d = google.maps.geometry.spherical.computeDistanceBetween(a, b);
        rawPts.push(a);
        r = 0;
      } else if (0 < r && d < r) {
        r -= d;
      }
      if (r === 0) {
        segs = Math.floor(d / regDist);
        if (segs > 0) {
          for (j = m = 0, ref2 = segs - 1; 0 <= ref2 ? m <= ref2 : m >= ref2; j = 0 <= ref2 ? ++m : --m) {
            t = j / segs;
            if (0 < t || (t + i) === 0) {
              way = pointOnLine(t, a, b);
              rawPts.push(way);
            }
          }
        } else {
          r = regDist * (t - (d / regDist));
        }
      }
    } else {
      rawPts.push(path[i]);
    }
  }
  trace('subdivided points length', rawPts.length);
  return loadPanoIds();
};

loadPanoIds = function() {
  var count, i, k, pt, ref, results;
  trace('loadPanoIds----------');
  pt = null;
  count = 0;
  results = [];
  for (i = k = 0, ref = rawPts.length - 1; 0 <= ref ? k <= ref : k >= ref; i = 0 <= ref ? ++k : --k) {
    panoIds.push(null);
    pt = rawPts[i];
    results.push(loader.load(i, pt, function(result) {
      panoIds[result.index] = {
        location: result.location,
        id: result.location.pano,
        imageDate: result.imageDate
      };
      if (++count >= rawPts.length) {
        return mergePanoIds();
      }
    }));
  }
  return results;
};

mergePanoIds = function() {
  var i, k, mergedPanoIds, prevId, ref;
  trace('mergePanoIds----------');
  prevId = rawPts[0].id;
  mergedPanoIds = [];
  mergedPanoIds.push(panoIds[0]);
  for (i = k = 1, ref = panoIds.length - 1; 1 <= ref ? k <= ref : k >= ref; i = 1 <= ref ? ++k : --k) {
    if (panoIds[i].id !== prevId) {
      mergedPanoIds.push(panoIds[i]);
    }
    prevId = panoIds[i].id;
  }
  trace("reduced " + panoIds.length + "->" + mergedPanoIds.length);
  panoIds = mergedPanoIds;
  return loadPanorama();
};

loadPanorama = function() {
  var TIME_OUT, failedLoadPanorama, index, loadEachPanorama, max, timerId;
  trace('loadPanorama----------');
  max = panoIds.length;
  index = 0;
  timerId = 0;
  TIME_OUT = 2000;
  loadEachPanorama = function() {
    if (index >= max) {
      alert("finish!");
      return;
    }
    trace(index, panoIds[index].id);
    timerId = setTimeout(failedLoadPanorama, TIME_OUT);
    return loader.composePanorama(panoIds[index].id);
  };
  failedLoadPanorama = function() {
    trace(index, " - time out");
    return loadEachPanorama(++index);
  };
  loader.onPanoramaLoad = function() {
    exportCanvas(canvas, 'test', index);
    clearTimeout(timerId);
    return loadEachPanorama(++index);
  };
  return loadEachPanorama(0);
};

//# sourceMappingURL=data:application/json;base64,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cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuIyBjb25zdGFudHNcbk1BWF9QVFMgPSAxMDBcbkRJU1RfQkVUV0VFTl9QVFMgPSA1XG5cbkFQSV9LRVkgPSBcIkFJemFTeUJRMmR6RGZ5RjhZMER3ZS1RNkp6eDRfRzYyQU5yVG90UVwiXG5cblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuIyB2YXJpYWJsZXNcbmxvYWRlciA9IG51bGxcbmRpclNlcnZpY2UgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1NlcnZpY2Uoe30pXG5cbiMgZWFjaCByZXNcbnJlcyA9IG51bGxcblxucmF3UHRzID0gW11cbnBhbm9JZHMgPSBbXVxudG90YWxEaXN0ID0gMFxuXG5jYW52YXMgPSBudWxsXG5cbiMgbG9hZGVyLm9uUGFub3JhbWFMb2FkID0gKCkgLT5cbiMgXHRjb25zb2xlLmxvZyBcImZpbmlzaGVkXCJcbiMgXHQkKCdib2R5JykuYXBwZW5kKCBsb2FkZXIuY2FudmFzIClcblxuXG4jIGxvYWRlci5sb2FkKCBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKCA0Mi4yMTYxODgsLTc1LjcyNjU3ODU5OTk5OTk4ICksIC0+XG4jIFx0bG9hZGVyLmNvbXBvc2VQYW5vcmFtYSggbG9hZGVyLmlkIClcbiMgKVxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jIGluaXRcblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuIyBmdW5jdGlvbnNcblxudHJhY2UgPSAoYXJncy4uLikgLT5cblx0Y29uc29sZS5sb2cgYXJncy4uLlxuXHQjIHN0ciA9IFwiXCJcblx0IyBmb3IgYXJnIG9mIGFyZ3Ncblx0IyBcdHN0ciArPSBhcmcgKyBcIiBcIlxuXHQjIHN0ciArPSBcIlxcblwiXG5cdCMgJCgnI2NvbnNvbGUnKS5hcHBlbmQoIHN0ciApXG5cbmdldE9yaWdpbkxhdExuZyA9IC0+XG5cdG9yaWdpbkxhdCBcdD0gJCgnI29yaWdpbi1sYXQnKS52YWwoKVxuXHRvcmlnaW5MbmcgXHQ9ICQoJyNvcmlnaW4tbG5nJykudmFsKClcblx0cmV0dXJuIG5ldyBnb29nbGUubWFwcy5MYXRMbmcob3JpZ2luTGF0LCBvcmlnaW5MbmcpXG5cbmdldERlc3RMYXRMbmcgPSAtPlxuXHRkZXN0TGF0IFx0PSAkKCcjZGVzdC1sYXQnKS52YWwoKVxuXHRkZXN0TG5nXHRcdD0gJCgnI2Rlc3QtbG5nJykudmFsKClcblx0cmV0dXJuIG5ldyBnb29nbGUubWFwcy5MYXRMbmcoZGVzdExhdCwgZGVzdExuZylcblxuc2V0T3JpZ2luTGF0TG5nID0gKGxhdExuZykgLT5cblx0JCgnI29yaWdpbi1sYXQnKS52YWwoIGxhdExuZy5sYXQoKSApXG5cdCQoJyNvcmlnaW4tbG5nJykudmFsKCBsYXRMbmcubG5nKCkgKVxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jIG9uIGxvYWRcblxuIyBpbml0TWFwID0gLT5cbiMgXHQjIG1ha2UgbWFwXG4jIFx0bWFwT3B0aW9ucyA9XG4jIFx0XHR6b29tOiAxXG4jIFx0XHRjZW50ZXI6IGdldE9yaWdpbkxhdExuZygpXG4jIFx0XHRtYXBUeXBlSWQ6IGdvb2dsZS5tYXBzLk1hcFR5cGVJZC5ST0FETUFQXG5cbiMgXHRnb29nbGUubWFwcy5NYXAoIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWFwXCIpLCBtYXBPcHRpb25zIClcblxuJCAtPlxuXG5cblx0IyBvcmlnaW5NYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcblx0IyBcdHBvc2l0aW9uOiBnZXRPcmlnaW5MYXRMbmcoKVxuXHQjIFx0ZHJhZ2dhYmxlOiB0cnVlXG5cdCMgfSlcblxuXHQjIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG9yaWdpbk1hcmtlciwgJ2RyYWdlbmQnLCAoZXZ0KSAtPlxuXHQjIFx0c2V0T3JpZ2luTGF0TG5nKCBldnQubGF0TG5nIClcblx0IyApXG5cblx0bG9hZGVyID0gbmV3IEdTVlBBTk8uUGFub0xvYWRlcih7XG5cdFx0Y2FudmFzOiAkKCcjcGFub3JhbWEnKVswXVxuXHRcdH0pXG5cblx0bG9hZGVyLnNldFpvb20oIDMgKVxuXG5cdGNhbnZhcyA9ICQoJyNwYW5vcmFtYScpWzBdXG5cblx0JCgnI2FuYWx5emUnKS5vbiAnY2xpY2snLCBnZW5lcmF0ZVxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5nZW5lcmF0ZSA9IC0+XG5cblx0dHJhY2UgXCJnZW5lcmF0ZS0tLS0tLS0tLS1cIlxuXG5cdHJhd1B0cyA9IFtdXG5cdHBhbm9JZHMgPSBbXVxuXHR0b3RhbERpc3QgPSAwXG5cblx0cm91dGUgPSBcblx0XHRyZXF1ZXN0OlxuXHRcdFx0b3JpZ2luOiBnZXRPcmlnaW5MYXRMbmcoKVxuXHRcdFx0ZGVzdGluYXRpb246IGdldERlc3RMYXRMbmcoKVxuXHRcdFx0dHJhdmVsTW9kZTogZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1RyYXZlbE1vZGUuRFJJVklOR1xuXG5cdGRpclNlcnZpY2Uucm91dGUgcm91dGUucmVxdWVzdCwgKF9yZXMsIHN0YXR1cykgLT5cblx0XHRyZXMgPSBfcmVzXG5cdFx0aWYgKHN0YXR1cyA9PSBnb29nbGUubWFwcy5EaXJlY3Rpb25zU3RhdHVzLk9LKVxuXHRcdFx0IyBuZXh0XG5cdFx0XHRzdWJkaXZpZGUoKVxuXHRcdGVsc2Vcblx0XHRcdHRyYWNlIHN0YXR1c1xuXHRcblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuc3ViZGl2aWRlID0gLT5cblx0dHJhY2UgJ3N1YmRpdmlkZS0tLS0tLS0tLS0nXG5cblx0cm91dGUgXHQ9IHJlcy5yb3V0ZXNbMF1cblx0cGF0aCBcdD0gcm91dGUub3ZlcnZpZXdfcGF0aFxuXHRsZWdzIFx0PSByb3V0ZS5sZWdzXG5cblxuXHRmb3IgaSBpbiBbMC4ubGVncy5sZW5ndGgtMV1cblx0XHR0b3RhbERpc3QgKz0gbGVnc1tpXS5kaXN0YW5jZS52YWx1ZVxuXG5cdHRyYWNlICd0b3RhbERpc3QnLCB0b3RhbERpc3Rcblx0dHJhY2UgJ3BhdGggbGVuZ3RoJywgcGF0aC5sZW5ndGhcblxuXHRzZWdMZW4gPSB0b3RhbERpc3QgLyBNQVhfUFRTXG5cdHJlZ0Rpc3QgPSBESVNUX0JFVFdFRU5fUFRTI01hdGgubWF4KCBESVNUX0JFVFdFRU5fUFRTLCBzZWdMZW4gKVxuXG5cdGQgPSAwXG5cdHIgPSAwXG5cdGEgPSBiID0gbnVsbFxuXG5cdGZvciBpIGluIFswLi5wYXRoLmxlbmd0aC0xXVxuXG5cdFx0aWYgaSsxIDwgcGF0aC5sZW5ndGggIyBiZWdpbm5pbmcgfiBkZXN0aW5hdGlvbiBwb2ludCAtIDFcblxuXHRcdFx0YSA9IHBhdGhbaV1cblx0XHRcdGIgPSBwYXRoW2krMV1cblx0XHRcdGQgPSBnb29nbGUubWFwcy5nZW9tZXRyeS5zcGhlcmljYWwuY29tcHV0ZURpc3RhbmNlQmV0d2VlbihhLCBiKVxuXG5cdFx0XHRpZiAwIDwgciA8IGRcblx0XHRcdFx0YSAtIHBvaW50T25MaW5lKHIvZCwgYSwgYilcblx0XHRcdFx0ZCA9IGdvb2dsZS5tYXBzLmdlb21ldHJ5LnNwaGVyaWNhbC5jb21wdXRlRGlzdGFuY2VCZXR3ZWVuKGEsIGIpXG5cdFx0XHRcdHJhd1B0cy5wdXNoKCBhIClcblxuXHRcdFx0XHRyID0gMFxuXG5cdFx0XHRlbHNlIGlmIDAgPCByICYmIGQgPCByXG5cdFx0XHRcdHIgLT0gZFxuXG5cdFx0XHRpZiByID09IDBcblxuXHRcdFx0XHQjIG51bWJlciBvZiBzdWJkaXZpZGluZyB0aGlzIHBhdGhcblx0XHRcdFx0c2VncyA9IE1hdGguZmxvb3IoIGQgLyByZWdEaXN0IClcblxuXHRcdFx0XHQjIGFkZCBzdWJkaXZpZGVkIHBvaW50cyB0byByYXdQdHNcblx0XHRcdFx0aWYgc2VncyA+IDBcblx0XHRcdFx0XHRmb3IgaiBpbiBbMC4uc2Vncy0xXVxuXHRcdFx0XHRcdFx0dCA9IGogLyBzZWdzXG5cblx0XHRcdFx0XHRcdGlmIDAgPCB0IHx8ICh0K2kpID09IDAgIyBub3Qgc3RhcnQgcG9pbnRcblx0XHRcdFx0XHRcdFx0d2F5ID0gcG9pbnRPbkxpbmUodCwgYSwgYilcblx0XHRcdFx0XHRcdFx0cmF3UHRzLnB1c2goIHdheSApXG5cblx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdHIgPSByZWdEaXN0ICogKCB0IC0gKGQvcmVnRGlzdCkgKVxuXG5cdFx0ZWxzZSAjIGRlc3RpbmF0aW9uIHBvaW50XG5cdFx0XHRyYXdQdHMucHVzaCggcGF0aFtpXSApXG5cblx0dHJhY2UgJ3N1YmRpdmlkZWQgcG9pbnRzIGxlbmd0aCcsIHJhd1B0cy5sZW5ndGhcblxuXHQjIG5leHRcblx0bG9hZFBhbm9JZHMoKVxuXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmxvYWRQYW5vSWRzID0gLT5cblx0dHJhY2UgJ2xvYWRQYW5vSWRzLS0tLS0tLS0tLSdcblxuXHRwdCA9IG51bGxcblx0Y291bnQgPSAwXG5cblx0Zm9yIGkgaW4gWzAuLnJhd1B0cy5sZW5ndGgtMV1cblx0XHRwYW5vSWRzLnB1c2goIG51bGwgKVxuXHRcdHB0ID0gcmF3UHRzW2ldXG5cblx0XHRsb2FkZXIubG9hZCBpLCBwdCwgKHJlc3VsdCkgLT5cblx0XHRcdCNjb25zb2xlLmxvZyByZXN1bHQuaW5kZXgsIHJlc3VsdC5sb2NhdGlvbi5wYW5vXG5cdFx0XHRwYW5vSWRzWyByZXN1bHQuaW5kZXggXSA9XG5cdFx0XHRcdGxvY2F0aW9uOiByZXN1bHQubG9jYXRpb25cblx0XHRcdFx0aWQ6IHJlc3VsdC5sb2NhdGlvbi5wYW5vXG5cdFx0XHRcdGltYWdlRGF0ZTogcmVzdWx0LmltYWdlRGF0ZVxuXHRcdFx0aWYgKytjb3VudCA+PSByYXdQdHMubGVuZ3RoXG5cdFx0XHRcdCMgbmV4dFxuXHRcdFx0XHRtZXJnZVBhbm9JZHMoKVxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5tZXJnZVBhbm9JZHMgPSAtPlxuXHR0cmFjZSAnbWVyZ2VQYW5vSWRzLS0tLS0tLS0tLSdcblxuXHRwcmV2SWQgPSByYXdQdHNbMF0uaWRcblx0bWVyZ2VkUGFub0lkcyA9IFtdXG5cblx0bWVyZ2VkUGFub0lkcy5wdXNoKCBwYW5vSWRzWzBdIClcblxuXHRmb3IgaSBpbiBbMS4ucGFub0lkcy5sZW5ndGgtMV1cblx0XHQjdHJhY2UgaSwgcGFub0lkc1tpXS5pZCwgcHJldklkXG5cdFx0aWYgcGFub0lkc1tpXS5pZCAhPSBwcmV2SWRcblx0XHRcdG1lcmdlZFBhbm9JZHMucHVzaCggcGFub0lkc1tpXSApXG5cdFx0cHJldklkID0gcGFub0lkc1tpXS5pZFxuXG5cdHRyYWNlIFwicmVkdWNlZCAje3Bhbm9JZHMubGVuZ3RofS0+I3ttZXJnZWRQYW5vSWRzLmxlbmd0aH1cIlxuXG5cdHBhbm9JZHMgPSBtZXJnZWRQYW5vSWRzXG5cblx0IyBuZXh0XG5cdGxvYWRQYW5vcmFtYSgpXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmxvYWRQYW5vcmFtYSA9IC0+XG5cdHRyYWNlICdsb2FkUGFub3JhbWEtLS0tLS0tLS0tJ1xuXG5cdG1heCA9IHBhbm9JZHMubGVuZ3RoXG5cdGluZGV4ID0gMFxuXHR0aW1lcklkID0gMFxuXHRUSU1FX09VVCA9IDIwMDBcblxuXHRsb2FkRWFjaFBhbm9yYW1hID0gLT5cblx0XHRpZiBpbmRleCA+PSBtYXhcblx0XHRcdGFsZXJ0KFwiZmluaXNoIVwiKVxuXHRcdFx0cmV0dXJuXG5cblx0XHR0cmFjZSBpbmRleCwgcGFub0lkc1tpbmRleF0uaWRcblxuXHRcdHRpbWVySWQgPSBzZXRUaW1lb3V0KCBmYWlsZWRMb2FkUGFub3JhbWEsIFRJTUVfT1VUIClcblx0XHRsb2FkZXIuY29tcG9zZVBhbm9yYW1hKCBwYW5vSWRzW2luZGV4XS5pZCApXG5cblx0ZmFpbGVkTG9hZFBhbm9yYW1hID0gLT5cblx0XHR0cmFjZSBpbmRleCwgXCIgLSB0aW1lIG91dFwiXG5cdFx0bG9hZEVhY2hQYW5vcmFtYSggKytpbmRleCApXG5cdFx0I3NldFRpbWVvdXQgbG9hZEVhY2hQYW5vcmFtYSwgMTAwMDBcblxuXHRsb2FkZXIub25QYW5vcmFtYUxvYWQgPSAtPlxuXHRcdCMgc2F2ZVxuXHRcdGV4cG9ydENhbnZhcyggY2FudmFzLCAndGVzdCcsIGluZGV4IClcblxuXHRcdCMgcXVldWUgbmV4dCBmcmFtZVxuXHRcdGNsZWFyVGltZW91dCggdGltZXJJZCApXG5cdFx0bG9hZEVhY2hQYW5vcmFtYSggKytpbmRleCApXG5cblx0IyBsb2FkXG5cdGxvYWRFYWNoUGFub3JhbWEoIDAgKVxuXG5cbiJdfQ==