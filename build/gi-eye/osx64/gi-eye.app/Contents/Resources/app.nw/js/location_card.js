var $ul, apiKey, getSrc, load, loader, locations, makeCard, mapReg, onLoadCSV;

locations = [];

$ul = null;

apiKey = "AIzaSyB7BjJ9FNKGq5HRB9VeA73cJPFCXk6RIa8";

mapReg = /@(.*),(.*),(.*)a,(.*)y,(.*)h,(.*)t\//;

loader = new GSVPANO.PanoLoader();

$(function() {
  $ul = $('#cards');
  return load();
});

load = function() {
  return $.get('assets/locations.csv', onLoadCSV);
};

getSrc = function(url) {
  return "";
};

onLoadCSV = function(data) {
  var csv, i, line, match, nl, param, prevTitle, url;
  csv = $.csv.toArrays(data);
  prevTitle = "";
  for (i in csv) {
    line = csv[i];
    url = line[1];
    match = mapReg.exec(url);
    if (match === null) {
      console.log("error", i, line[0]);
      continue;
    }
    nl = {
      number: Number(i) + 1,
      title: line[0],
      url: line[1],
      lat: match[1],
      lng: match[2],
      fov: match[4],
      heading: match[5],
      pitch: match[6]
    };
    if (nl.title === "") {
      nl.title = prevTitle;
    }
    param = {
      size: "640x400",
      sensor: false,
      location: nl.lat + "," + nl.lng,
      heading: nl.heading,
      pitch: nl.pitch - 90,
      fov: nl.fov,
      key: apiKey
    };
    prevTitle = nl.title;
    nl.latlng = new google.maps.LatLng(nl.lat, nl.lng);
    nl.place = url.indexOf("lace") !== -1 ? "[place]" : "";
    locations.push(nl);
  }
  return makeCard();
};

makeCard = function() {
  var append, index;
  index = 0;
  append = function() {
    var $newElm, l;
    if (index >= locations.length) {
      return;
    }
    l = locations[index];
    $newElm = $("<li id='location-" + l.number + "' class='card'> <a href='" + l.url + "'><img class='thumb'></a> <h1>" + l.number + "." + l.title + " " + l.place + " </h1> </li>");
    $ul.append($newElm);
    loader.load(index, l.latlng, function(result) {
      var $img, param, src;
      console.log(result.index, result);
      l = locations[result.index];
      $("#location-" + l.number).append("<div class='description'> " + result.location.description + " (" + result.imageDate + ") </div>");
      $img = param = {
        size: "640x400",
        sensor: false,
        pano: result.location.pano,
        heading: l.heading,
        pitch: l.pitch - 90,
        fov: 180,
        key: apiKey
      };
      src = "http://maps.googleapis.com/maps/api/streetview?" + $.param(param);
      if (src === "" || src === void 0) {
        console.log(result, param);
      }
      return $("#location-" + l.number + " img").attr('src', src);
    });
    index += 1;
    return setTimeout(append, 200);
  };
  return append();
};

//# sourceMappingURL=data:application/json;base64,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cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiXG5sb2NhdGlvbnMgPSBbXVxuXG4kdWwgPSBudWxsXG5cbmFwaUtleSA9IFwiQUl6YVN5QjdCako5Rk5LR3E1SFJCOVZlQTczY0pQRkNYazZSSWE4XCJcblxubWFwUmVnID0gL0AoLiopLCguKiksKC4qKWEsKC4qKXksKC4qKWgsKC4qKXRcXC8vXG5cbmxvYWRlciA9IG5ldyBHU1ZQQU5PLlBhbm9Mb2FkZXIoKVxuXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuJCAtPlxuXHQkdWwgPSAkKCcjY2FyZHMnKVxuXG5cdGxvYWQoKVxuXG4jLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5sb2FkID0gLT5cblx0JC5nZXQgJ2Fzc2V0cy9sb2NhdGlvbnMuY3N2Jywgb25Mb2FkQ1NWXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmdldFNyYyA9ICh1cmwpIC0+XG5cdHJldHVybiBcIlwiXG5cblxuXG5cbiMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbm9uTG9hZENTViA9IChkYXRhKSAtPlxuXHRcblx0Y3N2ID0gJC5jc3YudG9BcnJheXMoIGRhdGEgKVxuXG5cdHByZXZUaXRsZSA9IFwiXCJcblxuXHRmb3IgaSwgbGluZSBvZiBjc3ZcblxuXHRcdHVybCA9IGxpbmVbMV1cblx0XHRtYXRjaCA9IG1hcFJlZy5leGVjKCB1cmwgKVxuXG5cdFx0aWYgbWF0Y2ggPT0gbnVsbFxuXHRcdFx0Y29uc29sZS5sb2cgXCJlcnJvclwiLCBpLCBsaW5lWzBdXG5cdFx0XHRjb250aW51ZVxuXG5cdFx0bmwgPVxuXHRcdFx0bnVtYmVyOiAoTnVtYmVyKGkpKzEpXG5cdFx0XHR0aXRsZTogbGluZVswXVxuXHRcdFx0dXJsOiBsaW5lWzFdXG5cdFx0XHRsYXQ6IG1hdGNoWzFdXG5cdFx0XHRsbmc6IG1hdGNoWzJdXG5cdFx0XHRmb3Y6IG1hdGNoWzRdXG5cdFx0XHRoZWFkaW5nOiBtYXRjaFs1XVxuXHRcdFx0cGl0Y2g6IG1hdGNoWzZdXG5cblx0XHRpZiBubC50aXRsZSA9PSBcIlwiXG5cdFx0XHRubC50aXRsZSA9IHByZXZUaXRsZVxuXG5cdFx0cGFyYW0gPVxuXHRcdFx0c2l6ZTogXCI2NDB4NDAwXCJcblx0XHRcdHNlbnNvcjogZmFsc2Vcblx0XHRcdGxvY2F0aW9uOiBubC5sYXQgKyBcIixcIiArIG5sLmxuZ1xuXHRcdFx0aGVhZGluZzogbmwuaGVhZGluZ1xuXHRcdFx0cGl0Y2g6IG5sLnBpdGNoIC0gOTBcblx0XHRcdGZvdjogbmwuZm92IzkwI01hdGgubWF4KDEyMCwgbmwuZm92ICsgNDApXG5cdFx0XHRrZXk6IGFwaUtleVxuXG5cdFx0cHJldlRpdGxlID0gbmwudGl0bGVcblxuXHRcdG5sLmxhdGxuZyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoIG5sLmxhdCwgbmwubG5nIClcblxuXHRcdG5sLnBsYWNlID0gaWYgdXJsLmluZGV4T2YoXCJsYWNlXCIpICE9IC0xIHRoZW4gXCJbcGxhY2VdXCIgZWxzZSBcIlwiXG5cblx0XHQjIGlmIHVybC5pbmRleE9mKFwicGxhY2VcIikgPT0gLTFcblx0XHQjIFx0IyBzdHJlZXQgdmlld1xuXHRcdCMgXHRubC5pbWcgPSBcImh0dHA6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL3N0cmVldHZpZXc/XCIgKyAkLnBhcmFtKCBwYXJhbSApXG5cblx0XHQjIGVsc2Vcblx0XHQjIFx0IyBwbGFjZXNcblx0XHQjIFx0bmwuaW1nID0gXCJcIlxuXG5cblx0XHRsb2NhdGlvbnMucHVzaCggbmwgKVxuXG5cdG1ha2VDYXJkKClcblxuIy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxubWFrZUNhcmQgPSAtPlxuXG5cdGluZGV4ID0gMFxuXG5cdGFwcGVuZCA9ICgpIC0+XG5cdFx0aWYgaW5kZXggPj0gbG9jYXRpb25zLmxlbmd0aFxuXHRcdFx0cmV0dXJuXG5cblx0XHRsID0gbG9jYXRpb25zW2luZGV4XVxuXG5cdFx0IyBjcmVhdGUgbmV3IGVsZW1lbnRzXG5cdFx0JG5ld0VsbSA9ICQoXG5cdFx0XHRcIlxuXHRcdFx0PGxpIGlkPSdsb2NhdGlvbi0je2wubnVtYmVyfScgY2xhc3M9J2NhcmQnPlxuXHRcdFx0XHQ8YSBocmVmPScje2wudXJsfSc+PGltZyBjbGFzcz0ndGh1bWInPjwvYT5cblx0XHRcdFx0PGgxPiN7bC5udW1iZXJ9LiN7bC50aXRsZX0gI3tsLnBsYWNlfVxuPC9oMT5cblx0XHRcdDwvbGk+XG5cdFx0XHRcIlxuXHRcdClcblx0XHQkdWwuYXBwZW5kKCAkbmV3RWxtIClcblxuXHRcdCMgYWRkIHRpdGxlXG5cdFx0bG9hZGVyLmxvYWQgaW5kZXgsIGwubGF0bG5nLCAocmVzdWx0KSAtPlxuXG5cdFx0XHRjb25zb2xlLmxvZyByZXN1bHQuaW5kZXgsIHJlc3VsdFxuXG5cdFx0XHRsID0gbG9jYXRpb25zWyByZXN1bHQuaW5kZXggXVxuXG5cdFx0XHQkKFwiI2xvY2F0aW9uLSN7bC5udW1iZXJ9XCIpLmFwcGVuZChcIlxuXHRcdFx0XHQ8ZGl2IGNsYXNzPSdkZXNjcmlwdGlvbic+XG5cdFx0XHRcdFx0I3tyZXN1bHQubG9jYXRpb24uZGVzY3JpcHRpb259ICgje3Jlc3VsdC5pbWFnZURhdGV9KVxuXHRcdFx0XHRcdFx0XHRcdFx0PC9kaXY+XG5cdFx0XHRcIilcblxuXHRcdFx0JGltZyA9IFxuXG5cdFx0XHRwYXJhbSA9XG5cdFx0XHRcdHNpemU6IFwiNjQweDQwMFwiXG5cdFx0XHRcdHNlbnNvcjogZmFsc2Vcblx0XHRcdFx0cGFubzogcmVzdWx0LmxvY2F0aW9uLnBhbm9cblx0XHRcdFx0aGVhZGluZzogbC5oZWFkaW5nXG5cdFx0XHRcdHBpdGNoOiBsLnBpdGNoIC0gOTBcblx0XHRcdFx0Zm92OiAxODAjTWF0aC5tYXgobC5mb3YgKiAyLCAwKVxuXHRcdFx0XHRrZXk6IGFwaUtleVxuXG5cdFx0XHRzcmMgPSBcImh0dHA6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL3N0cmVldHZpZXc/XCIgKyAkLnBhcmFtKCBwYXJhbSApXG5cblx0XHRcdGlmIHNyYyA9PSBcIlwiIHx8IHNyYyA9PSB1bmRlZmluZWRcblx0XHRcdFx0Y29uc29sZS5sb2cgcmVzdWx0LCBwYXJhbVxuXG5cdFx0XHQkKFwiI2xvY2F0aW9uLSN7bC5udW1iZXJ9IGltZ1wiKS5hdHRyKCdzcmMnLCBzcmMpXG5cblxuXHRcdCMgbmV4dFxuXHRcdGluZGV4ICs9IDFcblx0XHRzZXRUaW1lb3V0KCBhcHBlbmQsIDIwMCApXG5cblxuXHRhcHBlbmQoKVxuXG4iXX0=